import{V as e,b3 as t,b4 as s,b5 as n,b6 as r,r as i,_ as a,b7 as d,u,b8 as c,b9 as l,ba as h,o as f,bb as v,a4 as g,bc as b,i as p,bd as m,be as y,bf as I,bg as _,bh as k,aI as w,bi as S,U as P,j as T,bj as E,k as Q,W as q,bk as D,bl as F,bm as A,bn as R,bo as H,bp as O,bq as N,br as j,bs as L}from"./bundle/bundle.shared.js";export{bf as ApplicationUserListQuery,bt as BannedUserListQuery,bg as BlockedUserListQuery,C as ChannelType,be as ConnectionHandler,ba as ConnectionState,a1 as Emoji,$ as EmojiCategory,Z as EmojiContainer,bh as FriendListQuery,bu as LogLevel,bv as MutedUserListQuery,bw as OperatorListQuery,bx as Plugin,bp as PushTemplate,bj as PushTokenRegistrationState,W as PushTokenType,bm as PushTriggerOption,by as ReportCategory,bz as RestrictedUser,bA as RestrictionInfo,bB as RestrictionType,bC as Role,bs as SendbirdChatOptions,o as SendbirdError,bc as SessionHandler,br as TotalUnreadMessageCountParams,bq as UnreadItemCountParams,U as User,bd as UserEventHandler,bD as UserOnlineState}from"./bundle/bundle.shared.js";import{MessageModule as x}from"./message.js";import{O as z,m as B,U as V,a as G,b as K,R as J,c as X,d as Y,e as ee,f as te,g as se,G as ne,h as re,S as ie,i as oe,j as ae,k as de,l as ue,n as ce,o as le,p as he,q as fe,r as ve,s as ge,t as pe,u as me,v as ye,w as Ie,x as _e,B as ke,y as we,z as Ce,A as Se,C as Pe,D as Ue,E as Te,F as Ee,H as Qe,I as qe,J as Me,K as De,L as Fe,M as Ae,N as Re,P as He,Q as Oe,T as Ne,V as je,W as Le,X as xe,Y as ze,Z as $e,_ as Be,$ as Ve}from"./bundle/bundle.sendbird.js";import{I as We,A as Ge,M as Ke,N as Ze,a as Je}from"./vendor/vendor.internal.js";export{M as MemoryStore}from"./vendor/vendor.internal.js";import"./bundle/bundle.message.js";let Xe=null;class Ye{constructor(o,u,c){this._appState="foreground",this._fcmPushToken=null,this._apnsPushToken=null,this._iid=o,this.options=u;const{sdkState:l,cacheContext:h,connectionManager:f,dispatcher:v,sessionManager:g,requestQueue:b,logger:p,userEventHandlers:m}=e.of(o);c.forEach((e=>{e.init(o,{sdkState:l,cacheContext:h,dispatcher:v,sessionManager:g,requestQueue:b}),this[e.name]=e})),this._onlineDetector=new z({logger:p,connectionDelegate:{reconnect:()=>f.reconnect(),disconnect:()=>f.disconnect()}}),v.on((u=>{if(u instanceof t)switch(u.code){case"USEV":{const{event:e}=u.as(s);switch(e.category){case n.FRIEND_DISCOVERED:{const{friendDiscoveries:t}=r.getDataAsFriendDiscoveredEvent(o,e);i((()=>a(this,void 0,void 0,(function*(){return m.forEach((e=>{e.onFriendsDiscovered(t)}))}))));break}}break}}else if(u instanceof d){const{subscribedUnreadMessageCount:t}=e.of(this._iid);let s=!1;const n=u.ts;if("number"==typeof n&&n>t.ts){if(t.all!==u.all&&(s=!0),t.all=u.all>=0?u.all:0,u.customTypes)for(const e in u.customTypes)t.customTypes[e]!==u.customTypes[e]&&(s=!0),t.customTypes[e]=u.customTypes[e];s=s&&t.ts>0,t.ts=n}s&&i((()=>a(this,void 0,void 0,(function*(){return m.forEach((e=>{e.onTotalUnreadMessageCountUpdated(t.all,t.customTypes)}))}))))}}))}static init(t){const{appId:s,appVersion:n=null,modules:r=[],options:i=new L,debugMode:o=!1,customApiHost:a,customWebSocketHost:d,newInstance:c=!1,localCacheEnabled:l=!1,localCacheEncryption:h={encrypt:e=>e,decrypt:e=>e},useAsyncStorageStore:f=null}=t;if(!Xe||c){const t=`su-${u()}`,c=h;let v=new Ke({encryption:c});o||(v=f?new Ge({AsyncStorage:f,encryption:c}):new We({encryption:c})),new e(t,{appId:s,appVersion:n,options:i,apiHost:null!=a?a:`https://api-${s}.sendbird.com`,websocketHost:null!=d?d:`wss://ws-${s}.sendbird.com`,store:v,encryption:c,localCacheEnabled:l,debugMode:o});const g=new Ye(t,i,[...r,new x]);return Xe||(Xe=g),g}}static get instance(){return Xe}static get version(){return c}get appId(){const{sdkState:t}=e.of(this._iid);return t.appId}get appVersion(){var t;const{sdkState:s}=e.of(this._iid);return null!==(t=s.appVersion)&&void 0!==t?t:""}get debugMode(){const{debugMode:t}=e.of(this._iid);return t}get logLevel(){const{logger:t}=e.of(this._iid);return t.level}set logLevel(t){const{logger:s}=e.of(this._iid);s.level=t}get isCacheEnabled(){const{cacheContext:t}=e.of(this._iid);return t.localCacheEnabled}get ekey(){return l(this._iid)}get currentUser(){var t;const{sessionManager:s}=e.of(this._iid);return null!==(t=s.currentUser)&&void 0!==t?t:null}get connectionState(){const{connectionManager:t}=e.of(this._iid);return t.isConnected?h.OPEN:t.isConnecting?h.CONNECTING:h.CLOSED}get lastConnectedAt(){const{connectedAt:t,connectionManager:s}=e.of(this._iid);return s.isConnected?t:0}get fcmPushToken(){return this._fcmPushToken}get apnsPushToken(){return this._apnsPushToken}getMemoryStoreForDebugging(){const{debugMode:t,cacheContext:s}=e.of(this._iid);if(t)return s.store instanceof Ke?s.store:null;throw f.debugModeRequired}addExtension(t,s){const{sdkState:n}=e.of(this._iid);["sb_uikit","sb_syncmanager"].indexOf(t)>-1&&(n.extensions[t]=s)}initializeCache(t){return a(this,void 0,void 0,(function*(){const{sdkState:s,cacheContext:n,connectionManager:r,dispatcher:i}=e.of(this._iid);if((!s.userId||s.userId!==t)&&(yield r.logout(),s.userId=t,n.localCacheEnabled)){const e=`sendbird@${s.appId}/${t}.db`;if(!n.nestdb||n.nestdb.state===Ze.CLOSED||n.nestdb.name!==e){const e=n.nestdb=new Je({name:`sendbird@${s.appId}/${t}.db`,version:1,store:n.store});e.on("upgrade",B(e)),yield e.open(),i.dispatch(new v(this._iid,{userId:t}))}}}))}clearCache(){return a(this,void 0,void 0,(function*(){const{cacheContext:t}=e.of(this._iid);t.localCacheEnabled&&t.nestdb&&(t.nestdb.close(),yield t.nestdb.reset())}))}connect(t,s=null){return a(this,void 0,void 0,(function*(){const{connectionManager:n}=e.of(this._iid);try{yield this.initializeCache(t)}catch(t){const{cacheContext:s,logger:n}=e.of(this._iid);s.localCacheEnabled=!1,n.warn("Cache initialization failed - cache is not available.")}return this._onlineDetector.start(),yield n.connect(s),this.currentUser}))}reconnect(){const{connectionManager:t,sessionManager:s}=e.of(this._iid),n=s.auth.hasSession;return n&&t.reconnect().catch((()=>{})),n}disconnect(){return a(this,void 0,void 0,(function*(){const{connectionManager:t,cacheContext:s,requestQueue:n}=e.of(this._iid);this._onlineDetector.stop(),n.cancelAll(),yield t.logout(),s.localCacheEnabled&&(yield this.clearCache())}))}setBackgroundState(){if("foreground"===this._appState){const{connectionManager:t}=e.of(this._iid);this._appState="background",t.background()}}setForegroundState(){if("background"===this._appState){const{connectionManager:t}=e.of(this._iid);this._appState="foreground",t.reconnect()}}setSessionHandler(t){g(t instanceof b).throw(f.invalidParameters);const{sessionManager:s}=e.of(this._iid);s.handler=t}addUserEventHandler(t,s){g(p("string",t)&&s instanceof m).throw(f.invalidParameters);const{userEventHandlers:n}=e.of(this._iid);n.set(t,s)}removeUserEventHandler(t){const{userEventHandlers:s}=e.of(this._iid);s.delete(t)}removeAllUserEventHandler(){const{userEventHandlers:t}=e.of(this._iid);t.clear()}addConnectionHandler(t,s){g(p("string",t)&&s instanceof y).throw(f.invalidParameters);const{connectionHandlers:n}=e.of(this._iid);n.set(t,s)}removeConnectionHandler(t){const{connectionHandlers:s}=e.of(this._iid);s.delete(t)}removeAllConnectionHandler(){const{connectionHandlers:t}=e.of(this._iid);t.clear()}createApplicationUserListQuery(e={}){return new I(this._iid,e)}createBlockedUserListQuery(e={}){return new _(this._iid,e)}createFriendListQuery(e={}){return new k(this._iid,e)}createMessageSearchQuery(e){return new w(this._iid,e)}buildUserFromSerializedData(e){const t=S(e);return new P(this._iid,P.payloadify(t))}updateCurrentUserInfo(t){return a(this,void 0,void 0,(function*(){if(g(t instanceof V&&t.validate()).throw(f.invalidParameters),this.currentUser){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new G(Object.assign({userId:s.userId},t)),i=yield n.send(r),{user:o}=i.as(K);return this.currentUser&&(t.nickname&&(this.currentUser.nickname=o.nickname),(t.profileUrl||t.profileImage)&&(this.currentUser.plainProfileUrl=o.profileUrl)),o}throw f.connectionRequired}))}updateCurrentUserInfoWithPreferredLanguages(t){return a(this,void 0,void 0,(function*(){if(g(T("string",t)).throw(f.invalidParameters),this.currentUser){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new G({userId:s.userId,preferredLanguages:t}),i=yield n.send(r),{user:o}=i.as(K);return this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),o}throw f.connectionRequired}))}registerFCMPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(g(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,E.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new J({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",E.SUCCESS}catch(e){return E.ERROR}}))}unregisterFCMPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(g(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,E.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new X({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",E.SUCCESS}catch(e){return E.ERROR}}))}unregisterFCMPushTokenAllForCurrentUser(){return a(this,void 0,void 0,(function*(){if(this.currentUser){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new Y({userId:t.userId});yield s.send(n)}}))}registerAPNSPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(g(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,E.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new ee({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",E.SUCCESS}catch(e){return E.ERROR}}))}unregisterAPNSPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(g(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,E.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new te({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",E.SUCCESS}catch(e){return E.ERROR}}))}unregisterAPNSPushTokenAllForCurrentUser(){return a(this,void 0,void 0,(function*(){if(this.currentUser){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new se({userId:t.userId});yield s.send(n)}}))}getChannelInvitationPreference(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ne({userId:t.userId}),r=yield s.send(n),{autoAccept:i}=r.as(re);return{autoAccept:i}}))}setChannelInvitationPreference(t){return a(this,void 0,void 0,(function*(){g(p("boolean",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new ie({userId:s.userId,willAutoAccept:t}),i=yield n.send(r),{autoAccept:o}=i.as(oe);return{autoAccept:o}}))}getDoNotDisturb(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ae({userId:t.userId}),r=yield s.send(n),{preference:i}=r.as(de);return i}))}setDoNotDisturb(t,s=0,n=0,r=0,i=0,o=""){return a(this,void 0,void 0,(function*(){g(p("boolean",t)&&p("number",s)&&p("number",n)&&p("number",r)&&p("number",i)&&p("string",o)).throw(f.invalidParameters);const{sdkState:a,requestQueue:d}=e.of(this._iid),u=new ue({userId:a.userId,doNotDisturbOn:t,startHour:s,startMin:n,endHour:r,endMin:i,timezone:o}),c=yield d.send(u),{preference:l}=c.as(ce);return l}))}getSnoozePeriod(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new le({userId:t.userId}),r=yield s.send(n),{snoozePeriod:i}=r.as(he);return i}))}setSnoozePeriod(t,s=0,n=0){return a(this,void 0,void 0,(function*(){g(p("boolean",t)&&p("number",s)&&p("number",n)).throw(f.invalidParameters);const{sdkState:r,requestQueue:i}=e.of(this._iid),o=new fe({userId:r.userId,snoozeOn:t,startTs:s,endTs:n}),a=yield i.send(o),{snoozePeriod:d}=a.as(ve);return d}))}getMyPushTokensByToken(t,s){return a(this,void 0,void 0,(function*(){g(p("string",t)&&Q(q,s)).throw(f.invalidParameters);const{sdkState:n,requestQueue:r}=e.of(this._iid),i=new ge({userId:n.userId,type:s,token:t}),o=yield r.send(i),{pushTokens:a}=o.as(pe);return a}))}getPushTriggerOption(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new D({userId:t.userId});return(yield s.send(n)).as(F).pushTriggerOption}))}setPushTriggerOption(t){return a(this,void 0,void 0,(function*(){g(Q(A,t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new R({userId:s.userId,pushTriggerOption:t});return(yield n.send(r)).as(H).pushTriggerOption}))}getPushTemplate(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new me({userId:t.userId});return(yield s.send(n)).as(ye).name}))}setPushTemplate(t){return a(this,void 0,void 0,(function*(){g(Q(O,t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ie({userId:s.userId,templateName:t});return(yield n.send(r)).as(_e).name}))}blockUser(t){return a(this,void 0,void 0,(function*(){g(t instanceof P||p("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new ke({userId:s.userId,blockedUserId:t instanceof P?t.userId:t});yield n.send(r)}))}blockUserWithUserId(e){return a(this,void 0,void 0,(function*(){return this.blockUser(e)}))}unblockUser(t){return a(this,void 0,void 0,(function*(){g(t instanceof P||p("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new we({userId:s.userId,unblockedUserId:t instanceof P?t.userId:t});yield n.send(r)}))}unblockUserWithUserId(e){return a(this,void 0,void 0,(function*(){return this.unblockUser(e)}))}getFriendChangeLogsByToken(t){return a(this,void 0,void 0,(function*(){g(p("string",t,null)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ce({userId:s.userId,token:t}),i=yield n.send(r),{changelogs:o}=i.as(Se);return o}))}getAllowFriendDiscovery(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new Pe({userId:t.userId}),r=yield s.send(n),{allowFriendDiscovery:i}=r.as(Ue);return i}))}setAllowFriendDiscovery(t){return a(this,void 0,void 0,(function*(){g(p("boolean",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Te({userId:s.userId,allowFriendDiscovery:t});return yield n.send(r),t}))}uploadFriendDiscoveries(t){return a(this,void 0,void 0,(function*(){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ee({userId:s.userId,discoveries:t}),i=yield n.send(r),{friendDiscoveryRequestId:o}=i.as(Qe);return o}))}deleteFriendDiscovery(e){return a(this,void 0,void 0,(function*(){return this.deleteFriendDiscoveries([e])}))}deleteFriendDiscoveries(t){return a(this,void 0,void 0,(function*(){g(T("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new qe({userId:s.userId,discoveryKeys:t});yield n.send(r)}))}addFriends(t){return a(this,void 0,void 0,(function*(){g(T("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Me({userId:s.userId,userIds:t}),i=yield n.send(r),{users:o}=i.as(De);return o}))}deleteFriend(e){return a(this,void 0,void 0,(function*(){return this.deleteFriends([e])}))}deleteFriends(t){return a(this,void 0,void 0,(function*(){g(T("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Fe({userId:s.userId,userIds:t});yield n.send(r)}))}getAllEmoji(){return a(this,void 0,void 0,(function*(){const{requestQueue:t}=e.of(this._iid),s=new Ae,n=yield t.send(s),{emojiContainer:r}=n.as(Re);return r}))}getEmojiCategory(t){return a(this,void 0,void 0,(function*(){const{requestQueue:s}=e.of(this._iid),n=new He({categoryId:t}),r=yield s.send(n),{emojiCategory:i}=r.as(Oe);return i}))}getEmoji(t){return a(this,void 0,void 0,(function*(){const{requestQueue:s}=e.of(this._iid),n=new Ne({key:t}),r=yield s.send(n),{emoji:i}=r.as(je);return i}))}getUnreadItemCount(t){return a(this,void 0,void 0,(function*(){g(t instanceof N&&t.validate()).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Le({userId:s.userId,filter:t});return(yield n.send(r)).as(xe)}))}getTotalUnreadChannelCount(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ze({userId:t.userId}),r=yield s.send(n),{unreadCount:i}=r.as($e);return i}))}getTotalUnreadMessageCount(t){return a(this,void 0,void 0,(function*(){g(t instanceof j&&t.validate()).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Be({userId:s.userId,filter:t}),i=yield n.send(r),{unreadCount:o}=i.as(Ve);return o}))}getSubscribedTotalUnreadMessageCount(){const{subscribedUnreadMessageCount:t}=e.of(this._iid);return t.all>=0?t.all:0}getSubscribedCustomTypeTotalUnreadMessageCount(){let t=0;const{subscribedUnreadMessageCount:s}=e.of(this._iid);for(let e in s.customTypes)t+=s.customTypes[e];return t}getSubscribedCustomTypeUnreadMessageCount(t){var s;const{subscribedUnreadMessageCount:n}=e.of(this._iid);return null!==(s=n.customTypes[t])&&void 0!==s?s:0}}export{Ye as default};
