import{V as e,b2 as t,b3 as s,b4 as n,b5 as r,r as i,_ as a,b6 as d,u,b7 as c,b8 as l,b9 as h,o as f,ba as g,a3 as v,bb as b,i as p,bc as m,bd as y,be as I,bf as k,bg as _,aH as w,bh as S,U as P,bi as E,j as Q,bj as q,k as D,T as F,bk as A,bl as H,bm as R,bn as L,bo as O,bp as N,bq as j,br as x,bs as z}from"./bundle/bundle.shared.js";export{be as ApplicationUserListQuery,bt as BannedUserListQuery,bf as BlockedUserListQuery,C as ChannelType,bd as ConnectionHandler,b9 as ConnectionState,a0 as Emoji,Z as EmojiCategory,Y as EmojiContainer,bg as FriendListQuery,bu as LogLevel,bv as MutedUserListQuery,bw as OperatorListQuery,bx as Plugin,bp as PushTemplate,bj as PushTokenRegistrationState,T as PushTokenType,bm as PushTriggerOption,by as ReportCategory,bz as RestrictedUser,bA as RestrictionInfo,bB as RestrictionType,bC as Role,bs as SendbirdChatOptions,o as SendbirdError,bb as SessionHandler,br as TotalUnreadMessageCountParams,bq as UnreadItemCountParams,U as User,bc as UserEventHandler,bD as UserOnlineState,bi as UserUpdateParams}from"./bundle/bundle.shared.js";import{MessageModule as B}from"./message.js";import{O as V,m as $,U as G,a as W,R as K,b as J,c as X,d as ee,e as te,f as se,G as ne,g as re,S as ie,h as oe,i as ae,j as de,k as ue,l as ce,n as le,o as he,p as fe,q as ge,r as ve,s as pe,t as me,u as ye,v as Ie,w as ke,B as _e,x as we,y as Se,z as Ce,A as Ue,C as Pe,D as Te,E as Ee,F as Qe,H as qe,I as Me,J as De,K as Fe,L as Ae,M as He,N as Re,P as Le,Q as Oe,T as Ne,V as je,W as xe,X as ze,Y as Be,Z as Ve,_ as $e}from"./bundle/bundle.sendbird.js";import{I as Ge,A as We,M as Ke,N as Ye,a as Ze}from"./vendor/vendor.internal.js";export{M as MemoryStore}from"./vendor/vendor.internal.js";import"./bundle/bundle.message.js";let Je=null;class Xe{constructor(o,u,c){this._appState="foreground",this._fcmPushToken=null,this._apnsPushToken=null,this._iid=o,this.options=u;const{sdkState:l,cacheContext:h,connectionManager:f,dispatcher:g,sessionManager:v,requestQueue:b,logger:p,userEventHandlers:m}=e.of(o);c.forEach((e=>{e.init(o,{sdkState:l,cacheContext:h,dispatcher:g,sessionManager:v,requestQueue:b}),this[e.name]=e})),this._onlineDetector=new V({logger:p,connectionDelegate:{reconnect:()=>{"foreground"===l.appState&&f.reconnect()},disconnect:()=>f.disconnect()}}),g.on((u=>{if(u instanceof t)switch(u.code){case"USEV":{const{event:e}=u.as(s);switch(e.category){case n.FRIEND_DISCOVERED:{const{friendDiscoveries:t}=r.getDataAsFriendDiscoveredEvent(o,e);i((()=>a(this,void 0,void 0,(function*(){return m.forEach((e=>{e.onFriendsDiscovered(t)}))}))));break}}break}}else if(u instanceof d){const{subscribedUnreadMessageCount:t}=e.of(this._iid);let s=!1;const n=u.ts;if("number"==typeof n&&n>t.ts){if(t.all!==u.all&&(s=!0),t.all=u.all>=0?u.all:0,u.customTypes)for(const e in u.customTypes)t.customTypes[e]!==u.customTypes[e]&&(s=!0),t.customTypes[e]=u.customTypes[e];s=s&&t.ts>0,t.ts=n}s&&i((()=>a(this,void 0,void 0,(function*(){return m.forEach((e=>{e.onTotalUnreadMessageCountUpdated(t.all,t.customTypes)}))}))))}}))}static init(t){const{appId:s,appVersion:n=null,modules:r=[],options:i=new z,debugMode:o=!1,customApiHost:a,customWebSocketHost:d,newInstance:c=!1,logLevel:l,localCacheEnabled:h=!1,localCacheEncryption:f={encrypt:e=>e,decrypt:e=>e},useAsyncStorageStore:g=null}=t;if(!Je||c){const t=`su-${u()}`,c=f;let v=new Ke({encryption:c});o||(v=g?new We({AsyncStorage:g,encryption:c}):new Ge({encryption:c})),new e(t,{appId:s,appVersion:n,options:i,apiHost:null!=a?a:`https://api-${s}.sendbird.com`,websocketHost:null!=d?d:`wss://ws-${s}.sendbird.com`,store:v,encryption:c,logLevel:l,localCacheEnabled:h,debugMode:o});const b=new Xe(t,i,[...r,new B]);return Je||(Je=b),b}}static get instance(){return Je}static get version(){return c}get appId(){const{sdkState:t}=e.of(this._iid);return t.appId}get appVersion(){var t;const{sdkState:s}=e.of(this._iid);return null!==(t=s.appVersion)&&void 0!==t?t:""}get debugMode(){const{debugMode:t}=e.of(this._iid);return t}get logLevel(){const{logger:t}=e.of(this._iid);return t.level}set logLevel(t){const{logger:s}=e.of(this._iid);s.level=t}get isCacheEnabled(){const{cacheContext:t}=e.of(this._iid);return t.localCacheEnabled}get ekey(){return l(this._iid)}get currentUser(){var t;const{sessionManager:s}=e.of(this._iid);return null!==(t=s.currentUser)&&void 0!==t?t:null}get connectionState(){const{connectionManager:t}=e.of(this._iid);return t.isConnected?h.OPEN:t.isConnecting?h.CONNECTING:h.CLOSED}get lastConnectedAt(){const{connectedAt:t,connectionManager:s}=e.of(this._iid);return s.isConnected?t:0}get fcmPushToken(){return this._fcmPushToken}get apnsPushToken(){return this._apnsPushToken}getMemoryStoreForDebugging(){const{debugMode:t,cacheContext:s}=e.of(this._iid);if(t)return s.store instanceof Ke?s.store:null;throw f.debugModeRequired}addExtension(t,s){const{sdkState:n}=e.of(this._iid);["sb_uikit","sb_syncmanager"].indexOf(t)>-1&&(n.extensions[t]=s)}initializeCache(t){return a(this,void 0,void 0,(function*(){const{sdkState:s,cacheContext:n,connectionManager:r,dispatcher:i}=e.of(this._iid);if((!s.userId||s.userId!==t)&&(yield r.logout(),s.userId=t,n.localCacheEnabled)){const e=`sendbird@${s.appId}/${t}.db`;if(!n.nestdb||n.nestdb.state===Ye.CLOSED||n.nestdb.name!==e){const e=n.nestdb=new Ze({name:`sendbird@${s.appId}/${t}.db`,version:1,store:n.store});e.on("upgrade",$(e)),yield e.open(),i.dispatch(new g(this._iid,{userId:t}))}}}))}clearCache(){return a(this,void 0,void 0,(function*(){const{cacheContext:t}=e.of(this._iid);t.localCacheEnabled&&t.nestdb&&(t.nestdb.close(),yield t.nestdb.reset())}))}connect(t,s=null){return a(this,void 0,void 0,(function*(){const{connectionManager:n}=e.of(this._iid);try{yield this.initializeCache(t)}catch(t){const{cacheContext:s,logger:n}=e.of(this._iid);s.localCacheEnabled=!1,n.warn("Cache initialization failed - cache is not available.")}return this._onlineDetector.start(),yield n.connect(s),this.currentUser}))}reconnect(){const{connectionManager:t,sessionManager:s}=e.of(this._iid),n=s.auth.hasSession;return n&&t.reconnect().catch((()=>{})),n}disconnect(){return a(this,void 0,void 0,(function*(){const{connectionManager:t,cacheContext:s,requestQueue:n}=e.of(this._iid);this._onlineDetector.stop(),n.cancelAll(),yield t.logout(),s.localCacheEnabled&&(yield this.clearCache())}))}setBackgroundState(){const{connectionManager:t,sdkState:s,logger:n}=e.of(this._iid);"foreground"===s.appState&&(s.appState="background",n.debug("going background state"),t.background())}setForegroundState(){const{connectionManager:t,sdkState:s,logger:n}=e.of(this._iid);"background"===s.appState&&(s.appState="foreground",n.debug("going foreground state"),t.reconnect())}setSessionHandler(t){v(t instanceof b).throw(f.invalidParameters);const{sessionManager:s}=e.of(this._iid);s.handler=t}addUserEventHandler(t,s){v(p("string",t)&&s instanceof m).throw(f.invalidParameters);const{userEventHandlers:n}=e.of(this._iid);n.set(t,s)}removeUserEventHandler(t){const{userEventHandlers:s}=e.of(this._iid);s.delete(t)}removeAllUserEventHandler(){const{userEventHandlers:t}=e.of(this._iid);t.clear()}addConnectionHandler(t,s){v(p("string",t)&&s instanceof y).throw(f.invalidParameters);const{connectionHandlers:n}=e.of(this._iid);n.set(t,s)}removeConnectionHandler(t){const{connectionHandlers:s}=e.of(this._iid);s.delete(t)}removeAllConnectionHandler(){const{connectionHandlers:t}=e.of(this._iid);t.clear()}createApplicationUserListQuery(e={}){return new I(this._iid,e)}createBlockedUserListQuery(e={}){return new k(this._iid,e)}createFriendListQuery(e={}){return new _(this._iid,e)}createMessageSearchQuery(e){return new w(this._iid,e)}buildUserFromSerializedData(e){const t=S(e);return new P(this._iid,P.payloadify(t))}updateCurrentUserInfo(t){return a(this,void 0,void 0,(function*(){if(v(t instanceof E&&t.validate()).throw(f.invalidParameters),this.currentUser){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new G(Object.assign({userId:s.userId},t)),i=yield n.send(r),{user:o}=i.as(W);return this.currentUser&&(t.nickname&&(this.currentUser.nickname=o.nickname),(t.profileUrl||t.profileImage)&&(this.currentUser.plainProfileUrl=o.profileUrl)),o}throw f.connectionRequired}))}updateCurrentUserInfoWithPreferredLanguages(t){return a(this,void 0,void 0,(function*(){if(v(Q("string",t)).throw(f.invalidParameters),this.currentUser){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new G({userId:s.userId,preferredLanguages:t}),i=yield n.send(r),{user:o}=i.as(W);return this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),o}throw f.connectionRequired}))}registerFCMPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(v(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,q.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new K({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",q.SUCCESS}catch(e){return q.ERROR}}))}unregisterFCMPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(v(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,q.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new J({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",q.SUCCESS}catch(e){return q.ERROR}}))}unregisterFCMPushTokenAllForCurrentUser(){return a(this,void 0,void 0,(function*(){if(this.currentUser){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new X({userId:t.userId});yield s.send(n)}}))}registerAPNSPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(v(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,q.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new ee({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",q.SUCCESS}catch(e){return q.ERROR}}))}unregisterAPNSPushTokenForCurrentUser(t){return a(this,void 0,void 0,(function*(){if(v(p("string",t)).throw(f.invalidParameters),!this.currentUser)return this._fcmPushToken=t,q.PENDING;try{const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new te({userId:s.userId,token:t});return yield n.send(r),this._fcmPushToken="",q.SUCCESS}catch(e){return q.ERROR}}))}unregisterAPNSPushTokenAllForCurrentUser(){return a(this,void 0,void 0,(function*(){if(this.currentUser){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new se({userId:t.userId});yield s.send(n)}}))}getChannelInvitationPreference(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ne({userId:t.userId}),r=yield s.send(n),{autoAccept:i}=r.as(re);return{autoAccept:i}}))}setChannelInvitationPreference(t){return a(this,void 0,void 0,(function*(){v(p("boolean",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new ie({userId:s.userId,willAutoAccept:t}),i=yield n.send(r),{autoAccept:o}=i.as(oe);return{autoAccept:o}}))}getDoNotDisturb(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ae({userId:t.userId}),r=yield s.send(n),{preference:i}=r.as(de);return i}))}setDoNotDisturb(t,s=0,n=0,r=0,i=0,o=""){return a(this,void 0,void 0,(function*(){v(p("boolean",t)&&p("number",s)&&p("number",n)&&p("number",r)&&p("number",i)&&p("string",o)).throw(f.invalidParameters);const{sdkState:a,requestQueue:d}=e.of(this._iid),u=new ue({userId:a.userId,doNotDisturbOn:t,startHour:s,startMin:n,endHour:r,endMin:i,timezone:o}),c=yield d.send(u),{preference:l}=c.as(ce);return l}))}getSnoozePeriod(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new le({userId:t.userId}),r=yield s.send(n),{snoozePeriod:i}=r.as(he);return i}))}setSnoozePeriod(t,s=0,n=0){return a(this,void 0,void 0,(function*(){v(p("boolean",t)&&p("number",s)&&p("number",n)).throw(f.invalidParameters);const{sdkState:r,requestQueue:i}=e.of(this._iid),o=new fe({userId:r.userId,snoozeOn:t,startTs:s,endTs:n}),a=yield i.send(o),{snoozePeriod:d}=a.as(ge);return d}))}getMyPushTokensByToken(t,s){return a(this,void 0,void 0,(function*(){v(p("string",t)&&D(F,s)).throw(f.invalidParameters);const{sdkState:n,requestQueue:r}=e.of(this._iid),i=new ve({userId:n.userId,type:s,token:t}),o=yield r.send(i),{pushTokens:a}=o.as(pe);return a}))}getPushTriggerOption(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new A({userId:t.userId});return(yield s.send(n)).as(H).pushTriggerOption}))}setPushTriggerOption(t){return a(this,void 0,void 0,(function*(){v(D(R,t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new L({userId:s.userId,pushTriggerOption:t});return(yield n.send(r)).as(O).pushTriggerOption}))}getPushTemplate(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new me({userId:t.userId});return(yield s.send(n)).as(ye).name}))}setPushTemplate(t){return a(this,void 0,void 0,(function*(){v(D(N,t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ie({userId:s.userId,templateName:t});return(yield n.send(r)).as(ke).name}))}blockUser(t){return a(this,void 0,void 0,(function*(){v(t instanceof P||p("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new _e({userId:s.userId,blockedUserId:t instanceof P?t.userId:t});yield n.send(r)}))}blockUserWithUserId(e){return a(this,void 0,void 0,(function*(){return this.blockUser(e)}))}unblockUser(t){return a(this,void 0,void 0,(function*(){v(t instanceof P||p("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new we({userId:s.userId,unblockedUserId:t instanceof P?t.userId:t});yield n.send(r)}))}unblockUserWithUserId(e){return a(this,void 0,void 0,(function*(){return this.unblockUser(e)}))}getFriendChangeLogsByToken(t){return a(this,void 0,void 0,(function*(){v(p("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Se({userId:s.userId,token:t}),i=yield n.send(r),{changelogs:o}=i.as(Ce);return o}))}getAllowFriendDiscovery(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new Ue({userId:t.userId}),r=yield s.send(n),{allowFriendDiscovery:i}=r.as(Pe);return i}))}setAllowFriendDiscovery(t){return a(this,void 0,void 0,(function*(){v(p("boolean",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Te({userId:s.userId,allowFriendDiscovery:t});return yield n.send(r),t}))}uploadFriendDiscoveries(t){return a(this,void 0,void 0,(function*(){const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ee({userId:s.userId,discoveries:t}),i=yield n.send(r),{friendDiscoveryRequestId:o}=i.as(Qe);return o}))}deleteFriendDiscovery(e){return a(this,void 0,void 0,(function*(){return this.deleteFriendDiscoveries([e])}))}deleteFriendDiscoveries(t){return a(this,void 0,void 0,(function*(){v(Q("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new qe({userId:s.userId,discoveryKeys:t});yield n.send(r)}))}addFriends(t){return a(this,void 0,void 0,(function*(){v(Q("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Me({userId:s.userId,userIds:t}),i=yield n.send(r),{users:o}=i.as(De);return o}))}deleteFriend(e){return a(this,void 0,void 0,(function*(){return this.deleteFriends([e])}))}deleteFriends(t){return a(this,void 0,void 0,(function*(){v(Q("string",t)).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Fe({userId:s.userId,userIds:t});yield n.send(r)}))}getAllEmoji(){return a(this,void 0,void 0,(function*(){const{requestQueue:t}=e.of(this._iid),s=new Ae,n=yield t.send(s),{emojiContainer:r}=n.as(He);return r}))}getEmojiCategory(t){return a(this,void 0,void 0,(function*(){const{requestQueue:s}=e.of(this._iid),n=new Re({categoryId:t}),r=yield s.send(n),{emojiCategory:i}=r.as(Le);return i}))}getEmoji(t){return a(this,void 0,void 0,(function*(){const{requestQueue:s}=e.of(this._iid),n=new Oe({key:t}),r=yield s.send(n),{emoji:i}=r.as(Ne);return i}))}getUnreadItemCount(t){return a(this,void 0,void 0,(function*(){v(t instanceof j&&t.validate()).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new je({userId:s.userId,filter:t});return(yield n.send(r)).as(xe)}))}getTotalUnreadChannelCount(){return a(this,void 0,void 0,(function*(){const{sdkState:t,requestQueue:s}=e.of(this._iid),n=new ze({userId:t.userId}),r=yield s.send(n),{unreadCount:i}=r.as(Be);return i}))}getTotalUnreadMessageCount(t){return a(this,void 0,void 0,(function*(){v(t instanceof x&&t.validate()).throw(f.invalidParameters);const{sdkState:s,requestQueue:n}=e.of(this._iid),r=new Ve({userId:s.userId,filter:t}),i=yield n.send(r),{unreadCount:o}=i.as($e);return o}))}getSubscribedTotalUnreadMessageCount(){const{subscribedUnreadMessageCount:t}=e.of(this._iid);return t.all>=0?t.all:0}getSubscribedCustomTypeTotalUnreadMessageCount(){let t=0;const{subscribedUnreadMessageCount:s}=e.of(this._iid);for(let e in s.customTypes)t+=s.customTypes[e];return t}getSubscribedCustomTypeUnreadMessageCount(t){var s;const{subscribedUnreadMessageCount:n}=e.of(this._iid);return null!==(s=n.customTypes[t])&&void 0!==s?s:0}}export{Xe as default};
