import{D as e}from"../vendor/vendor.internal.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function t(e,t,s,n){return new(s||(s=Promise))((function(i,a){function r(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((n=n.apply(e,t||[])).next())}))}var s,n="4.0.0";class i{static get OS_VERSION(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}static get SDK_VERSION(){return"4.0.0"}static get SDK_MAJOR_VERSION(){return i.SDK_VERSION.split(".")[0]}static get DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL(){return 100}static get INTERNAL_CALL(){return"ic"}}!function(e){e[e.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",e[e.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(s||(s={}));const a=e=>!(e instanceof r&&!e.shouldThrowOutside);class r extends Error{constructor({code:e=0,message:t}){super(t),this.shouldThrowOutside=!1,this.name="SendbirdError",this.code=e,Object.setPrototypeOf(this,r.prototype)}get isSessionTokenExpiredError(){return this.code===s.SESSION_TOKEN_EXPIRED}get isSessionKeyExpiredError(){return this.code===s.SESSION_KEY_EXPIRED}static get debugModeRequired(){return new r({code:s.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}static get lostInstance(){return new r({code:s.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}static get invalidConnectionStateTransition(){return new r({code:s.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}static get connectionRequired(){return new r({code:s.CONNECTION_REQUIRED,message:"Connection is required."})}static get connectionCanceled(){return new r({code:s.CONNECTION_CANCELED,message:"Connection is canceled."})}static get invalidParameters(){return new r({code:s.INVALID_PARAMETER,message:"Invalid parameters."})}static get networkError(){return new r({code:s.NETWORK_ERROR,message:"There was a network error."})}static get markAsReadAllRateLimitExceeded(){return new r({code:s.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}static get queryInProgress(){return new r({code:s.QUERY_IN_PROGRESS,message:"Query in progress."})}static get noAckTimeout(){return new r({code:s.ACK_TIMEOUT,message:"Command received no ack."})}static get loginTimeout(){return new r({code:s.LOGIN_TIMEOUT,message:"Connection timeout."})}static get connectionClosed(){return new r({code:s.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}static get requestFailed(){return new r({code:s.REQUEST_FAILED,message:"Request failed."})}static get fileUploadCanceled(){return new r({code:s.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}static get requestCanceled(){return new r({code:s.REQUEST_CANCELED,message:"Request has been canceled."})}static get sessionTokenRefreshFailed(){return new r({code:s.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}static get sessionTokenRequestFailed(){return new r({code:s.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}throwOutside(){throw this.shouldThrowOutside=!0,this}}const o=[s.CONNECTION_REQUIRED,s.NETWORK_ERROR,s.ACK_TIMEOUT,s.WEBSOCKET_CONNECTION_CLOSED,s.WEBSOCKET_CONNECTION_FAILED,s.FILE_UPLOAD_CANCEL_FAILED,s.REQUEST_CANCELED,s.INTERNAL_SERVER_ERROR,s.RATE_LIMIT_EXCEEDED,s.UNKNOWN_SERVER_ERROR],l=(e,t)=>{if(e!==t){const s=Object.assign({},e),n=Object.assign({},t);return(!s.hasOwnProperty("messageId")||!n.hasOwnProperty("messageId")||s.messageId===n.messageId)&&((!s.hasOwnProperty("reqId")||!n.hasOwnProperty("reqId")||s.reqId===n.reqId)&&(s.hasOwnProperty("messageId")&&delete s.messageId,s.hasOwnProperty("reqId")&&delete s.reqId,n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,JSON.stringify(s)===JSON.stringify(n)))}return!0},h=(e,t,s=!1)=>!(!s||null!=t)||("string"==typeof e?typeof t===e:c(e,t)),c=(e,t)=>Object.values(e).includes(t),d=(e,t,s=!1)=>!(!s||null!=t)||Array.isArray(t)&&t.every((t=>h(e,t))),u=(e,t=!1)=>{if(t&&null===e)return!0;const s=h("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!s){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return s};class _{constructor(){this._useMemberAsMessageSender=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4}get useMemberAsMessageSender(){return this._useMemberAsMessageSender}set useMemberAsMessageSender(e){h("boolean",e)&&(this._useMemberAsMessageSender=e)}get typingIndicatorInvalidateTime(){return this._typingIndicatorInvalidateTime}set typingIndicatorInvalidateTime(e){h("number",e)&&(this._typingIndicatorInvalidateTime=e)}get typingIndicatorThrottle(){return this._typingIndicatorThrottle}set typingIndicatorThrottle(e){h("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}get websocketResponseTimeout(){return this._websocketResponseTimeout}set websocketResponseTimeout(e){h("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}}class p{constructor({encryption:t=null,store:s=null,localCacheEnabled:n=!0}){this.nestdb=null,this.store=s,this.encryption=null!=t?t:e,this.localCacheEnabled=n}}class m{constructor(){this.sessionKey=null,this.authToken=null}get hasSession(){return!!this.sessionKey}clear(){this.authToken=null,this.sessionKey=null}}const E=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}))};class g{constructor({container:e}){this._container={},this._container=e,this.key=E()}_register(e,t,s){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:s}),this}on(e,t){return this._register(e,-1,t)}once(e,t){return this._register(e,1,t)}close(){for(const e in this._container)this._container[e].delete(this.key)}}class y{constructor(){this._container={}}on(e,t){return new g({container:this._container}).on(e,t)}once(e,t){return new g({container:this._container}).once(e,t)}dispatch(e,t){const s=this._container[e];if(s){const e=[];for(const n of s.keys()){const i=s.get(n);i.handler(t),i.occurence>0&&(i.occurence--,0===i.occurence&&e.push(n))}e.forEach((e=>s.delete(e)))}}}class v{constructor(){this._dispatcher=new y}on(e){return this._dispatcher.on("event",e)}once(e){return this._dispatcher.once("event",e)}dispatch(e){this._dispatcher.dispatch("event",e)}}class f{}const C=e=>{const t={};return e&&Object.keys(e).forEach((s=>{void 0!==e[s]&&NaN!==e[s]&&null!==e[s]&&(t[s]=e[s])})),t};var N;!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(N||(N={}));class T extends f{constructor(){super(...arguments),this.params={},this.requireAuth=!0,this.headers={},this.requestId=E()}stringifyParams(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""}get query(){const e=C(this.params);return`?${Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(this.stringifyParams(e[t]))}`)).join("&")}`}get payload(){const e=C(this.params);if(Object.keys(e).some((t=>u(e[t])))){const t=new FormData;return Object.keys(e).forEach((s=>{var n;if(e[s]instanceof Blob){const i=e[s];t.append(s,i,null!==(n=i.name)&&void 0!==n?n:"filename")}else t.append(s,this.stringifyParams(e[s]))})),t}return JSON.stringify(e)}}class I extends f{constructor(e,t){super(),this._iid=e,this._payload=t}get payload(){return Object.assign({},this._payload)}as(e){return new e(this._iid,this.payload)}}class S extends f{}class A extends f{constructor(e){super(),this.requestId=e}}class U{constructor(e,{auth:t,sdkState:s,dispatcher:n}){this._abortControl=new Map,this._iid=e,this._auth=t,this._sdkState=s,this._dispatcher=n,this._dispatcher.on((e=>{e instanceof A&&this.cancel(e.requestId)}))}get _userAgentWithExtension(){const{extensions:e}=this._sdkState,t=e.sb_syncmanager?`s${e.sb_syncmanager}`:"",s=e.sb_uikit?`u${e.sb_uikit}`:"";return`JS/c${i.SDK_VERSION}/${t}/${s}`}_createHeader(e,t=null){const{appId:s,appVersion:n}=this._sdkState,a=Object.assign(Object.assign({},e.headers),{SendBird:`JS,${i.OS_VERSION},${i.SDK_VERSION},${s}${n?`,${n}`:""}`,"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=s,a["Access-Token"]=this._auth.authToken),a}send(e){return t(this,void 0,void 0,(function*(){const{path:t,method:s}=e,n=![N.GET,N.DELETE].includes(s),{api:i}=this._sdkState,a=`${i.host}${t}${n?"":e.query}`,o=n?e.payload:null,l=this._createHeader(e,o instanceof FormData?o:null),h=new AbortController,{signal:c}=h;this._abortControl.set(e.requestId,h);try{const e=yield fetch(a,{method:s,body:o,headers:l,signal:c}),t=yield e.json();if(e.ok||e.redirected)return new I(this._iid,t);if(t){const e=new r(t);throw e.isSessionKeyExpiredError&&this._dispatcher.dispatch(new S),e}throw r.requestFailed}catch(e){throw e instanceof r?e:"AbortError"===e.name?r.requestCanceled:r.networkError}}))}cancel(e){if(this._abortControl.has(e)){this._abortControl.get(e).abort(),this._abortControl.delete(e)}}cancelAll(){for(const e of this._abortControl.values())e.abort();this._abortControl.clear()}}class M extends f{constructor(e,t,s,n=""){var i;super(),this._iid=e,this.code=t,this.payload=s,this.requestId=s?null!==(i=s.req_id)&&void 0!==i?i:n:""}static createFromRawMessage(e,t){let s=t.substring(0,4),n=null;try{n=JSON.parse(t.substring(4))}catch(e){s="NOOP"}finally{return new M(e,s,n)}}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}as(e){return new e(this._iid,this.code,this.payload)}}class b extends f{constructor({code:e,ackRequired:t,payload:s=null}){var n;super(),this.code=e,this.payload=s,this.requestId=null!==(n=this.payload.req_id)&&void 0!==n?n:E(),this.ackRequired=t,this.payload.req_id=this.requestId}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}}class w extends b{constructor(){super({code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}}class D{constructor({pingDelegate:e,sdkState:t}){this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=e,this.sdkState=t}get isWaiting(){return!!this._pingTimeoutTimer}ping(){var e;const t=new w;try{const s=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((()=>{this.stop(),this.pingDelegate.error(null)}),s),this.pingDelegate.send(t)}catch(e){this.stop(),this.pingDelegate.error(null)}return t}pong(){this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}refreshTimer(){var e;const t=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((()=>{this.ping()}),t)}start(){this.refreshTimer(),this.ping()}stop(){this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}}const R=()=>{};var O,L;!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(O||(O={}));class k extends y{constructor(e,{sdkState:t,dispatcher:s}){super(),this._pinger=null,this.lastActive=0,this._iid=e,this._sdkState=t,this._dispatcher=s,this._sdkState.websocket.pingerDisabled||(this._pinger=new D({pingDelegate:{send:e=>this.send(e),error:e=>this.error(e)},sdkState:this._sdkState}))}get connectionState(){if(this._ws)switch(this._ws.readyState){case 0:return O.CONNECTING;case 1:return O.OPEN}return O.CLOSED}connect(e){this._ws=new WebSocket(e),this._ws.onopen=()=>{this.dispatch("open")},this._ws.onmessage=e=>{e.data.split("\n").forEach((e=>{if(e&&h("string",e)){const t=M.createFromRawMessage(this._iid,e);"LOGI"===t.code?(t.payload&&!t.payload.error&&this._pinger&&this._pinger.start(),this.dispatch("message",t)):"PONG"===t.code?this._pinger&&this._pinger.pong():"EXPR"===t.code?t.payload&&t.payload.expires_in>0&&this._dispatcher.dispatch(new S):"NOOP"===t.code||this.dispatch("message",t)}}))},this._ws.onerror=()=>{this._pinger&&this._pinger.stop(),this.dispatch("error",r.networkError)},this._ws.onclose=()=>{this._pinger&&this._pinger.stop(),this.dispatch("close")},this.lastActive=Date.now()}disconnect(){this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=R,this._ws.onmessage=R,this._ws.onerror=R,this._ws.onclose=()=>{this.dispatch("close")},this._ws.close(),this._ws=null)}send(e){if(!this._ws)throw r.connectionClosed;"PING"!==e.code&&this._pinger&&this._pinger.refreshTimer(),this._ws.send(e.convertToMessage())}error(e){this._pinger&&this._pinger.stop(),this.dispatch("error",e)}}class x extends f{constructor({all:e,custom_types:t,ts:s}){super(),this.all=e,this.customTypes=t,this.ts=s}}class P{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class F{constructor(e,{auth:t,sdkState:s,dispatcher:n}){this._ackStateMap=new Map,this._sdkState=s,this._dispatcher=n,this.apiClient=new U(e,{auth:t,sdkState:s,dispatcher:n}),this.websocketClient=new k(e,{sdkState:s,dispatcher:n}),this.websocketClient.on("message",(e=>{if(e.payload.unread_cnt&&this._dispatcher.dispatch(new x(e.payload.unread_cnt)),e.requestId){if(this._ackStateMap.has(e.requestId)){this._ackStateMap.get(e.requestId).resolve(e)}}else this._dispatcher.dispatch(e)})).on("close",(()=>{this._ackStateMap.forEach((e=>{e.reject(r.connectionClosed)})),this._ackStateMap.clear()}))}_sendApiRequest(e){return t(this,void 0,void 0,(function*(){return yield this.apiClient.send(e)}))}_sendWebsocketRequest(e){return t(this,void 0,void 0,(function*(){const t=new P;if(e.ackRequired){let s=null;const n=(n=null,i=null)=>{this._ackStateMap.has(e.requestId)&&(this._ackStateMap.delete(e.requestId),s&&(clearTimeout(s),s=null),n?t.reject(n):t.resolve(i))};try{s=setTimeout((()=>n(r.noAckTimeout)),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:e=>n(null,e),reject:e=>n(e)}),this.websocketClient.send(e)}catch(e){n(e)}}else try{this.websocketClient.send(e),t.resolve(null)}catch(e){t.reject(e)}return t.promise}))}send(e){return t(this,void 0,void 0,(function*(){if(e instanceof T)return yield this._sendApiRequest(e);if(e instanceof b)return yield this._sendWebsocketRequest(e);throw r.invalidParameters}))}cancel(e){this.apiClient.cancel(e)}cancelAll(){this.apiClient.cancelAll()}}!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT"}(L||(L={}));class H extends f{constructor({stateType:e}){super(),this.stateType=e}}class q{constructor(e,{auth:s,sdkState:n,dispatcher:i}){this._currentConnectionStateType=L.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new F(e,{auth:s,sdkState:n,dispatcher:i}),this._auth=s,this._dispatcher=i,this._dispatcher.on((e=>{if(e instanceof H){const{stateType:s}=e;switch(this._currentConnectionStateType=s,s){case L.CONNECTED:{const e=this._lazyCallQueue;this._lazyCallQueue=[],e.forEach((e=>t(this,void 0,void 0,(function*(){const{command:t,deferred:s}=e;try{const e=yield this.send(t);s.resolve(e)}catch(e){s.reject(e)}}))));break}case L.INITIALIZED:case L.DISCONNECTED:case L.LOGOUT:{const e=this._lazyCallQueue;this._lazyCallQueue=[],e.forEach((e=>t(this,void 0,void 0,(function*(){const{deferred:t}=e;t.reject(r.connectionRequired)}))));break}}}}))}get isReady(){return this._currentConnectionStateType===L.CONNECTED}get isLazyCallActivated(){return this._currentConnectionStateType===L.CONNECTING||this._currentConnectionStateType===L.RECONNECTING}send(e){return t(this,void 0,void 0,(function*(){if(e instanceof b){if(this.isReady)return yield this.commandRouter.send(e);if(this.isLazyCallActivated){const t=new P;return this._lazyCallQueue.push({command:e,deferred:t}),t.promise}throw r.connectionRequired}if(e instanceof T){if(this._auth.hasSession)return yield this.commandRouter.send(e);if(this.isLazyCallActivated){const t=new P;return this._lazyCallQueue.push({command:e,deferred:t}),t.promise}throw r.connectionRequired}}))}forceSend(e){return t(this,void 0,void 0,(function*(){return yield this.commandRouter.send(e)}))}cancel(e){this.commandRouter.cancel(e)}cancelAll(){this.commandRouter.cancelAll()}}class G extends T{constructor({userId:e,authToken:t,expiringSession:s=!0}){super(),this.path=`/users/${e}/session_key`,this.method=N.POST,this.params={token:t,expiring_session:s?1:0},this.requireAuth=!1}}class V extends b{constructor({authToken:e,expiringSession:t=!0}){super({code:"LOGI",payload:{token:e,expiring_session:t?1:0},ackRequired:!0})}}class j extends I{constructor(e,t){super(e,t);const{key:s}=t;this.key=s}}class Q extends M{constructor(e,t,s){super(e,"LOGI",s),this.error=null,this.newKey=s.new_key,this.error=s.error?new r(s.error):null}}class $ extends f{}const K=e=>t(void 0,void 0,void 0,(function*(){return new Promise((t=>setTimeout(t,e)))}));class B{calcTimeout(){return 0}}const z=(e,s,n=new B)=>t(void 0,void 0,void 0,(function*(){let t=0,i=null;const a=(e=null)=>i=null!=e?e:new Error("Halted");for(;-1===s||t<s;)try{const t=yield e(a);if(i)throw i;return t}catch(e){if(i)throw i;if(t++,t===s)throw e;yield K(n.calcTimeout(t))}})),W=e=>t(void 0,void 0,void 0,(function*(){try{yield e()}catch(e){if(!(e instanceof r))throw e;e.throwOutside()}})),Y=e=>t(void 0,void 0,void 0,(function*(){try{yield e()}catch(e){}}));class J{constructor({auth:e,sdkState:t,dispatcher:s,requestQueue:n}){this._currentConnectionStateType=L.INITIALIZED,this.auth=e,this._sdkState=t,this._dispatcher=s,this._requestQueue=n,this._dispatcher.on((e=>{if(e instanceof H){const{stateType:t}=e;this._currentConnectionStateType=t}else e instanceof S&&this.refresh()}))}createRefreshWebsocketCommand(e){return new V({authToken:e,expiringSession:!0})}_refreshSessionKey(e,s){return t(this,void 0,void 0,(function*(){if(this._currentConnectionStateType===L.CONNECTED)try{const n=this.createRefreshWebsocketCommand(e),i=yield this._requestQueue.forceSend(n),{newKey:a,error:r}=i.as(Q);if(r)throw r;return this.auth.sessionKey=null!=a?a:this.auth.sessionKey,W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionRefreshed()})))),void(s&&s.resolve())}catch(e){if(a(e))throw e;if(e.isSessionTokenExpiredError)return void this._handleError(s)}try{const s=new G({userId:this._sdkState.userId,authToken:e,expiringSession:!0});yield z((e=>t(this,void 0,void 0,(function*(){try{const e=yield this._requestQueue.forceSend(s),{key:t}=e.as(j);this.auth.sessionKey=t}catch(t){throw t.isSessionTokenExpiredError&&e(r.sessionTokenRefreshFailed),t}}))),3)}catch(e){return void this._handleError(s)}W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionRefreshed()})))),s&&s.resolve()}))}_handleError(e){const s=r.sessionTokenRefreshFailed;W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionError(s)})))),e&&e.reject(s)}refresh(){return t(this,void 0,void 0,(function*(){if(this.handler){const e=new P,s=s=>{s?(this.auth.authToken=s,this._refreshSessionKey(s,e)):(W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionClosed()})))),e.resolve())},n=()=>{this._dispatcher.dispatch(new $);const s=r.sessionTokenRequestFailed;this.handler&&(W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionError(s)})))),e.reject(s))};return this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,e):W((()=>t(this,void 0,void 0,(function*(){this.handler.onSessionTokenRequired(s,n)})))),e.promise}}))}}class X{constructor(){this.type=L.NONE}run(e){return t(this,void 0,void 0,(function*(){}))}onConnect(e,s){return t(this,void 0,void 0,(function*(){}))}onReconnect(e){return t(this,void 0,void 0,(function*(){}))}onDisconnect(e,{error:s=null,autoReconnect:n=!1}){return t(this,void 0,void 0,(function*(){}))}onLogout(e){return t(this,void 0,void 0,(function*(){}))}}class Z extends X{constructor(){super(...arguments),this.type=L.LOGOUT}run(e){return t(this,void 0,void 0,(function*(){const s=e.sdkState.userId;e.logout(),W((()=>t(this,void 0,void 0,(function*(){e.connectionHandlers.forEach((e=>{e.onDisconnected(s)}))})))),yield e.changeState(new ie)}))}}class ee extends X{constructor({autoReconnect:e}){super(),this.type=L.DISCONNECTED,this._autoReconnect=!1,this._autoReconnect=e}run(e){return t(this,void 0,void 0,(function*(){e.disconnect(),this._autoReconnect&&(yield e.changeState(new te))}))}onConnect(e,s){return t(this,void 0,void 0,(function*(){e.disconnect(),yield e.changeState(new ne({authToken:s}))}))}onReconnect(e){return t(this,void 0,void 0,(function*(){yield e.changeState(new te)}))}onLogout(e){return t(this,void 0,void 0,(function*(){yield e.changeState(new Z)}))}}class te extends X{constructor(){super(...arguments),this.type=L.RECONNECTING,this._haltConnect=null,this._callbacks=[]}flushCallbacks(e=null){this._callbacks.forEach((t=>t(e)))}run(e){return t(this,void 0,void 0,(function*(){const n=new P;this._callbacks.push((e=>e?n.reject(e):n.resolve()));let i=null;W((()=>t(this,void 0,void 0,(function*(){e.connectionHandlers.forEach((e=>{e.onReconnectStarted()}))}))));try{const{reconnectMaxRetry:n,reconnectRetryStrategy:a}=e.sdkState.websocket;yield z((n=>t(this,void 0,void 0,(function*(){this._haltConnect=n;try{yield e.connect()}catch(e){if(e instanceof r&&e.code===s.CONNECTION_CANCELED)return void n(e);throw e}}))),n,a),yield e.changeState(new se)}catch(t){if(a(t))throw t;i=t,yield e.changeState(new ee({autoReconnect:!1}))}finally{W((()=>t(this,void 0,void 0,(function*(){e.connectionHandlers.forEach((e=>{i?e.onReconnectFailed():e.onReconnectSucceeded()})),this.flushCallbacks(i)}))))}return n.promise}))}onConnect(e,s){return t(this,void 0,void 0,(function*(){const e=new P;return this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onReconnect(e){return t(this,void 0,void 0,(function*(){const e=new P;return this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(e,{error:s=null,autoReconnect:n=!0}){return t(this,void 0,void 0,(function*(){this._haltConnect&&this._haltConnect(null!=s?s:r.connectionCanceled),yield e.changeState(new ee({autoReconnect:n}))}))}onLogout(e){return t(this,void 0,void 0,(function*(){this._haltConnect&&this._haltConnect(r.connectionCanceled),yield e.changeState(new Z)}))}}class se extends X{constructor(){super(...arguments),this.type=L.CONNECTED}onReconnect(e){return t(this,void 0,void 0,(function*(){e.disconnect(),yield e.changeState(new te)}))}onDisconnect(e,{autoReconnect:s}){return t(this,void 0,void 0,(function*(){yield e.changeState(new ee({autoReconnect:s}))}))}onLogout(e){return t(this,void 0,void 0,(function*(){yield e.changeState(new Z)}))}}class ne extends X{constructor({authToken:e}){super(),this.type=L.CONNECTING,this._authToken="",this._haltConnect=null,this._callbacks=[],this._authToken=e}flushCallbacks(e=null){this._callbacks.forEach((t=>t(e)))}run(e){return t(this,void 0,void 0,(function*(){const n=new P;this._callbacks.push((e=>e?n.reject(e):n.resolve()));let i=null;try{yield z((n=>t(this,void 0,void 0,(function*(){this._haltConnect=n;try{yield e.connect(this._authToken)}catch(e){if(e instanceof r&&e.code===s.CONNECTION_CANCELED)return void n(e);throw e}}))),e.sdkState.websocket.connectMaxRetry),yield e.changeState(new se)}catch(t){if(a(t))throw t;i=t,e.disconnect(),yield e.changeState(new ie)}finally{W((()=>t(this,void 0,void 0,(function*(){i||e.connectionHandlers.forEach((t=>{t.onConnected(e.sdkState.userId)})),this.flushCallbacks(i)}))))}return n.promise}))}onConnect(e){return t(this,void 0,void 0,(function*(){const e=new P;return this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(e,{error:s=null}){return t(this,void 0,void 0,(function*(){this._haltConnect&&this._haltConnect(null!=s?s:r.connectionCanceled),yield e.changeState(new Z)}))}onLogout(e){return t(this,void 0,void 0,(function*(){this._haltConnect&&this._haltConnect(r.connectionCanceled),yield e.changeState(new Z)}))}}class ie extends X{constructor(){super(...arguments),this.type=L.INITIALIZED}onConnect(e,s){return t(this,void 0,void 0,(function*(){yield e.changeState(new ne({authToken:s}))}))}}class ae{constructor(e={}){this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]}}const re=new Map,oe=(e,t=null)=>{var s;return null!==t&&re.set(e,t),null!==(s=re.get(e))&&void 0!==s?s:""};class le{constructor(e){this._iid="",this._iid=e}static payloadify(e){return e?C({_iid:e._iid}):null}}const he="/v3/users",ce="/v3/emojis",de="/v3/emoji_categories";class ue extends T{constructor({userId:e,metadata:t}){super(),this.method=N.POST,this.path=`/v3/users/${e}/metadata`,this.params={metadata:t}}}var _e,pe,me,Ee,ge,ye,ve,fe;!function(e){e.BASE="base",e.GROUP="group",e.OPEN="open"}(_e||(_e={})),function(e){e.OPERATOR="operator",e.NONE="none"}(pe||(pe={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(me||(me={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(Ee||(Ee={})),function(e){e.USERS="users",e.CHANNEL="channel"}(ge||(ge={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(ye||(ye={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(ve||(ve={})),function(e){e.PENDING="pending",e.FAILED="failed",e.CANCELED="canceled",e.SUCCEEDED="succeeded"}(fe||(fe={}));const Ce=e=>{switch(e){case _e.GROUP:return"/v3/group_channels";case _e.OPEN:return"/v3/open_channels";default:return null}},Ne=e=>{switch(e){case _e.GROUP:return"/v3/report/group_channels";case _e.OPEN:return"/v3/report/open_channels";default:return null}},Te=(e,t,s)=>{switch(e){case ge.CHANNEL:return!0;case ge.USERS:for(const e of t)if(e===s)return!0}return!1},Ie=(e,t,s)=>{const n=Te(e.mentionType,e.mentionedUserIds,s),i=Te(t.mentionType,t.mentionedUserIds,s);return!n&&i?1:n&&!i?-1:0};class Se extends T{constructor(e){const{channelUrl:t,channelType:s,metadata:n}=e;super(),this.method=N.POST,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metadata`,this.params={metadata:n,include_ts:!0}}}class Ae extends I{constructor(e,t){super(e,t),this.metaData=null!=t?t:{}}}class Ue extends T{constructor({userId:e,metadata:t,upsert:s}){super(),this.method=N.PUT,this.path=`/v3/users/${e}/metadata`,this.params={metadata:t,upsert:s}}}class Me extends I{constructor(e,t){super(e,t),this.metadata=t}}class be extends T{constructor({userId:e,metadataKey:t}){super(),this.method=N.DELETE,this.path=`/v3/users/${e}/metadata/${t}`}}class we extends T{constructor({userId:e}){super(),this.method=N.DELETE,this.path=`/v3/users/${e}/metadata`}}const De=(e,t=null)=>{let s=JSON.parse(JSON.stringify(e));return t&&t(s),s},Re=(e,t=null)=>{const s=JSON.parse(JSON.stringify(e));return t&&t(s),s},Oe=e=>({do:t=>{e||t()},throw:t=>{if(!e)throw t}});var Le;!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(Le||(Le={}));class ke extends le{constructor(e,t){var s,n,i,a,r,o,l,d,u,_,p,m;super(e),this.userId=null!==(n=null!==(s=t.guest_id)&&void 0!==s?s:t.user_id)&&void 0!==n?n:"",this.nickname=null!==(a=null!==(i=t.nickname)&&void 0!==i?i:t.name)&&void 0!==a?a:"",this.plainProfileUrl=null!==(o=null!==(r=t.profile_url)&&void 0!==r?r:t.image)&&void 0!==o?o:"",this.requireAuth=null!==(l=t.require_auth_for_profile_image)&&void 0!==l&&l,this.metaData=null!==(d=t.metadata)&&void 0!==d?d:{},this.connectionStatus=Le.NON_AVAILABLE,c(Le,t.is_online)?this.connectionStatus=t.is_online:h("boolean",t.is_online)&&(this.connectionStatus=t.is_online?Le.ONLINE:Le.OFFLINE),this.isActive=null===(u=t.is_active)||void 0===u||u,this.lastSeenAt=null!==(_=t.last_seen_at)&&void 0!==_?_:null,this.preferredLanguages=t.preferred_languages?[...t.preferred_languages]:null,this.friendDiscoveryKey=null!==(p=t.friend_discovery_key)&&void 0!==p?p:null,this.friendName=null!==(m=t.friend_name)&&void 0!==m?m:null}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null}get profileUrl(){return this.requireAuth?`${this.plainProfileUrl}?auth=${oe(this._iid)}`:this.plainProfileUrl}serialize(){return De(this)}_isValidMetaData(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((t=>e[t])).every((e=>h("string",e)))}_applyMetaData(e,t=!1){Object.keys(e).forEach((s=>{t?delete this.metaData[s]:this.metaData[s]=e[s]}))}createMetaData(e){return t(this,void 0,void 0,(function*(){Oe(this._isValidMetaData(e)).throw(r.invalidParameters);const{sdkState:t,requestQueue:s}=Ve.of(this._iid),n=new ue({userId:t.userId,metadata:e}),i=yield s.send(n),{metaData:a}=i.as(Ae);return this._applyMetaData(a),this.metaData}))}updateMetaData(e,s=!1){return t(this,void 0,void 0,(function*(){Oe(this._isValidMetaData(e)).throw(r.invalidParameters);const{sdkState:t,requestQueue:n}=Ve.of(this._iid),i=new Ue({userId:t.userId,metadata:e,upsert:s}),a=yield n.send(i),{metadata:o}=a.as(Me);return this._applyMetaData(o),this.metaData}))}deleteMetaData(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{sdkState:t,requestQueue:s}=Ve.of(this._iid),n=new be({userId:t.userId,metadataKey:e});return yield s.send(n),this._applyMetaData({[e]:!0},!0),this.metaData}))}deleteAllMetaData(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new we({userId:e.userId});yield t.send(s),this.metaData={}}))}}class xe extends M{constructor(e,t,s){var n,i,a,o,l,h,c,d,u,_,p;super(e,t,s),this.pingInterval=15e3,this.pongTimeout=5e3,this.reconnectInterval=3e3,this.reconnectMaxInterval=6e4,this.reconnectRetryCount=5,this.reconnectIntervalMultiple=2,this.error=null,this.appInfo=new ae(s),this.user=new ke(e,s),this.key=s.key,this.ekey=null!==(n=s.ekey)&&void 0!==n?n:"",this.connectedAt=1e3*(null!==(i=s.login_ts)&&void 0!==i?i:0),this.pingInterval=null!==(a=s.ping_interval)&&void 0!==a?a:15e3,this.pongTimeout=null!==(o=s.pong_timeout)&&void 0!==o?o:5e3,s.reconnect&&(this.reconnectInterval=null!==(l=s.reconnect.interval)&&void 0!==l?l:3e3,this.reconnectMaxInterval=null!==(h=s.reconnect.max_interval)&&void 0!==h?h:6e4,this.reconnectRetryCount=null!==(c=s.reconnect.retry_cnt)&&void 0!==c?c:5,this.reconnectIntervalMultiple=null!==(d=s.reconnect.mul)&&void 0!==d?d:2),this.maxUnreadCountOnSuperGroup=null!==(u=s.max_unread_cnt_on_super_group)&&void 0!==u?u:100,this.profileImageEncryption=s.profile_image_encryption,this.concurrentCallLimit=null!==(_=s.concurrent_call_limit)&&void 0!==_?_:5,this.backOffDelay=null!==(p=s.back_off_delay)&&void 0!==p?p:100,this.error=s.error?new r(s):null}static asError(e){return new xe(null,"LOGI",Object.assign({user_id:null,error:!0},e))}applyTo(e){if(this.error)throw this.error;{const t=Ve.of(e);if(!t)throw r.lostInstance;{t.sessionManager.auth.sessionKey=this.key,oe(e,this.ekey),t.sdkState.websocket.pingInterval=1e3*this.pingInterval,t.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,t.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,t.sdkState.websocket.reconnectRetryStrategy={calcTimeout:e=>e>0?Math.min(s*Math.pow(i,e-1),n):10},t.appInfo=this.appInfo,t.sessionManager.currentUser=this.user;const s=this.reconnectInterval,n=this.reconnectMaxInterval,i=this.reconnectIntervalMultiple;t.connectedAt=this.connectedAt,t.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,t.concurrentCallLimit=this.concurrentCallLimit,t.backOffDelay=this.backOffDelay}}}}class Pe extends y{constructor(e,{sdkState:t,connectionHandlers:s,sessionManager:n,websocketClient:i,dispatcher:a,entryState:r=new ie}){super(),this._currentState=null,this._iid=e,this.sdkState=t,this.connectionHandlers=s,this._sessionManager=n,this._websocketClient=i,this._dispatcher=a,this._currentState=r}get currentState(){return this._currentState}changeState(e){return t(this,void 0,void 0,(function*(){this._currentState=e,this._dispatcher.dispatch(new H({stateType:e.type})),yield this._currentState.run(this)}))}_url(e=""){const{appId:t,appVersion:s,userId:n}=this.sdkState,{auth:a}=this._sessionManager;return`${this.sdkState.websocket.host}/?p=JS&pv=${encodeURIComponent(i.OS_VERSION)}&sv=${encodeURIComponent(i.SDK_VERSION)}&ai=${t}${s?`&av=${s}`:""}${a.hasSession?`&key=${encodeURIComponent(a.sessionKey)}`:`&user_id=${encodeURIComponent(n)}&access_token=${encodeURIComponent(e)}`}&active=1&SB-User-Agent=FIXME&Request-Sent-Timestamp=${Date.now().toString()}&include_extra_data=${encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))}${this._sessionManager.handler?"&expiring_session=1":""}&use_local_cache=1`}connect(e=""){return t(this,void 0,void 0,(function*(){const t=this._url(e),s=new P;let n=setTimeout((()=>{n=null,this._dispatcher.dispatch(xe.asError(r.loginTimeout))}),this.sdkState.websocket.responseTimeout);const i=this._websocketClient.on("message",(e=>{if("LOGI"===e.code){i.close(),n&&(clearTimeout(n),n=null);const t=e.as(xe);t.error?(t.error.isSessionKeyExpiredError&&this._dispatcher.dispatch(new S),s.reject(t.error)):(t.applyTo(this._iid),s.resolve())}})).on("close",(()=>{i.close(),s.reject(r.networkError)}));return this._websocketClient.connect(t),s.promise}))}disconnect(){this._websocketClient.disconnect()}logout(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()}}class Fe{constructor(e,{sdkState:t,connectionHandlers:s,sessionManager:n,websocketClient:i,dispatcher:a}){this._context=null,this._context=new Pe(e,{sdkState:t,connectionHandlers:s,sessionManager:n,websocketClient:i,dispatcher:a})}get isConnected(){const{currentState:e}=this._context;return e.type===L.CONNECTED}get isConnecting(){const{currentState:e}=this._context;return e.type===L.CONNECTING||e.type===L.RECONNECTING}connect(e){return t(this,void 0,void 0,(function*(){const{currentState:t}=this._context;yield t.onConnect(this._context,e)}))}reconnect(){return t(this,void 0,void 0,(function*(){const{currentState:e}=this._context;yield e.onReconnect(this._context)}))}background(){return t(this,void 0,void 0,(function*(){const{currentState:e}=this._context;yield e.onDisconnect(this._context,{autoReconnect:!1})}))}disconnect(e=null){return t(this,void 0,void 0,(function*(){const{currentState:t}=this._context;yield t.onDisconnect(this._context,{error:e,autoReconnect:!0})}))}logout(){return t(this,void 0,void 0,(function*(){const{currentState:e}=this._context;yield e.onLogout(this._context)}))}}var He;!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR"}(He||(He={}));class qe{constructor(){this.level=He.WARN}verbose(...e){this.level<=He.VERBOSE&&console.log("[verbose]",...e)}debug(...e){this.level<=He.DEBUG&&console.debug("[debug]",...e)}info(...e){this.level<=He.INFO&&console.info("[info]",...e)}warn(...e){this.level<=He.WARN&&console.warn("[warn]",...e)}error(...e){this.level<=He.ERROR&&console.error("[error]",...e)}}const Ge={};class Ve{constructor(e,t){var s,n,a,r,o,l;if(this.connectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Ge[e]){Ge[e]=this;const h=null!==(s=t.options)&&void 0!==s?s:new _,c=this.sdkState={appId:t.appId,appVersion:null!==(n=t.appVersion)&&void 0!==n?n:"",userId:null,extensions:{},api:{host:null!==(a=t.apiHost)&&void 0!==a?a:`https://api-${t.appId}.sendbird.com`},websocket:{host:null!==(r=t.websocketHost)&&void 0!==r?r:`wss://ws-${t.appId}.sendbird.com`,pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new B,responseTimeout:h.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0},this.logger=new qe,this.logger.level=null!==(o=t.logLevel)&&void 0!==o?o:He.WARN,this.connectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new p({encryption:t.encryption,store:t.store,localCacheEnabled:t.localCacheEnabled}),this.debugMode=null!==(l=t.debugMode)&&void 0!==l&&l,this.maxSuperGroupChannelUnreadCount=i.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberAsMessageSender=h.useMemberAsMessageSender,this.typingIndicatorInvalidateTime=h.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=h.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;const d=this.dispatcher=new v,u=new m;this.requestQueue=new q(e,{auth:u,sdkState:c,dispatcher:d}),this.sessionManager=new J({auth:u,sdkState:c,dispatcher:d,requestQueue:this.requestQueue}),this.connectionManager=new Fe(e,{sdkState:c,connectionHandlers:this.connectionHandlers,dispatcher:d,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient})}return Ge[e]}static of(e){if(Ge[e])return Ge[e];throw r.lostInstance}}var je,Qe,$e,Ke,Be;!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(je||(je={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(Qe||(Qe={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}($e||($e={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(Ke||(Ke={}));class ze{init(e,{sdkState:t,dispatcher:s,sessionManager:n,requestQueue:i,cacheContext:a=null}){this._iid=e,this._cacheContext=a,this._sdkState=t,this._dispatcher=s,this._sessionManager=n,this._requestQueue=i}}class We extends T{constructor(e){if(super(),this.method=N.POST,this.path="/v3/storage/file",this.params=C({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(let t=0;t<e.thumbnailSizes.length;t++){const{maxWidth:s,maxHeight:n}=e.thumbnailSizes[t];this.params[`thumbnail${t+1}`]=`${s},${n}`}this.requestId=e.requestId}}class Ye extends I{constructor(e,t){var s,n,i;super(e,t),this.url=t.url,this.fileSize=null!==(s=t.file_size)&&void 0!==s?s:0,this.thumbnailSizes=null!==(n=t.thumbnails)&&void 0!==n?n:[],this.requireAuth=null!==(i=t.require_auth)&&void 0!==i&&i}}class Je extends class{constructor(){this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageTypeFilter=Ee.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.includeReactions=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return h("number",this.prevResultSize)&&h("number",this.nextResultSize)&&h("boolean",this.isInclusive)&&h("boolean",this.reverse)&&h("string",this.messageTypeFilter)&&c(Ee,this.messageTypeFilter)&&d("string",this.customTypesFilter,!0)&&d("string",this.senderUserIdsFilter,!0)&&h("boolean",this.includeMetaArray)&&h("boolean",this.includeReactions)&&h("boolean",this.includeParentMessageInfo)}}class Xe extends le{constructor(e,t){var s,n,i;super(e),this.replyCount=0,this.mostRepliedUsers=null,this.lastRepliedAt=0,this.updatedAt=0,this.replyCount=null!==(s=t.reply_count)&&void 0!==s?s:0,this.mostRepliedUsers=t.hasOwnProperty("most_replies")&&d("object",t.most_replies)?t.most_replies.map((e=>new ke(this._iid,e))):[],this.lastRepliedAt=null!==(n=t.last_replied_at)&&void 0!==n?n:0,this.updatedAt=null!==(i=t.updated_at)&&void 0!==i?i:0}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((e=>ke.payloadify(e))):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null}}!function(e){e.ADD="add",e.DELETE="delete"}(Be||(Be={}));class Ze{constructor(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;const t=h("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,s=e.user_id,n=e.operation?e.operation.toLowerCase():null,i=e.reaction,a=e.updated_at;t&&h("string",s)&&h("string",n)&&c(Be,n)&&h("string",i)&&i&&h("number",a)&&(this.messageId=t,this.userId=s,this.key=i,this.operation=n,this.updatedAt=a)}}class et{constructor(e){var t;const s=e.key,n=null!==(t=[...e.user_ids])&&void 0!==t?t:[],i=e.updated_at;h("string",s)&&s&&d("string",n)&&n.length>0&&h("number",i)&&(this.key=s,this.userIds=n,this.updatedAt=i);const a={};for(const e of this.userIds)a[e]=this.updatedAt;this._version=a}get isEmpty(){return 0===this.userIds.length}static payloadify(e){return e?C({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null}applyEvent(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){const t=this.userIds.indexOf(e.userId);switch(e.operation){case Be.ADD:t<0&&this.userIds.push(e.userId);break;case Be.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}}}class tt{constructor(e){this.key=e.key,this.value=d("string",e.value)?[...e.value]:[]}static payloadify(e){var t;return e?C({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null}}class st{constructor(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}static payloadify(e){var t,s;return e?C({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(s=e.height)&&void 0!==s?s:0,alt:e.alt}):null}}class nt{constructor(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new st(e["og:image"]))}static payloadify(e){return e?C({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?st.payloadify(e.defaultImage):null}):null}}class it{constructor(e){var t,s;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(s=e.volume)&&void 0!==s?s:1}static payloadify(e){return e?C({name:e.name,volume:e.volume}):null}}const at=e=>{switch(e){case me.BASE:return"";case me.USER:return"MESG";case me.FILE:return"FILE";case me.ADMIN:return"ADMM"}};class rt extends le{constructor(e,t){var s,n,i,a,r,o,l,h,d,u,_,p;super(e),this.channelUrl=null,this.channelType=_e.BASE,this.messageId=0,this.parentMessageId=null,this.silent=!1,this.isOperatorMessage=!1,this.messageType=me.BASE,this.data=null,this.customType=null,this.mentionType=null,this.mentionedUsers=[],this.threadInfo=null,this.reactions=[],this.metaArrays=[],this.ogMetaData=null,this.appleCriticalAlertOptions=null,this.createdAt=0,this.updatedAt=0,this.messageId=null!==(n=null!==(s=t.msg_id)&&void 0!==s?s:t.message_id)&&void 0!==n?n:0,this.channelUrl=t.channel_url,this.channelType=c(_e,t.channel_type)?t.channel_type:_e.GROUP,t.channel&&(t.channel.channel_url&&(this.channelUrl=t.channel.channel_url),t.channel.channel_type&&(this.channelType=t.channel.channel_type)),this.parentMessageId=null!==(i=t.parent_message_id)&&void 0!==i?i:0,this.data=null!==(a=t.data)&&void 0!==a?a:"",this.customType=null!==(r=t.custom_type)&&void 0!==r?r:"",this.mentionType=c(ge,t.mention_type)?t.mention_type:null,this.mentionedUsers=t.mentioned_users?t.mentioned_users.map((e=>new ke(this._iid,e))):[],this.threadInfo=t.thread_info?new Xe(this._iid,t.thread_info):null,this.reactions=t.reactions?t.reactions.map((e=>new et(e))):[];const m=null!==(o=t.metaarray)&&void 0!==o?o:{},E=null!==(l=t.metaarray_key_order)&&void 0!==l?l:Object.keys(m).sort(((e,t)=>e.localeCompare(t)));for(let e=0;e<E.length;e++){const t=E[e];this.metaArrays.push(new tt({key:t,value:m[t]||[]}))}t.sorted_metaarray&&(this.metaArrays=t.sorted_metaarray.map((e=>new tt(e)))),this.ogMetaData=t.og_tag?new nt(t.og_tag):null,this.silent=null!==(h=t.silent)&&void 0!==h&&h,this.isOperatorMessage=null!==(d=t.is_op_msg)&&void 0!==d&&d,this.appleCriticalAlertOptions=t.apple_critical_alert_options?new it(t.apple_critical_alert_options):null,this.createdAt=null!==(_=null!==(u=t.created_at)&&void 0!==u?u:t.ts)&&void 0!==_?_:0,this.updatedAt=null!==(p=t.updated_at)&&void 0!==p?p:0}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:at(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_users:e.mentionedUsers.map((e=>ke.payloadify(e))),thread_info:e.threadInfo?Xe.payloadify(e.threadInfo):null,reactions:e.reactions.map((e=>et.payloadify(e))),sorted_metaarray:e.metaArrays.map((e=>tt.payloadify(e))),og_tag:nt.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:it.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt})):null}isIdentical(e){return this.messageId===e.messageId}isEqual(e){return l(this,e)}get isUserMessage(){return this.messageType===me.USER}get isFileMessage(){return this.messageType===me.FILE}get isAdminMessage(){return this.messageType===me.ADMIN}serialize(){return De(this)}getMetaArraysByKeys(e){return this.metaArrays.filter((t=>e.includes(t.key)))}applyThreadInfoUpdateEvent(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1}applyReactionEvent(e){if(this.messageId===e.messageId){let t=!1;for(let s=0;s<this.reactions.length;s++)if(this.reactions[s].key===e.key){this.reactions[s].applyEvent(e),this.reactions[s].isEmpty&&this.reactions.splice(s,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new et(et.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}}}class ot extends ke{constructor(e,t){super(e,t),this.role=null,this.isBlockedByMe=!1,this.role=c(pe,t.role)?t.role:pe.NONE,t.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=t.is_blocked_by_me)}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null}}class lt extends rt{constructor(e,t){var s,n,i;super(e,t),this.sender=null,this.reqId="",this.requestState=fe.PENDING,this.requestedMentionUserIds=[],this.errorCode=0,this.sender=new ot(this._iid,t.user),this.reqId=null!==(s=t.req_id)&&void 0!==s?s:"",this.requestState=this.messageId>0?fe.SUCCEEDED:fe.FAILED,t.request_state&&c(fe,t.request_state)&&(this.requestState=t.request_state),this.requestedMentionUserIds=null!==(n=t.requested_mention_user_ids)&&void 0!==n?n:[],this.errorCode=null!==(i=t.error_code)&&void 0!==i?i:0}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{user:ot.payloadify(e.sender),req_id:e.reqId,request_state:e.requestState,requested_mention_user_ids:e.requestedMentionUserIds,error_code:e.errorCode})):null}get isResendable(){return this.requestState===fe.FAILED&&((e=this.errorCode)>0&&o.indexOf(e)>=0);var e}isIdentical(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}class ht{constructor(e){var t,s;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(s=e.real_height)&&void 0!==s?s:e.height}static payloadify(e){return e?C({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null}get plainUrl(){return this.url.split("?auth=")[0]}}class ct extends lt{constructor(e,t){var s,n,i,a,r,o,l,h,c,d,u,_,p;super(e,t),this.plainUrl="",this.requireAuth=!1,this.name=null,this.size=0,this.type=null,this.thumbnails=[],this.messageSurvivalSeconds=-1,this.messageType=me.FILE;const m=null!==(s=t.file)&&void 0!==s?s:{};this.plainUrl=(null!==(i=null!==(n=m.url)&&void 0!==n?n:t.url)&&void 0!==i?i:"").split("?auth=")[0],this.name=null!==(r=null!==(a=m.name)&&void 0!==a?a:t.name)&&void 0!==r?r:"File",this.size=null!==(l=null!==(o=m.size)&&void 0!==o?o:t.size)&&void 0!==l?l:0,this.type=null!==(c=null!==(h=m.type)&&void 0!==h?h:t.type)&&void 0!==c?c:"",this.data=null!==(u=null!==(d=m.data)&&void 0!==d?d:t.custom)&&void 0!==u?u:"",this.requireAuth=null!==(_=t.require_auth)&&void 0!==_&&_,this.thumbnails=t.thumbnails?t.thumbnails.map((e=>new ht(Object.assign(Object.assign({},e),{url:`${e.url.split("?auth=")[0]}${this.requireAuth?`?auth=${oe(this._iid)}`:""}`})))):[],this.messageSurvivalSeconds=null!==(p=t.message_survival_seconds)&&void 0!==p?p:-1}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map((e=>({url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}))),message_survival_seconds:e.messageSurvivalSeconds})):null}get url(){return this.requireAuth?`${this.plainUrl}?auth=${oe(this._iid)}`:this.plainUrl}getThreadedMessagesByTimestamp(e,s){return t(this,void 0,void 0,(function*(){Oe(this.messageId>0&&h("number",e)&&s instanceof Je&&s.validate()).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getThreadedMessagesByTimestamp(this,e,s)}))}}class dt extends b{constructor(e){var t,s,n;super({code:"FILE",ackRequired:!0,payload:C({channel_url:e.channelUrl,url:e.url,name:null!==(t=e.fileName)&&void 0!==t?t:"",type:null!==(s=e.mimeType)&&void 0!==s?s:"",size:null!==(n=e.fileSize)&&void 0!==n?n:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:e.mentionType===ge.USERS?e.mentionedUserIds:[],push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==ve.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,req_id:e.reqId})})}}class ut extends T{constructor(e){super(),this.method=N.POST,this.path=`${Ce(e.channelType)}/${encodeURIComponent(e.channelUrl)}/messages`,this.params=C({message_type:me.FILE,user_id:e.userId,url:e.file,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes.map((e=>ht.payloadify(e))),require_auth:e.requireAuth,sorted_metaarray:e.metaArrays.map((e=>tt.payloadify(e))),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,apple_critical_alert_options:it.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,req_id:e.reqId})}}class _t extends M{constructor(e,t,s){var n;super(e,"FILE",s),this.message=new ct(e,s);const{sdkState:i}=Ve.of(e);this.isMentioned=Te(this.message.mentionType,this.message.mentionedUsers.map((e=>e.userId)),i.userId),this.forceUpdateLastMessage=null!==(n=s.force_update_last_message)&&void 0!==n&&n}}class pt extends I{constructor(e,t){var s;super(e,t),this.message=new ct(e,t);const{sdkState:n}=Ve.of(e);this.isMentioned=Te(this.message.mentionType,this.message.mentionedUsers.map((e=>e.userId)),n.userId),this.forceUpdateLastMessage=null!==(s=t.force_update_last_message)&&void 0!==s&&s}}var mt,Et;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(mt||(mt={}));class gt{constructor({sdkState:e,dispatcher:t,requestQueue:s}){this._queueMap=new Map,this._isConnected=!1,this._sdkState=e,this._requestQueue=s,this._dispatcher=t,this._dispatcher.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)this._isConnected=!0;else this._isConnected=!1}))}_sendFileMessage(e,s){return t(this,void 0,void 0,(function*(){if(this._isConnected){const t=new dt(Object.assign(Object.assign({channelUrl:e.url,channelType:e.channelType,url:s.params.file,requireAuth:s.requireAuth},s.params),{reqId:s.requestId})),n=yield this._requestQueue.send(t),{message:i}=n.as(_t);return i}{const t=new ut(Object.assign(Object.assign({channelUrl:e.url,channelType:e.channelType,url:s.params.file,userId:this._sdkState.userId,requireAuth:s.requireAuth},s.params),{reqId:s.requestId})),n=yield this._requestQueue.send(t),{message:i}=n.as(pt);return i}}))}_resolveMessageQueue(e){return t(this,void 0,void 0,(function*(){const t=this._queueMap.get(e.url);if(t)if(t.isResolving)t.isResolveRequestPending=!0;else{t.isResolving=!0;const n=[];let i=!0;for(const a of t.messageQueue)switch(a.state){case mt.PENDING:case mt.UPLOADING:i=!1,n.push(a);break;case mt.UPLOADED:if(i)try{a.state=mt.SENDING;const t=yield this._sendFileMessage(e,a);a.deferred.resolve(t),yield K(100)}catch(e){a.deferred.reject(e)}else n.push(a);break;case mt.FAILED:a.deferred.reject(a.error.code===s.REQUEST_CANCELED?r.fileUploadCanceled:a.error)}const a=t.isResolveRequestPending;t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,a&&(yield this._resolveMessageQueue(e))}}))}_uploadNextPendingItem(e){return t(this,void 0,void 0,(function*(){const t=this._queueMap.get(e.url),s=t.messageQueue.find((e=>e.state===mt.PENDING));if(s)if(u(s.params.file)){if(t.uploadQueue.length<6){s.state=mt.UPLOADING,t.uploadQueue.push(s);try{const n=new We({file:s.params.file,channelUrl:e.url,thumbnailSizes:s.params.thumbnailSizes,requestId:s.requestId}),i=yield this._requestQueue.send(n),{url:a,fileSize:r=s.params.fileSize,thumbnailSizes:o=s.params.thumbnailSizes,requireAuth:l=!1}=i.as(Ye);s.params.fileUrl=a,s.params.fileSize=r,s.params.thumbnailSizes=o,s.requireAuth=l,s.state=mt.UPLOADED}catch(e){s.state=mt.FAILED,s.error=e}finally{const n=t.uploadQueue.findIndex((e=>e.requestId===s.requestId));n>=0&&(t.uploadQueue.splice(n,1),this._uploadNextPendingItem(e)),yield this._resolveMessageQueue(e)}}}else s.params.thumbnailSizes=[],s.state=mt.UPLOADED,yield this._resolveMessageQueue(e)}))}request(e,s,n){return t(this,void 0,void 0,(function*(){const t=new P;this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1});return this._queueMap.get(e.url).messageQueue.push({requestId:s,params:n,state:mt.PENDING,deferred:t}),this._uploadNextPendingItem(e),t.promise}))}cancel(e,t=null){const s=this._queueMap.get(e.url);if(s){const n=t?[s.messageQueue.find((e=>e.requestId===t))]:[...s.messageQueue];for(const t of n)if(t)switch(t.state){case mt.PENDING:t.state=mt.FAILED,t.error=r.requestCanceled,this._resolveMessageQueue(e);break;case mt.UPLOADING:this._requestQueue.cancel(t.requestId)}}}}class yt{constructor(e){var t,s;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(s=e.vendor)&&void 0!==s?s:"",e.hasOwnProperty("detail")&&h("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}static payloadify(e){return e?C({type:e.type,vendor:e.vendor,detail:e.detail}):null}}class vt extends lt{constructor(e,t){var s,n;super(e,t),this.message="",this.translations={},this.messageSurvivalSeconds=-1,this.plugins=[],this.message=t.message,this.messageType=me.USER,this.translations=null!==(s=t.translations)&&void 0!==s?s:{},this.messageSurvivalSeconds=null!==(n=t.message_survival_seconds)&&void 0!==n?n:-1,this.plugins=t.plugins?t.plugins.map((e=>new yt(e))):[]}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((e=>yt.payloadify(e)))})):null}getThreadedMessagesByTimestamp(e,s){return t(this,void 0,void 0,(function*(){Oe(this.messageId>0&&h("number",e)&&s instanceof Je&&s.validate()).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getThreadedMessagesByTimestamp(this,e,s)}))}}class ft extends rt{constructor(e,t){var s,n;super(e,t),this.message=null,this.translations={},this.message=null!==(s=t.message)&&void 0!==s?s:"",this.messageType=me.ADMIN,this.translations=null!==(n=t.translations)&&void 0!==n?n:{}}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{message:e.message,translations:e.translations})):null}getThreadedMessagesByTimestamp(e,s){return t(this,void 0,void 0,(function*(){Oe(this.messageId>0&&h("number",e)&&s instanceof Je&&s.validate()).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getThreadedMessagesByTimestamp(this,e,s)}))}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.EVENT_MESSAGE_SENT_SUCCESS=1]="EVENT_MESSAGE_SENT_SUCCESS",e[e.EVENT_MESSAGE_SENT_FAILED=2]="EVENT_MESSAGE_SENT_FAILED",e[e.EVENT_MESSAGE_SENT_PENDING=3]="EVENT_MESSAGE_SENT_PENDING",e[e.EVENT_MESSAGE_RECEIVED=4]="EVENT_MESSAGE_RECEIVED",e[e.EVENT_MESSAGE_UPDATED=5]="EVENT_MESSAGE_UPDATED",e[e.EVENT_MESSAGE_DELETED=6]="EVENT_MESSAGE_DELETED",e[e.EVENT_MESSAGE_READ=7]="EVENT_MESSAGE_READ",e[e.EVENT_MESSAGE_DELIVERED=8]="EVENT_MESSAGE_DELIVERED",e[e.EVENT_MESSAGE_REACTION_UPDATED=9]="EVENT_MESSAGE_REACTION_UPDATED",e[e.EVENT_MESSAGE_THREADINFO_UPDATED=10]="EVENT_MESSAGE_THREADINFO_UPDATED",e[e.EVENT_BOTTOM=11]="EVENT_BOTTOM",e[e.REQUEST_MESSAGE=12]="REQUEST_MESSAGE",e[e.REQUEST_THREADED_MESSAGE=13]="REQUEST_THREADED_MESSAGE",e[e.REQUEST_MESSAGE_CHANGELOGS=14]="REQUEST_MESSAGE_CHANGELOGS",e[e.SYNC_MESSAGE_FILL=15]="SYNC_MESSAGE_FILL",e[e.SYNC_MESSAGE_BACKGROUND=16]="SYNC_MESSAGE_BACKGROUND",e[e.SYNC_MESSAGE_CHANGELOGS=17]="SYNC_MESSAGE_CHANGELOGS"}(Et||(Et={}));const Ct=e=>e<Et.EVENT_BOTTOM||e===Et.SYNC_MESSAGE_FILL||e===Et.SYNC_MESSAGE_CHANGELOGS;class Nt extends f{constructor({messages:e,source:t}){super(),this.messages=e,this.source=t}}class Tt extends f{constructor({messageIds:e,source:t}){super(),this.messageIds=e,this.source=t}}class It extends f{constructor({reqId:e,source:t}){super(),this.reqId=e,this.source=t}}const St=e=>{if(e)switch(e.messageType){case me.USER:return vt.payloadify(e);case me.FILE:return ct.payloadify(e);case me.ADMIN:return ft.payloadify(e)}return null},At=(e,t)=>{switch(t.type){case"MESG":return new vt(e,t);case"FILE":return new ct(e,t);case"ADMM":case"BRDM":return new ft(e,t)}return null};class Ut extends T{constructor({channelType:e,channelUrl:t,messageId:s,includeMetaArray:n,includeReactions:i,includeThreadInfo:a,includeParentMessageInfo:r,includePollDetails:o}){super(),this.method=N.GET,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages/${encodeURIComponent(s)}`,this.params={is_sdk:!0,with_sorted_meta_array:n,include_reactions:i,include_thread_info:a,include_parent_message_info:r,include_poll_details:o}}}class Mt extends I{constructor(e,t){super(e,t),this.message=t?At(e,Object.assign({},t)):null}}class bt extends T{constructor({channelType:e,channelUrl:t,timestamp:s=null,token:n=null,prevResultSize:i,nextResultSize:a,isInclusive:r,reverse:o,messageTypeFilter:l,customTypesFilter:h,senderUserIdsFilter:c,includeMetaArray:d,includeReactions:u,parentMessageId:_,includeThreadInfo:p,replyType:m,includeParentMessageInfo:E,showSubchannelMessagesOnly:g,includePollDetails:y}){super(),this.method=N.GET,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages`,this.params=C({is_sdk:!0,prev_limit:i,next_limit:a,include:r,reverse:o,message_ts:s,message_id:n,message_type:l,custom_types:h,sender_ids:c,with_sorted_meta_array:d,include_reactions:u,parent_message_id:_,include_thread_info:p,include_reply_type:m,include_parent_message_info:E,show_subchannel_message_only:g,include_poll_details:y})}}class wt extends I{constructor(e,t){super(e,t),this.messages=t.messages.map((t=>At(e,t)))}}class Dt extends T{constructor({channelType:e,channelUrl:t,timestamp:s,token:n,includeMetaArray:i,includeReactions:a,includeThreadInfo:r,replyType:o,includeParentMessageInfo:l,includePollDetails:h}){super(),this.method=N.GET,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages/changelogs`,this.params={change_ts:s,token:n,with_sorted_meta_array:i,include_reactions:a,include_thread_info:r,include_reply_type:o,include_parent_message_info:l,include_poll_details:h}}}class Rt extends I{constructor(e,t){super(e,t),this.updatedMessages=t.updated.map((t=>At(e,t))),this.deletedMessagesInfo=t.deleted.map((e=>({messageId:e.message_id,deletedAt:e.deleted_at}))),this.hasMore=t.has_more,this.nextToken=t.next}}const Ot={};class Lt{constructor(e,{sdkState:t,dispatcher:s,requestQueue:n}){this._iid=e,this._sdkState=t,this._requestQueue=n,this._dispatcher=s,this.fileMessageQueue=new gt({sdkState:t,dispatcher:s,requestQueue:n}),Ot[e]=this}static of(e){return Ot[e]}buildMessageFromSerializedData(e){const t=Re(e);switch(t.messageType){case me.USER:return new vt(this._iid,vt.payloadify(t));case me.FILE:return new ct(this._iid,ct.payloadify(t));case me.ADMIN:return new ft(this._iid,ft.payloadify(t))}return null}buildSenderFromSerializedData(e){const t=Re(e);return new ot(this._iid,ot.payloadify(t))}getMessage(e){return t(this,void 0,void 0,(function*(){const t=new Ut(e),s=yield this._requestQueue.send(t),{message:n}=s.as(Mt);return n}))}getMessagesByTimestamp(e,s,n,i,a=Et.REQUEST_MESSAGE){return t(this,void 0,void 0,(function*(){const t=new bt(Object.assign({channelType:s,channelUrl:e,timestamp:n},i)),r=yield this._requestQueue.send(t),{messages:o}=r.as(wt);return this._dispatcher.dispatch(new Nt({messages:o,source:a})),o}))}getThreadedMessagesByTimestamp(e,s,n,i=Et.REQUEST_THREADED_MESSAGE){return t(this,void 0,void 0,(function*(){const t=new bt(Object.assign(Object.assign({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:s},n),{parentMessageId:e.messageId,replyType:ye.ALL,includeReplies:!0,includeThreadInfo:!0})),a=yield this._requestQueue.send(t),{messages:r}=a.as(wt),o=r.slice(1);return this._dispatcher.dispatch(new Nt({messages:o,source:i})),{parentMessage:r[0],threadedMessages:o}}))}getMessageChangelogs(e,s,n,i,a=Et.REQUEST_MESSAGE_CHANGELOGS){return t(this,void 0,void 0,(function*(){const t=new Dt(C(Object.assign({channelType:s,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null},i))),r=yield this._requestQueue.send(t),{updatedMessages:o,deletedMessagesInfo:l,hasMore:h,nextToken:c}=r.as(Rt),d=l.map((e=>e.messageId));return o.length>0&&this._dispatcher.dispatch(new Nt({messages:o,source:a})),d.length>0&&this._dispatcher.dispatch(new Tt({messageIds:d,source:a})),{updatedMessages:o,deletedMessageIds:d,hasMore:h,token:c}}))}}class kt{constructor(){this._onPending=R,this._onFailed=R,this._onSucceeded=R}trigger(e,t){switch(t.requestState){case fe.PENDING:this._onPending(t);break;case fe.FAILED:case fe.CANCELED:this._onFailed(e,t);break;case fe.SUCCEEDED:this._onSucceeded(t)}}onPending(e){return this._onPending=e,this}onFailed(e){return this._onFailed=e,this}onSucceeded(e){return this._onSucceeded=e,this}}var xt;!function(e){e.SCHEDULED="scheduled",e.SENT="sent",e.CANCELED="canceled",e.FAILED="failed"}(xt||(xt={}));class Pt extends le{constructor(e,t){var s,n,i,a,r,o,l,h;super(e),this.scheduleId=0,this.scheduledDateTimeString="",this.scheduledTimezone="",this.status=xt.SCHEDULED,this.channelUrl="",this.channelType=_e.BASE,this.messageType=me.USER,this.sender=null,this.message="",this.customType="",this.data="",this.mentionType=ge.USERS,this.mentionedUsers=[],this.metaArrays=[],this.translationTargetLanguages=[],this.appleCriticalAlertOptions=null,this.pushNotificationDeliveryOption=ve.DEFAULT,this.createdAt=0,this.updatedAt=0,this.errorCode=0,this.errorMessage="",this.scheduleId=t.scheduled_id,this.scheduledDateTimeString=null!==(s=t.scheduled_dt)&&void 0!==s?s:"",this.scheduledTimezone=null!==(n=t.scheduled_timezone)&&void 0!==n?n:"",this.status=c(xt,t.status)?t.status:xt.SCHEDULED,this.channelUrl=t.channel_url,this.channelType=t.channel_type,this.sender=new ot(this._iid,t.user),this.message=t.message,this.customType=null!==(i=t.custom_type)&&void 0!==i?i:"",this.data=null!==(a=t.data)&&void 0!==a?a:"",this.mentionType=c(ge,t.mention_type)?t.mention_type:null,this.mentionedUsers=t.mentioned_users?t.mentioned_users.map((e=>new ke(this._iid,e))):[];const d=null!==(r=t.metaarray)&&void 0!==r?r:{},u=null!==(o=t.metaarray_key_order)&&void 0!==o?o:Object.keys(d).sort(((e,t)=>e.localeCompare(t)));for(let e=0;e<u.length;e++){const t=u[e];this.metaArrays.push(new tt({key:t,value:d[t]||[]}))}this.translationTargetLanguages=null!==(l=t.translation_target_langs)&&void 0!==l?l:[],this.appleCriticalAlertOptions=t.apple_critical_alert_options?new it(t.apple_critical_alert_options):null,this.pushNotificationDeliveryOption=c(ve,t.push_option)?t.push_option:ve.DEFAULT,this.status===xt.FAILED&&t.error&&(this.errorCode=t.error.code,this.errorMessage=t.error.message),this.createdAt=t.created_at,this.updatedAt=null!==(h=t.updated_at)&&void 0!==h?h:0}}class Ft extends le{constructor(e,t){super(e),this.threadInfo=null,this.targetMessageId=0,this.channelUrl=null,this.channelType=null;const s=t.thread_info,n=t.root_message_id,i=t.channel_url,a=t.channel_type;s&&h("object",s)&&h("number",n)&&h("string",i)&&h("string",a)&&(this.threadInfo=new Xe(e,s),this.targetMessageId=n,this.channelUrl=i,this.channelType=a)}}class Ht extends class{constructor(){this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageTypeFilter=Ee.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=ye.NONE,this.includeReactions=!1,this.includeReplies=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return h("number",this.prevResultSize)&&h("number",this.nextResultSize)&&h("boolean",this.isInclusive)&&h("boolean",this.reverse)&&h("string",this.messageTypeFilter)&&c(Ee,this.messageTypeFilter)&&d("string",this.customTypesFilter,!0)&&d("string",this.senderUserIdsFilter,!0)&&c(ye,this.replyType)&&h("boolean",this.includeMetaArray)&&h("boolean",this.includeReactions)&&h("boolean",this.includeReplies)&&h("boolean",this.includeParentMessageInfo)&&h("boolean",this.includeThreadInfo)&&h("boolean",this.showSubchannelMessagesOnly)}}class qt extends class{constructor(){this.replyType=ye.NONE,this.includeReactions=!1,this.includeReplies=!1,this.includeThreadInfo=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1,this.includePollDetails=!1}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return c(ye,this.replyType)&&h("boolean",this.includeReactions)&&h("boolean",this.includeReplies)&&h("boolean",this.includeMetaArray)&&h("boolean",this.includeParentMessageInfo)&&h("boolean",this.includeThreadInfo)&&h("boolean",this.includePollDetails)}}class Gt{constructor(){this.data=null,this.customType=null,this.mentionType=ge.USERS,this.mentionedUserIds=[],this.metaArrays=[],this.parentMessageId=0,this.isReplyToChannel=!1,this.pushNotificationDeliveryOption=null,this.appleCriticalAlertOptions=null}}class Vt extends Gt{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return(h("string",this.data)||null===this.data)&&(h("string",this.customType)||null===this.customType)&&c(ge,this.mentionType)&&d("string",this.mentionedUserIds)&&Array.isArray(this.metaArrays)&&this.metaArrays.every((e=>e instanceof tt))&&(h("number",this.parentMessageId)||null===this.parentMessageId)&&h("boolean",this.isReplyToChannel)&&(null===this.pushNotificationDeliveryOption||c(ve,this.pushNotificationDeliveryOption))&&(null===this.appleCriticalAlertOptions||this.appleCriticalAlertOptions instanceof it)}}class jt extends Gt{constructor(){super(...arguments),this.message=null,this.translationTargetLanguages=null}}class Qt extends jt{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}static fromFailedUserMessage(e){return new Qt(C({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.requestedMentionUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)}))}validate(){return new Vt(this).validate()&&(h("string",this.message)||null===this.message)&&d("string",this.translationTargetLanguages)}}class $t{constructor(){this.data=null,this.customType=null,this.mentionType=ge.USERS,this.mentionedUserIds=[],this.appleCriticalAlertOptions=null}}class Kt extends $t{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return(h("string",this.data)||null===this.data)&&(h("string",this.customType)||null===this.customType)&&c(ge,this.mentionType)&&d("string",this.mentionedUserIds)&&(null===this.appleCriticalAlertOptions||this.appleCriticalAlertOptions instanceof it)}}class Bt extends $t{constructor(){super(...arguments),this.message=null}}class zt extends Bt{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return new Kt(this).validate()&&(h("string",this.message)||null===this.message)}}class Wt extends Gt{constructor(){super(...arguments),this.file=null,this.fileName=null,this.fileSize=null,this.mimeType=null,this.thumbnailSizes=[]}}class Yt extends Wt{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}get fileUrl(){return h("string",this.file)?this.file:null}set fileUrl(e){h("string",e)&&(this.file=e)}static fromFailedFileMessage(e,t){return new Yt({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.requestedMentionUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((e=>({maxWidth:e.width,maxHeight:e.height})))})}validate(){return new Vt(this).validate()&&(u(this.file)||h("string",this.fileUrl))&&(h("string",this.fileName)||null===this.fileName)&&(h("string",this.mimeType)||null===this.mimeType)&&(h("number",this.fileSize)||null===this.fileSize)&&(null===this.thumbnailSizes||this.thumbnailSizes.every((e=>h("object",e)&&e.maxWidth>0&&e.maxHeight>0)))}}class Jt extends $t{}class Xt extends Jt{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return new Kt(this).validate()}}class Zt extends jt{constructor(){super(...arguments),this.year=null,this.month=null,this.day=null,this.hour=null,this.min=null,this.timezone=null}}class es extends Zt{constructor(e){if(super(),this._scheduledDateTimeString=null,e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}get scheduledDateTimeString(){var e;return null!==(e=this._scheduledDateTimeString)&&void 0!==e?e:`${this.year.toString()}-${("0"+this.month.toString()).substr(-2)}-${("0"+this.day.toString()).substr(-2)} ${("0"+this.hour.toString()).substr(-2)}:${("0"+this.min.toString()).substr(-2)}`}set scheduledDateTimeString(e){e&&h("string",e)&&(this._scheduledDateTimeString=e)}setSchedule(e){var t,s,n;this.year=e.year,this.month=e.month,this.day=e.day,this.hour=null!==(t=e.hour)&&void 0!==t?t:null,this.min=null!==(s=e.min)&&void 0!==s?s:null,this.timezone=null!==(n=e.timezone)&&void 0!==n?n:null,this._scheduledDateTimeString=null}validate(){return new Qt(this).validate()&&h("number",this.year)&&h("number",this.month)&&h("number",this.day)&&h("number",this.hour,!0)&&h("number",this.min,!0)&&h("string",this.timezone,!0)}}class ts{constructor(e,t){var s;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(s=t.limit)&&void 0!==s?s:20}get hasNext(){return this._hasNext}get isLoading(){return this._isLoading}_validate(){return h("number",this.limit)&&this.limit>0}}class ss extends T{constructor({channelCustomType:e,keyword:t,limit:s,reverse:n,exactMatch:i,channelUrl:a,order:r,messageTimestampFrom:o,messageTimestampTo:l,advancedQuery:h,targetFields:c,nextToken:d}){super(),this.method=N.GET,this.path="/v3/search/messages",this.params={custom_type:e,query:t,limit:s,reverse:n,exact_match:i,channel_url:a,message_ts_from:o,message_ts_to:l,sort_field:r,advanced_query:h,target_fields:c,after:d}}}class ns extends I{constructor(e,t){super(e,t),this.messages=t.results.map((t=>At(e,t))),this.hasNext=t.has_next,this.nextToken=t.end_cursor}}var is,as,rs,os,ls;!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(is||(is={}));class hs extends ts{constructor(e,t){var s,n,i,a,r,o,l,h,c;super(e,t),this.keyword="",this.reverse=!1,this.exactMatch=!1,this.channelUrl="",this.channelCustomType="",this.messageTimestampFrom=null,this.messageTimestampTo=null,this.order=is.SCORE,this.advancedQuery=!1,this.targetFields=null,this._nextToken="",this.keyword=t.keyword,this.reverse=null!==(s=t.reverse)&&void 0!==s&&s,this.exactMatch=null!==(n=t.exactMatch)&&void 0!==n&&n,this.channelUrl=null!==(i=t.channelUrl)&&void 0!==i?i:"",this.channelCustomType=null!==(a=t.channelCustomType)&&void 0!==a?a:"",this.messageTimestampFrom=null!==(r=t.messageTimestampFrom)&&void 0!==r?r:null,this.messageTimestampTo=null!==(o=t.messageTimestampTo)&&void 0!==o?o:null,this.order=null!==(l=t.order)&&void 0!==l?l:is.SCORE,this.advancedQuery=null!==(h=t.advancedQuery)&&void 0!==h&&h,this.targetFields=null!==(c=t.targetFields)&&void 0!==c?c:null}_validate(){return super._validate()&&h("string",this.keyword)&&this.keyword.length>0&&h("boolean",this.reverse)&&h("boolean",this.exactMatch)&&h("string",this.channelUrl)&&h("string",this.channelCustomType)&&(h("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(h("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&c(is,this.order)&&h("boolean",this.advancedQuery)&&d("string",this.targetFields,!0)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new ss(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null})),s=yield e.send(t),{messages:n,hasNext:i,nextToken:a}=s.as(ns);return this._nextToken=a,this._hasNext=i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}class cs extends ts{constructor(e,t,s,n){super(e,n),this.channelUrl=t,this.channelType=s}_validate(){return super._validate()&&h("string",this.channelUrl)&&c(_e,this.channelType)}}class ds extends cs{constructor(e,t,s,n){var i,a,r,o,l,h,c,d,u,_;super(e,t,s,n),this.reverse=!1,this.messageTypeFilter=Ee.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.includeMetaArray=!1,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1,this._edge=Number.MAX_SAFE_INTEGER,this.reverse=null!==(i=n.reverse)&&void 0!==i&&i,this.messageTypeFilter=null!==(a=n.messageTypeFilter)&&void 0!==a?a:Ee.ALL,this.customTypesFilter=null!==(r=n.customTypesFilter)&&void 0!==r?r:null,this.senderUserIdsFilter=null!==(o=n.senderUserIdsFilter)&&void 0!==o?o:null,this.includeMetaArray=null!==(l=n.includeMetaArray)&&void 0!==l&&l,this.includeReactions=null!==(h=n.includeReactions)&&void 0!==h&&h,this.includeReplies=null!==(c=n.includeReplies)&&void 0!==c&&c,this.includeParentMessageInfo=null!==(d=n.includeParentMessageInfo)&&void 0!==d&&d,this.includeThreadInfo=null!==(u=n.includeThreadInfo)&&void 0!==u&&u,this.showSubchannelMessagesOnly=null!==(_=n.showSubchannelMessagesOnly)&&void 0!==_&&_}_validate(){return super._validate()&&h("boolean",this.reverse)&&c(Ee,this.messageTypeFilter)&&d("string",this.customTypesFilter,!0)&&d("string",this.senderUserIdsFilter,!0)&&h("boolean",this.includeMetaArray)&&h("boolean",this.includeReactions)&&h("boolean",this.includeReplies)&&h("boolean",this.includeParentMessageInfo)&&h("boolean",this.includeThreadInfo)&&h("boolean",this.showSubchannelMessagesOnly)}load(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const e=Lt.of(this._iid),t=yield e.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:ye.NONE,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeReplies:this.includeReplies,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly});return this._edge=Math.min(...t.map((e=>e.createdAt))),this._hasNext=t.length>=this.limit,this._isLoading=!1,t}return[]}throw r.invalidParameters}))}}!function(e){e.MUTED="muted",e.BANNED="banned"}(as||(as={}));class us{constructor(e){var t,s,n;this.restrictionType=null,this.description=null,this.endAt=-1,c(as,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(n=null!==(s=e.end_at)&&void 0!==s?s:e.muted_end_at)&&void 0!==n?n:-1}static payloadify(e){return e?C({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null}}class _s extends ke{constructor(e,t){super(e,t),this.restrictionInfo=null,this.restrictionInfo=new us(t)}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),us.payloadify(e.restrictionInfo))):null}}!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited"}(rs||(rs={}));class ps extends _s{constructor(e,t){super(e,t),this.state=null,this.role=null,this.isMuted=!1,this.isBlockedByMe=!1,this.isBlockingMe=!1,this.state=c(rs,t.state)?t.state:null,this.role=c(pe,t.role)?t.role:null,t.hasOwnProperty("is_muted")&&(this.isMuted=t.is_muted),t.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=t.is_blocked_by_me),t.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=t.is_blocking_me)}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null}}class ms extends le{constructor(e,t){var s,n;super(e),this.channelUrl=null!==(s=t.channel_url)&&void 0!==s?s:"",this.channelType=null!==(n=t.channel_type)&&void 0!==n?n:_e.GROUP,this.reader=new ke(this._iid,t.user),this.readAt=t.ts}}!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(os||(os={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(ls||(ls={}));const Es=e=>{switch(e){case os.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case os.CHRONOLOGICAL:return["-createdAt","syncIndex"];case os.CHANNEL_NAME_ALPHABETICAL:return["name"]}};var gs,ys,vs,fs,Cs,Ns,Ts,Is;!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(gs||(gs={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(ys||(ys={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only"}(vs||(vs={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(fs||(fs={})),function(e){e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Cs||(Cs={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Ns||(Ns={})),function(e){e.AND="AND",e.OR="OR"}(Ts||(Ts={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(Is||(Is={}));class Ss{constructor(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=ys.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=vs.ALL,this.publicChannelFilter=gs.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=fs.ALL,this.hiddenChannelFilter=Cs.UNHIDDEN,this.includeFrozen=!0}_isFriend(e){return!!e.friendDiscoveryKey||!!e.friendName}get searchFilter(){return this._searchFilter}setSearchFilter(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})}get userIdsFilter(){return this._userIdsFilter}setUserIdsFilter(e,t,s=Ts.AND){this._userIdsFilter={userIds:e,includeMode:t,queryType:s}}clone(){const e=new Ss;this.searchFilter&&e.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&e.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);const t=JSON.parse(JSON.stringify(this));return Object.keys(t).forEach((s=>{e[s]=t[s]})),e}match(e,t){if(this._searchFilter){const{query:t,fields:s}=this._searchFilter;if(t&&s&&s.length>0&&!s.some((s=>{switch(s){case Is.CHANNEL_NAME:return e.name.toLowerCase().includes(t.toLowerCase());case Is.MEMBER_NICKNAME:return e.members.some((e=>e.nickname.toLowerCase().includes(t.toLowerCase())));default:return!0}})))return!1}if(this._userIdsFilter){const{userIds:s,includeMode:n,queryType:i}=this._userIdsFilter,a=e.members.map((e=>e.userId));if(n){if(s.length>0)switch(i){case Ts.AND:if(s.some((e=>!a.includes(e))))return!1;break;case Ts.OR:if(s.every((e=>!a.includes(e))))return!1}}else{if(s.includes(t)||s.push(t),e.members.length>s.length)return!1;if(!((e,t)=>{if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;const s=[...e].sort(),n=[...t].sort();for(let e=0;e<s.length;++e)if(s[e]!==n[e])return!1;return!0})(s,a))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp(`^${this.customTypeStartsWithFilter}`).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){const t=this.nicknameContainsFilter.toLowerCase();if(e.members.every((e=>!e.nickname.toLowerCase().includes(t))))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.memberStateFilter)switch(this.memberStateFilter){case ys.JOINED:if("joined"!==e.myMemberState)return!1;break;case ys.INVITED:if("invited"!==e.myMemberState)return!1;break;case ys.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case ys.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case Cs.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case Cs.HIDDEN:if(!e.isHidden)return!1;break;case Cs.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case Cs.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===fs.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case gs.PUBLIC:if(!e.isPublic)return!1;break;case gs.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case vs.SUPER:if(!e.isSuper)return!1;break;case vs.NON_SUPER:if(e.isSuper)return!1}return!0}}const As=100,Us="GroupChannel",Ms="url",bs="Message",ws="messageId";class Ds extends le{constructor(e,{sdkState:t,cacheContext:s}){super(e),this._channels=new Map,this._sdkState=t,this._cacheContext=s}get collection(){const{nestdb:e}=this._cacheContext;return e?e.collection("GroupChannel"):null}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e,t=0){return Object.assign(Object.assign({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})}_deserialize(e){return mi.of(this._iid).buildGroupChannelFromSerializedData(e)}get channels(){return[...this._channels.values()]}isCachedInMemory(e){return this._channels.has(e)}get(e){return t(this,void 0,void 0,(function*(){if(this._channels.has(e))return this._channels.get(e);if(this.localCacheEnabled){const t=yield this.collection.getByKey(e);if(t){const s=this._deserialize(t);return this._channels.set(e,s),s}}return null}))}fetch({token:e,limit:s=100,backward:n=!1,filter:i=new Ss,order:a=os.LATEST_LAST_MESSAGE}){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t={where:t=>{if(e)switch(a){case os.CHANNEL_NAME_ALPHABETICAL:if(!n&&t.name.localeCompare(e)<0||n&&t.name.localeCompare(e)>0)return!1;break;case os.CHRONOLOGICAL:if(!n&&t.createdAt>e||n&&t.createdAt<e)return!1;break;case os.LATEST_LAST_MESSAGE:if(!n&&t.lastMessageUpdatedAt>e||n&&t.lastMessageUpdatedAt<e)return!1}return i.match(this._deserialize(t),this._sdkState.userId)},index:Es(a),backward:n},r=yield this.collection.query(t),o=(yield r.fetch({limit:s})).map((e=>this._deserialize(e)));return o.forEach((e=>{this._channels.has(e.url)||this._channels.set(e.url,e)})),o}return[]}))}upsert(e){return t(this,void 0,void 0,(function*(){if(e.forEach((e=>{if(this._channels.has(e.url)){const t=this._channels.get(e.url);Object.assign(t,e,{_iid:this._iid})}else this._channels.set(e.url,e)})),this.localCacheEnabled){const t=[];for(const s in e)t.push(this._serialize(e[s],parseInt(s)));yield this.collection.upsertMany(t)}}))}remove(e){return t(this,void 0,void 0,(function*(){for(const t of e)this._channels.delete(t),this.localCacheEnabled&&(yield this.collection.remove(t))}))}clear(){return t(this,void 0,void 0,(function*(){this.clearMemoryCache(),this.localCacheEnabled&&(yield this.collection.clear())}))}clearMemoryCache(){this._channels.clear()}_setBlockStateOfAllChannels(e,s,n){return t(this,void 0,void 0,(function*(){const t=[];if(e===this._sdkState.userId){for(const e of this._channels.values())for(const i of e.members)if(i.userId===s){i.isBlockedByMe=n,t.push(e);break}}else if(s===this._sdkState.userId)for(const s of this._channels.values())for(const i of s.members)if(i.userId===e){i.isBlockingMe=n,t.push(s);break}t.length>0&&(yield this.upsert(t))}))}block(e,s){return t(this,void 0,void 0,(function*(){yield this._setBlockStateOfAllChannels(e,s,!0)}))}unblock(e,s){return t(this,void 0,void 0,(function*(){yield this._setBlockStateOfAllChannels(e,s,!1)}))}markAsRead(e,s=[...this._channels.keys()]){return t(this,void 0,void 0,(function*(){const t=[];for(const n of s){const s=yield this.get(n);s._updateUnreadMemberState(this._sdkState.userId,e)&&(s._updateUnreadCount(0,0),t.push(s))}t.length>0&&(yield this.upsert(t))}))}}class Rs{constructor(){this.messageTypeFilter=Ee.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null}clone(){const e=new Rs,t=JSON.parse(JSON.stringify(this));return Object.keys(t).forEach((s=>{e[s]=t[s]})),e}match(e){switch(this.messageTypeFilter){case Ee.USER:if(e.messageType!==me.USER)return!1;break;case Ee.FILE:if(e.messageType!==me.FILE)return!1;break;case Ee.ADMIN:if(e.messageType!==me.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof lt))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}return!0}}var Os;!function(e){e.CHANNEL_LATEST="channel_latest"}(Os||(Os={}));const Ls=e=>{if(e===Os.CHANNEL_LATEST)return["channelUrl","-createdAt","-messageId"]};class ks extends le{constructor(e,{sdkState:t,cacheContext:s}){super(e),this._sdkState=t,this._cacheContext=s}get collection(){const{nestdb:e}=this._cacheContext;return e?e.collection("Message"):null}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e){return Object.assign(Object.assign({},e.serialize()),{messageId:`${e.messageId}`})}_deserialize(e){e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)});return Lt.of(this._iid).buildMessageFromSerializedData(e)}get(e){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=yield this.collection.getByKey(`${e}`);if(t)return this._deserialize(t)}return null}))}fetch({channelUrl:e,token:s,limit:n=100,backward:i=!1,filter:a=new Rs,order:r=Os.CHANNEL_LATEST}){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=Ls(r),o={where:{channelUrl:e,"/where":e=>{if(s&&r===Os.CHANNEL_LATEST)if(!i&&e.createdAt>s||i&&e.createdAt<s)return!1;return a.match(this._deserialize(e))}},index:t,backward:i},l=yield this.collection.query(o);return(yield l.fetch({limit:n})).map((e=>this._deserialize(e)))}return[]}))}upsert(e){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.upsertMany(e.map((e=>this._serialize(e)))))}))}remove(e){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled)for(const t of e)yield this.collection.remove(`${t}`)}))}removeChannel(e){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.removeIf({channelUrl:e}))}))}clear(){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.clear())}))}countBetween(e,s,n){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=Ls(Os.CHANNEL_LATEST),i=this.collection.query({where:{channelUrl:e,"/where":e=>{const t=this._deserialize(e);return n.includes(t.createdAt)&&s.match(t)}},index:t});return yield i.count()}return 0}))}}const xs="UnsentMessage",Ps="reqId";class Fs extends le{constructor(e,{sdkState:t,cacheContext:s}){super(e),this._sdkState=t,this._cacheContext=s}get collection(){const{nestdb:e}=this._cacheContext;return e&&e.collection("UnsentMessage")}get localCacheEnabled(){const{localCacheEnabled:e}=this._cacheContext;return e&&!!this.collection}_serialize(e){if(e.messageId>0)throw r.invalidParameters;return Object.assign(Object.assign({},e.serialize()),{requestState:fe.FAILED})}_deserialize(e){if(e){e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)});return Lt.of(this._iid).buildMessageFromSerializedData(e)}return null}get(e){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=yield this.collection.getByKey(`${e}`);if(t)return this._deserialize(t)}return null}))}fetch({channelUrl:e,filter:s=new Rs,order:n=Os.CHANNEL_LATEST}){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled){const t=Ls(n),i={where:{channelUrl:e,"/where":e=>s.match(this._deserialize(e))},index:t},a=yield this.collection.query(i);return(yield a.fetch({})).map((e=>this._deserialize(e)))}return[]}))}upsert(e){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.upsertMany(e.map((e=>this._serialize(e)))))}))}remove(e){return t(this,void 0,void 0,(function*(){if(this.localCacheEnabled)for(const t of e)yield this.collection.remove(t)}))}removeChannel(e){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.removeIf({channelUrl:e}))}))}clear(){return t(this,void 0,void 0,(function*(){this.localCacheEnabled&&(yield this.collection.clear())}))}}var Hs,qs,Gs;!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(Hs||(Hs={}));class Vs{constructor(e){this.category=e.cat,this.data=e.data}static getDataAsUserBlockEvent(e,t){const{blocker:s,blockee:n}=t.data;return{blocker:new ke(e,s),blockee:new ke(e,n)}}static getDataAsFriendDiscoveredEvent(e,t){const{friend_discoveries:s}=t.data;return{friendDiscoveries:Array.isArray(s)?s.map((t=>new ke(e,t))):[]}}}!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE"}(qs||(qs={}));class js{constructor(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}get isGroupChannelEvent(){return this.channelType===_e.GROUP}get isOpenChannelEvent(){return this.channelType===_e.OPEN}}class Qs extends class{constructor(){this.invitedUserIds=[],this.channelUrl=null,this.coverUrl=null,this.coverImage=null,this.isDistinct=null,this.isSuper=null,this.isBroadcast=null,this.isPublic=null,this.isDiscoverable=null,this.isStrict=null,this.isEphemeral=null,this.accessCode=null,this.name=null,this.data=null,this.customType=null,this.operatorUserIds=null,this.messageSurvivalSeconds=null}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return d("string",this.invitedUserIds)&&h("string",this.channelUrl,null)&&h("string",this.coverUrl,null)&&(u(this.coverImage)||h("string",this.coverImage)||null===this.coverImage)&&h("boolean",this.isDistinct,!0)&&h("boolean",this.isSuper,!0)&&h("boolean",this.isBroadcast,!0)&&h("boolean",this.isPublic,!0)&&h("boolean",this.isStrict,!0)&&h("boolean",this.isDiscoverable,!0)&&h("boolean",this.isEphemeral,!0)&&h("string",this.accessCode,!0)&&h("string",this.name,!0)&&h("string",this.data,!0)&&h("string",this.customType,!0)&&d("string",this.operatorUserIds,!0)&&h("number",this.messageSurvivalSeconds,!0)}addUserIds(e){if(d("string",e)){const t=e.filter((e=>h("string",e)));for(let e=0;e<t.length;e++)this.addUserId(t[e])}}addUserId(e){h("string",e)&&(this.invitedUserIds.includes(e)||this.invitedUserIds.push(e))}}class $s extends class{constructor(){this.customTypes=[],this.includeEmpty=!1,this.includeFrozen=!0}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return(d("string",this.customTypes)||null===this.customTypes)&&(h("boolean",this.includeEmpty)||null===this.includeEmpty)&&h("boolean",this.includeFrozen)}}class Ks extends class{}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return c(ys,this.memberStateFilter)}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.EVENT_CHANNEL_CREATED=1]="EVENT_CHANNEL_CREATED",e[e.EVENT_CHANNEL_UPDATED=2]="EVENT_CHANNEL_UPDATED",e[e.EVENT_CHANNEL_DELETED=3]="EVENT_CHANNEL_DELETED",e[e.EVENT_CHANNEL_READ=4]="EVENT_CHANNEL_READ",e[e.EVENT_CHANNEL_DELIVERED=5]="EVENT_CHANNEL_DELIVERED",e[e.EVENT_CHANNEL_INVITED=6]="EVENT_CHANNEL_INVITED",e[e.EVENT_CHANNEL_JOINED=7]="EVENT_CHANNEL_JOINED",e[e.EVENT_CHANNEL_LEFT=8]="EVENT_CHANNEL_LEFT",e[e.EVENT_CHANNEL_ACCEPTED_INVITE=9]="EVENT_CHANNEL_ACCEPTED_INVITE",e[e.EVENT_CHANNEL_DECLINED_INVITE=10]="EVENT_CHANNEL_DECLINED_INVITE",e[e.EVENT_CHANNEL_OPERATOR_UPDATED=11]="EVENT_CHANNEL_OPERATOR_UPDATED",e[e.EVENT_CHANNEL_MUTED=12]="EVENT_CHANNEL_MUTED",e[e.EVENT_CHANNEL_UNMUTED=13]="EVENT_CHANNEL_UNMUTED",e[e.EVENT_CHANNEL_FROZEN=14]="EVENT_CHANNEL_FROZEN",e[e.EVENT_CHANNEL_UNFROZEN=15]="EVENT_CHANNEL_UNFROZEN",e[e.EVENT_CHANNEL_HIDDEN=16]="EVENT_CHANNEL_HIDDEN",e[e.EVENT_CHANNEL_UNHIDDEN=17]="EVENT_CHANNEL_UNHIDDEN",e[e.EVENT_CHANNEL_RESET_HISTORY=18]="EVENT_CHANNEL_RESET_HISTORY",e[e.EVENT_CHANNEL_TYPING_STATUS_UPDATE=19]="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e[e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED=20]="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e[e.EVENT_MESSAGE_SENT=21]="EVENT_MESSAGE_SENT",e[e.EVENT_MESSAGE_RECEIVED=22]="EVENT_MESSAGE_RECEIVED",e[e.EVENT_MESSAGE_UPDATED=23]="EVENT_MESSAGE_UPDATED",e[e.EVENT_BOTTOM=24]="EVENT_BOTTOM",e[e.REQUEST_CHANNEL=25]="REQUEST_CHANNEL",e[e.REQUEST_CHANNEL_CHANGELOGS=26]="REQUEST_CHANNEL_CHANGELOGS",e[e.SYNC_CHANNEL_BACKGROUND=27]="SYNC_CHANNEL_BACKGROUND",e[e.SYNC_CHANNEL_CHANGELOGS=28]="SYNC_CHANNEL_CHANGELOGS"}(Gs||(Gs={}));const Bs=e=>e<Gs.EVENT_BOTTOM||e===Gs.SYNC_CHANNEL_BACKGROUND||e===Gs.SYNC_CHANNEL_CHANGELOGS;class zs extends f{constructor({channels:e,source:t}){super(),this.channels=e,this.source=t}}class Ws extends f{constructor({channelUrls:e,source:t}){super(),this.channelUrls=e,this.source=t}}class Ys extends f{constructor(e,{userId:t}){super(),this._iid=e,this.userId=t}}class Js{constructor({groupChannelCache:e,messageCache:s,unsentMessageCache:n,dispatcher:i}){this._observers=new Map,i.on((i=>t(this,void 0,void 0,(function*(){if(i instanceof zs){const{channels:t,source:s}=i,n=t.filter((e=>e instanceof za));yield e.upsert(n),this._broadcastUpdateEvent(n,s)}else if(i instanceof Ws){const{channelUrls:a,source:r}=i;yield e.remove(a),yield Y((()=>t(this,void 0,void 0,(function*(){for(const e of a)yield s.removeChannel(e),yield n.removeChannel(e)})))),this._broadcastRemoveEvent(a,r)}else i instanceof Ys&&(yield e.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER}))}))))}_broadcastUpdateEvent(e,t){for(const s of this._observers.values())s.onUpdate(e,t)}_broadcastRemoveEvent(e,t){for(const s of this._observers.values())s.onRemove(e,t)}subscribe(e,t){this._observers.set(e,t)}unsubscribe(e){this._observers.delete(e)}}class Xs{constructor({messageCache:e,unsentMessageCache:s,dispatcher:n}){this._observers=new Map,n.on((n=>t(this,void 0,void 0,(function*(){if(n instanceof Nt){const{messages:t,source:i}=n,a=t.filter((e=>e.messageId>0)),r=t.filter((e=>0===e.messageId));a.length>0&&(yield e.upsert(a),yield s.remove(a.map((e=>e instanceof lt?e.reqId:null)).filter((e=>null!==e))),this._broadcastUpdateEvent(a,i)),r.length>0&&(yield s.upsert(r),this._broadcastUpdateEvent(r,i))}else if(n instanceof Tt){const{messageIds:t,source:s}=n;yield e.remove(t),this._broadcastRemoveEvent(t,s)}else if(n instanceof It){const{reqId:e,source:t}=n;yield s.remove([e]),this._broadcastRemoveUnsentEvent(e,t)}}))))}_broadcastUpdateEvent(e,t){for(const s of this._observers.values())s.onUpdate(e,t)}_broadcastRemoveEvent(e,t){for(const s of this._observers.values())s.onRemove(e,t)}_broadcastRemoveUnsentEvent(e,t){for(const s of this._observers.values())s.onRemoveUnsent(e,t)}subscribe(e,t){this._observers.set(e,t)}unsubscribe(e){this._observers.delete(e)}}class Zs extends M{constructor(e,t,s){super(e,"USEV",s),this.event=new Vs(s)}}class en extends T{constructor({userId:e,ts:t,token:s,filter:n=new $s}){super();const{customTypes:i,includeEmpty:a,includeFrozen:r}=n;this.method=N.PUT,this.path=`/v3/users/${encodeURIComponent(e)}/my_group_channels/changelogs`,this.params=C({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:t,token:s,custom_types:i,show_empty:a,show_frozen:r})}}class tn extends I{constructor(e,t){super(e,t),this.updatedChannels=t.updated.map((t=>new za(e,t))),this.deletedChannelUrls=t.deleted,this.hasMore=t.has_more,this.token=t.next}}class sn extends T{constructor({channelUrl:e,isInternalCall:t}){super(),this.method=N.GET,this.path=`${t?"/v3/sdk/group_channels":"/v3/group_channels"}/${encodeURIComponent(e)}`,this.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0}}}class nn extends I{constructor(e,t){super(e,t),this.channel=null,this.channel=new za(e,t)}}class an extends T{constructor(e){const{userId:t,token:s,limit:n,order:i,includeEmpty:a,memberStateFilter:r,superChannelFilter:o,publicChannelFilter:l,unreadChannelFilter:h,nicknameContainsFilter:c,channelNameContainsFilter:d,channelUrlsFilter:u,customTypesFilter:_,customTypeStartsWithFilter:p,hiddenChannelFilter:m,metadataOrderKeyFilter:E,metadataKey:g,metadataValues:y,metadataValueStartsWith:v,includeFrozen:f,includeMetaData:T,searchFilter:I,userIdsFilter:S}=e;super(),this.method=N.GET,this.path=`/v3/users/${encodeURIComponent(t)}/my_group_channels`,this.params=C({token:s,limit:n,order:i,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:a,member_state_filter:r,super_mode:o,public_mode:l,unread_filter:h,members_nickname_contains:c,name_contains:d,channel_urls:u,custom_types:_,custom_type_startswith:p,hidden_mode:m,metadata_order_key:E,metadata_key:g,metadata_values:y,metadata_value_startswith:v,show_frozen:f,show_metadata:T}),I&&I.query&&I.fields&&(this.params.search_query=I.query,this.params.search_fields=I.fields),S&&S.userIds&&S.userIds.length>0&&(S.includeMode?(this.params.members_include_in=S.userIds,this.params.query_type=S.queryType.toUpperCase()):this.params.members_exactly_in=S.userIds)}}class rn extends I{constructor(e,t){super(e,t),this.token=null,this.channels=[],this.ts=null;const{next:s,channels:n,ts:i}=t;this.token=s,n&&n.length>0&&(this.channels=n.map((t=>(t.ts=i,new za(e,t))))),this.ts=null!=i?i:null}}class on extends T{constructor({userId:e,filter:t}){super();const{memberStateFilter:s}=t;this.method=N.GET,this.path=`/v3/users/${encodeURIComponent(e)}/group_channel_count`,this.params={state:null!=s?s:ys.ALL}}}class ln extends I{constructor(e,t){super(e,t),this.groupChannelCount=t.group_channel_count}}class hn extends T{constructor(e){const{userId:t,channelUrl:s,coverUrl:n,coverImage:i,isDistinct:a,isSuper:r,isBroadcast:o,isPublic:l,isDiscoverable:h,isStrict:c,isEphemeral:d,accessCode:u,name:_,data:p,customType:m,messageSurvivalSeconds:E,invitedUserIds:g,operatorUserIds:y}=e;super(),this.method=N.POST,this.path="/v3/group_channels",this.params={user_ids:[t,...g].filter(((e,t,s)=>t===s.indexOf(e))),channel_url:s,cover_url:n,cover_file:i,is_distinct:a,is_super:r,is_broadcast:o,is_public:l,is_discoverable:h,strict:c,is_ephemeral:d,access_code:u,name:_,data:p,custom_type:m,operator_ids:y,message_survival_seconds:E}}}class cn extends I{constructor(e,t){super(e,t),this.channel=new za(e,t),this.isCreated=t.is_created}}class dn extends T{constructor({userId:e,channelUrls:t}){super(),this.method=N.PUT,this.path=`/v3/users/${encodeURIComponent(e)}/mark_as_read_all`,this.params={channel_urls:t}}}class un extends M{constructor(e,t,s){super(e,"SYEV",s),this.event=new js(s)}}class _n extends T{constructor(e){const{channelUrl:t,userId:s,accessCode:n}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/join`,this.params={user_id:s,access_code:n}}}class pn extends I{constructor(e,t){super(e,t),this.channel=new za(e,t)}}class mn extends un{constructor(e,t,s){super(e,t,s);const{member_count:n=null,joined_member_count:i=null,users:a=null}=s.data;this.memberCount=n,this.joinedMemberCount=i,this.members=Array.isArray(a)?a.map((t=>new ps(e,t))):[new ps(e,s.data)]}}class En extends T{constructor(e){const{channelUrl:t,userId:s}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/leave`,this.params={user_id:s}}}class gn extends un{constructor(e,t,s){super(e,t,s);const{member_count:n=null,joined_member_count:i=null}=s.data;this.memberCount=n,this.joinedMemberCount=i,this.member=new ps(this._iid,s.data)}}class yn extends T{constructor(e){const{channelUrl:t,userIds:s}=e;super(),this.method=N.POST,this.path=`/v3/group_channels/${encodeURIComponent(t)}/invite`,this.params={user_ids:s}}}class vn extends I{constructor(e,t){super(e,t),this.channel=new za(e,t)}}class fn extends un{constructor(e,t,s){super(e,t,s);const{member_count:n=null,joined_member_count:i=null,inviter:a=null,invitees:r=[]}=s.data;this.memberCount=n,this.joinedMemberCount=i,this.inviter=a?new ke(e,a):null,this.invitees=r.map((t=>new ps(e,t)))}}class Cn extends T{constructor(e){const{channelUrl:t,userId:s}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/decline`,this.params={user_id:s}}}class Nn extends I{constructor(e,t){super(e,t),this.channel=new za(e,t),this.channel.myMemberState=rs.NONE}}class Tn extends un{constructor(e,t,s){super(e,t,s);const{member_count:n=null,joined_member_count:i=null,inviter:a=null,invitee:r=null}=s.data;this.memberCount=n,this.joinedMemberCount=i,this.inviter=a?new ke(e,a):null,this.invitee=r?new ps(e,r):null}}class In extends b{constructor({channelUrl:e}){super({code:"READ",ackRequired:!0,payload:{channel_url:e}})}}class Sn extends M{constructor(e,t,s){super(e,"READ",s),this.readStatus=new ms(e,s)}}class An extends T{constructor({channelUrl:e,userId:t}){super(),super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(e)}/messages/mark_as_delivered`,this.params=C({userId:t})}}class Un extends M{constructor(e,t,s){super(e,"DLVR",s),this.channelUrl=s.channel_url,this.deliveredStateUpdate=s.updated}}class Mn extends T{constructor(e){const{channelUrl:t,userId:s,hidePreviousMessages:n,allowAutoUnhide:i}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/hide`,this.params={user_id:s,hide_previous_messages:n,allow_auto_unhide:i}}}class bn extends I{constructor(e,t){super(e,t),this.messageOffsetTimestamp=null;const{ts_message_offset:s}=t;this.messageOffsetTimestamp=null!=s?s:null}}class wn extends M{constructor(e,t,s){super(e,"SYEV",s),this.allowAutoUnhide=null,this.hidePreviousMessages=null,this.messageOffsetTimestamp=null,s.data&&(this.allowAutoUnhide=s.data.allow_auto_unhide,this.hidePreviousMessages=s.data.hide_previous_messages),this.messageOffsetTimestamp=s.ts_message_offset}}class Dn extends b{constructor({channelUrl:e,time:t}){super({code:"TPST",ackRequired:!1,payload:{channel_url:e,time:t}})}}class Rn extends M{constructor(e,t,s){super(e,"SYEV",s),this.user=new ke(e,s.data)}}class On extends b{constructor({channelUrl:e,time:t}){super({code:"TPEN",ackRequired:!1,payload:{channel_url:e,time:t}})}}class Ln extends M{constructor(e,t,s){super(e,"SYEV",s),this.user=new ke(e,s.data)}}class kn extends un{constructor(e,t,s){super(e,t,s);const{operators:n=[]}=s.data;this.operators=n.map((e=>new ke(this._iid,e)))}}class xn extends M{constructor(e,t,s){super(e,"MCNT",s),this.groupChannelMemberCounts=s.group_channels.map((e=>({channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}))),this.openChannelMemberCounts=s.open_channels.map((e=>({channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts})))}}class Pn extends T{constructor(e){const{channelUrl:t,channelType:s,userId:n,seconds:i,description:a}=e;super(),this.method=N.POST,this.path=`${Ce(s)}/${encodeURIComponent(t)}/mute`,this.params={user_id:n,seconds:i,description:a}}}class Fn extends M{constructor(e,t,s){super(e,"SYEV",s),this.user=new _s(e,s.data)}}class Hn extends T{constructor(e){const{channelUrl:t,channelType:s,userId:n}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/mute/${encodeURIComponent(n)}`}}class qn extends M{constructor(e,t,s){super(e,"SYEV",s),this.user=new _s(e,s.data)}}class Gn extends T{constructor(e){const{channelUrl:t,channelType:s,userId:n,seconds:i,description:a}=e;super(),this.method=N.POST,this.path=`${Ce(s)}/${encodeURIComponent(t)}/ban`,this.params=C({user_id:n,seconds:i,description:a})}}class Vn extends M{constructor(e,t,s){super(e,"SYEV",s),this.memberCount=null,this.joinedMemberCount=null,this.user=new _s(e,s.data),s.data.member_count&&(this.memberCount=s.data.member_count),s.data.joined_member_count&&(this.joinedMemberCount=s.data.joined_member_count)}}class jn extends T{constructor(e){const{channelUrl:t,channelType:s,userId:n}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/ban/${encodeURIComponent(n)}`}}class Qn extends M{constructor(e,t,s){super(e,"SYEV",s),this.user=new _s(e,s.data)}}class $n extends T{constructor(e){const{channelUrl:t,channelType:s,freezing:n}=e;super(),this.method=N.PUT,this.path=`${Ce(s)}/${encodeURIComponent(t)}/freeze`,this.params={freeze:n}}}class Kn extends M{constructor(e,t,s){super(e,"SYEV",s),this.freeze=s.data.freeze}}class Bn extends T{constructor(e){const{channelUrl:t,channelType:s,metadata:n,upsert:i}=e;super(),this.method=N.PUT,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metadata`,this.params={metadata:n,include_ts:!0,upsert:null!=i&&i}}}class zn extends I{constructor(e,t){super(e,t),this.ts=null;const{metadata:s,ts:n}=t;this.metadata=s,this.ts=null!=n?n:null}}class Wn extends M{constructor(e,t,s){super(e,"SYEV",s),this.created=null,this.updated=null,this.deleted=null,s.data&&(this.created=s.data.created,this.updated=s.data.updated,this.deleted=s.data.deleted)}}class Yn extends T{constructor(e){const{channelUrl:t,channelType:s,metaCounter:n,upsert:i=!1,mode:a="set"}=e;super(),this.method=N.PUT,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metacounter`,this.params={metacounter:n,upsert:i,mode:a}}}class Jn extends I{constructor(e,t){super(e,t),this.metaCounter=t}}class Xn extends M{constructor(e,t,s){super(e,"SYEV",s),this.created=null,this.updated=null,this.deleted=null,s.data&&(this.created=s.data.created,this.updated=s.data.updated,this.deleted=s.data.deleted)}}class Zn extends b{constructor({channelUrl:e,messageId:t}){super({code:"MACK",ackRequired:!1,payload:{channel_url:e,msg_id:t}})}}class ei extends b{constructor(e){super({code:"MESG",ackRequired:!0,payload:C({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:e.mentionType===ge.USERS?e.mentionedUserIds:[],target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==ve.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,req_id:e.requestId})})}}class ti extends M{constructor(e,t,s){var n;super(e,"MESG",s),this.message=new vt(e,s);const{sdkState:i}=Ve.of(e);this.isMentioned=Te(this.message.mentionType,this.message.mentionedUsers.map((e=>e.userId)),i.userId),this.forceUpdateLastMessage=null!==(n=s.force_update_last_message)&&void 0!==n&&n}}class si extends M{constructor(e,t,s){var n;super(e,"ADMM",s),this.message=new ft(e,s);const{sdkState:i}=Ve.of(e);this.isMentioned=Te(this.message.mentionType,this.message.mentionedUsers.map((e=>e.userId)),i.userId),this.forceUpdateLastMessage=null!==(n=s.force_update_last_message)&&void 0!==n&&n}}class ni extends b{constructor(e){super({code:"MEDI",ackRequired:!0,payload:C({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:e.mentionType===ge.USERS?e.mentionedUserIds:[],apple_critical_alert_options:e.appleCriticalAlertOptions})})}}class ii extends M{constructor(e,t,s){var n,i,a,r;super(e,"MEDI",s),this.message=new vt(e,s);const{sdkState:o}=Ve.of(e);this.mentionCountChange=Ie({mentionType:null!==(i=null===(n=s.old_values)||void 0===n?void 0:n.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(r=null===(a=s.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==r?r:[]},{mentionType:this.message.mentionType,mentionedUserIds:this.message.mentionedUsers.map((e=>e.userId))},o.userId)}}class ai extends b{constructor(e){super({code:"FEDI",ackRequired:!0,payload:C({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:e.mentionType===ge.USERS?e.mentionedUserIds:[],apple_critical_alert_options:e.appleCriticalAlertOptions})})}}class ri extends M{constructor(e,t,s){var n,i,a,r;super(e,"FEDI",s),this.message=new ct(e,s);const{sdkState:o}=Ve.of(e);this.mentionCountChange=Ie({mentionType:null!==(i=null===(n=s.old_values)||void 0===n?void 0:n.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(r=null===(a=s.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==r?r:[]},{mentionType:this.message.mentionType,mentionedUserIds:this.message.mentionedUsers.map((e=>e.userId))},o.userId)}}class oi extends M{constructor(e,t,s){var n,i,a,r;super(e,"AEDI",s),this.message=new ft(e,s);const{sdkState:o}=Ve.of(e);this.mentionCountChange=Ie({mentionType:null!==(i=null===(n=s.old_values)||void 0===n?void 0:n.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(r=null===(a=s.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==r?r:[]},{mentionType:this.message.mentionType,mentionedUserIds:this.message.mentionedUsers.map((e=>e.userId))},o.userId)}}class li extends T{constructor(e){super(),this.method=N.DELETE,this.path=`${Ce(e.channelType)}/${e.channelUrl}/messages/${e.messageId}`}}class hi extends M{constructor(e,t,s){super(e,"DELM",s),this.channelUrl=s.channel_url,this.channelType=s.channel_type,this.messageId=Number(s.msg_id)}}class ci extends M{constructor(e,t,s){super(e,"MRCT",s),this.channelUrl=s.channel_url,this.channelType=s.channel_type,this.event=new Ze(s)}}class di extends M{constructor(e,t,s){super(e,"MTHD",s),this.event=new Ft(e,s)}}class ui extends ts{constructor(e,t){var s,n,i,a,r,o,l,h,c,d,u,_,p,m,E,g,y,v,f,C;super(e,t),this.includeEmpty=!1,this.includeFrozen=!0,this.includeMetaData=!0,this.channelUrlsFilter=null,this.customTypesFilter=null,this.customTypeStartsWithFilter=null,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=ys.ALL,this.unreadChannelFilter=fs.ALL,this.superChannelFilter=vs.ALL,this.publicChannelFilter=gs.ALL,this.hiddenChannelFilter=Cs.UNHIDDEN,this.searchFilter={fields:[],query:null},this.userIdsFilter={userIds:[],includeMode:!0,queryType:Ts.AND},this.metadataKey=null,this.metadataValues=null,this.metadataOrderKeyFilter=null,this.metadataValueStartsWith=null,this.order=os.LATEST_LAST_MESSAGE,this.includeEmpty=null!==(s=t.includeEmpty)&&void 0!==s&&s,this.includeFrozen=null===(n=t.includeFrozen)||void 0===n||n,this.includeMetaData=null===(i=t.includeMetaData)||void 0===i||i,this.channelUrlsFilter=null!==(a=t.channelUrlsFilter)&&void 0!==a?a:null,this.customTypesFilter=null!==(r=t.customTypesFilter)&&void 0!==r?r:null,this.customTypeStartsWithFilter=null!==(o=t.customTypeStartsWithFilter)&&void 0!==o?o:"",this.nicknameContainsFilter=null!==(l=t.nicknameContainsFilter)&&void 0!==l?l:"",this.channelNameContainsFilter=null!==(h=t.channelNameContainsFilter)&&void 0!==h?h:"",this.memberStateFilter=null!==(c=t.memberStateFilter)&&void 0!==c?c:ys.ALL,this.unreadChannelFilter=null!==(d=t.unreadChannelFilter)&&void 0!==d?d:fs.ALL,this.superChannelFilter=null!==(u=t.superChannelFilter)&&void 0!==u?u:vs.ALL,this.publicChannelFilter=null!==(_=t.publicChannelFilter)&&void 0!==_?_:gs.ALL,this.hiddenChannelFilter=null!==(p=t.hiddenChannelFilter)&&void 0!==p?p:Cs.UNHIDDEN,this.searchFilter=null!==(m=t.searchFilter)&&void 0!==m?m:{fields:[],query:null},this.userIdsFilter=null!==(E=t.userIdsFilter)&&void 0!==E?E:{userIds:[],includeMode:!0,queryType:Ts.AND},this.metadataKey=null!==(g=t.metadataKey)&&void 0!==g?g:null,this.metadataValues=null!==(y=t.metadataValues)&&void 0!==y?y:null,this.metadataOrderKeyFilter=null!==(v=t.metadataOrderKeyFilter)&&void 0!==v?v:null,this.metadataValueStartsWith=null!==(f=t.metadataValueStartsWith)&&void 0!==f?f:null,this.order=null!==(C=t.order)&&void 0!==C?C:os.LATEST_LAST_MESSAGE}_validate(){return super._validate()&&h("boolean",this.includeEmpty)&&h("boolean",this.includeFrozen)&&h("boolean",this.includeMetaData)&&h("string",this.channelNameContainsFilter)&&d("string",this.channelUrlsFilter,!0)&&d("string",this.customTypesFilter,!0)&&h("string",this.customTypeStartsWithFilter)&&h("string",this.nicknameContainsFilter)&&c(ys,this.memberStateFilter)&&c(vs,this.superChannelFilter)&&c(gs,this.publicChannelFilter)&&c(fs,this.unreadChannelFilter)&&c(Cs,this.hiddenChannelFilter)&&d(Is,this.searchFilter.fields)&&h("string",this.searchFilter.query,!0)&&d("string",this.userIdsFilter.userIds)&&h("boolean",this.userIdsFilter.includeMode)&&c(Ts,this.userIdsFilter.queryType)&&c(os,this.order)&&h("string",this.metadataOrderKeyFilter,!0)&&h("string",this.metadataKey,!0)&&d("string",this.metadataValues,!0)&&h("string",this.metadataValueStartsWith,!0)}serialize(){return De(this)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const e=mi.of(this._iid),{channels:t,token:s}=yield e.getMyGroupChannels(this._token,this,this.limit);return this._token=s,this._hasNext=!!s,this._isLoading=!1,t}return[]}throw r.invalidParameters}))}}class _i{constructor({top:e=Number.MAX_SAFE_INTEGER,bottom:t=0}){this.top=e,this.bottom=t}includes(...e){return e.every((e=>this.top<=e&&e<=this.bottom))}overlap(e){return this.includes(e.top)||this.includes(e.bottom)}extends(...e){this.top=Math.min(this.top,...e),this.bottom=Math.max(this.bottom,...e)}}const pi={};class mi{constructor(e,{sdkState:t,cacheContext:s,dispatcher:n,sessionManager:i,requestQueue:a}){this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this._iid=e,this._sdkState=t,this._sessionManager=i,this._requestQueue=a,this._dispatcher=n,this._groupChannelHandlers=new Map,this._groupChannelCache=new Ds(this._iid,{sdkState:t,cacheContext:s}),this._messageCache=new ks(this._iid,{sdkState:t,cacheContext:s}),this._unsentMessageCache=new Fs(this._iid,{sdkState:t,cacheContext:s}),this._groupChannelBroadcast=new Js({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:n}),this._messageBroadcast=new Xs({messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:n}),setInterval((()=>{for(const e of this._groupChannelCache.channels)e.invalidateTypingStatus()&&(this._dispatcher.dispatch(new zs({channels:[e],source:Gs.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),this._groupChannelHandlers.forEach((t=>{t.onTypingStatusUpdated(e)})))}),1e3),this._dispatcher.on((e=>{e instanceof M&&this._handleEvent(e)})),pi[e]=this}static of(e){return pi[e]}get handlers(){return[...this._groupChannelHandlers.values()]}buildGroupChannelFromSerializedData(e){const t=Re(e);return new za(this._iid,za.payloadify(t))}buildGroupChannelListQueryFromSerializedData(e){const t=Re(e);return new ui(this._iid,t)}buildMemberFromSerializedData(e){const t=Re(e);return new ps(this._iid,ps.payloadify(t))}getChannelFromCache(e){return t(this,void 0,void 0,(function*(){return yield this._groupChannelCache.get(e)}))}getChannelsFromCache(e,s,n){return t(this,void 0,void 0,(function*(){return yield this._groupChannelCache.fetch({token:e,filter:s,order:n})}))}_handleEvent(e){return t(this,void 0,void 0,(function*(){try{switch(e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":{let s=null;if("MESG"===e.code?s=e.as(ti):"FILE"===e.code?s=e.as(_t):"ADMM"!==e.code&&"BRDM"!=e.code||(s=e.as(si)),s){const{message:e,isMentioned:n,forceUpdateLastMessage:i}=s;if(e.channelType===_e.GROUP){Y((()=>t(this,void 0,void 0,(function*(){const t=new Zn(e);this._requestQueue.send(t)}))));const s=this._groupChannelCache.isCachedInMemory(e.channelUrl),a=e instanceof lt&&e.sender.userId===this._sdkState.userId,r=yield this.getChannel(e.channelUrl,!0);if(r.hiddenState=Ka.UNHIDDEN,e instanceof lt){for(const t of r.members)if(t.userId===e.sender.userId){t.nickname=e.sender.nickname,t.plainProfileUrl=e.sender.plainProfileUrl,t.metaData=e.sender.metaData,t.isBlockedByMe=e.sender.isBlockedByMe;break}if(a){const{currentUser:t}=this._sessionManager;t&&(t.nickname=e.sender.nickname,t.plainProfileUrl=e.sender.plainProfileUrl,t.metaData=e.sender.metaData)}}e.silent&&!a||(r.isEphemeral||s)&&((!r.lastMessage||r.lastMessage.createdAt<e.createdAt)&&(r.lastMessage=e),a||r._updateUnreadCount(r.unreadMessageCount+1,r.unreadMentionCount+(n?1:0))),i&&(!r.lastMessage||r.lastMessage.createdAt<e.createdAt)&&(r.lastMessage=e),this._dispatcher.dispatch(new zs({channels:[r],source:Gs.EVENT_MESSAGE_RECEIVED})),e.silent&&!a||W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onChannelChanged(r)})))),this._dispatcher.dispatch(new Nt({messages:[e],source:Et.EVENT_MESSAGE_RECEIVED})),W((()=>t(this,void 0,void 0,(function*(){for(const t of this._groupChannelHandlers.values())t.onMessageReceived(r,e),n&&t.onMentionReceived(r,e)}))))}}break}case"MEDI":case"FEDI":case"AEDI":{let s=null;if("MEDI"===e.code?s=e.as(ii):"FEDI"===e.code?s=e.as(ri):"AEDI"===e.code&&(s=e.as(oi)),s){const{message:e,mentionCountChange:n}=s;if(e.channelType===_e.GROUP){const s=this._groupChannelCache.isCachedInMemory(e.channelUrl),i=yield this.getChannel(e.channelUrl,!0),a=e instanceof lt&&e.sender.userId===this._sdkState.userId;let r=!1;if(a){const{currentUser:t}=this._sessionManager;t&&(t.nickname=e.sender.nickname,t.plainProfileUrl=e.sender.plainProfileUrl,t.metaData=e.sender.metaData)}else i.isReadMessage(e)&&0!==n&&!e.silent&&s&&(i._updateUnreadCount(i.unreadMessageCount,i.unreadMentionCount+n),r=!0);!i.lastMessage||i.lastMessage.createdAt<e.createdAt?(i.lastMessage=e,r=!0):i.lastMessage.isIdentical(e)&&(s?i.lastMessage.updatedAt<e.updatedAt&&(i.lastMessage=e,r=!0):r=!0),r&&(this._dispatcher.dispatch(new zs({channels:[i],source:Gs.EVENT_MESSAGE_UPDATED})),e.silent&&!a||W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onChannelChanged(i)}))))),this._dispatcher.dispatch(new Nt({messages:[e],source:Et.EVENT_MESSAGE_UPDATED})),W((()=>t(this,void 0,void 0,(function*(){for(const t of this._groupChannelHandlers.values())t.onMessageUpdated(i,e),0!==n&&t.onMentionReceived(i,e)}))))}}break}case"DELM":{const{channelUrl:s,channelType:n,messageId:i}=e.as(hi);if(n===_e.GROUP){const e=yield this.getChannel(s,!0);this._dispatcher.dispatch(new Tt({messageIds:[i],source:Et.EVENT_MESSAGE_DELETED})),W((()=>t(this,void 0,void 0,(function*(){for(const t of this._groupChannelHandlers.values())t.onMessageDeleted(e,i)}))))}break}case"READ":{const{readStatus:s}=e.as(Sn);if(s.channelType===_e.GROUP){const e=this._groupChannelCache.isCachedInMemory(s.channelUrl),n=yield this.getChannel(s.channelUrl,!0);e&&n._updateUnreadMemberState(s.reader.userId,s.readAt),s.reader.userId===this._sdkState.userId?e?(n.unreadMessageCount>0||n.unreadMentionCount>0)&&(n._updateUnreadCount(0,0),this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_READ})),W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onChannelChanged(n)}))))):0!==n.unreadMessageCount&&0!==n.unreadMentionCount||(this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_READ})),W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onChannelChanged(n)}))))):W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onUnreadMemberCountUpdated(n)}))))}break}case"DLVR":{const{channelUrl:s,deliveredStateUpdate:n={}}=e.as(Un),i=this._groupChannelCache.isCachedInMemory(s),a=yield this.getChannel(s,!0);if(i)for(const e in n)a._updateUndeliveredMemberState(e,n[e]);this._dispatcher.dispatch(new zs({channels:[a],source:Gs.EVENT_CHANNEL_DELIVERED})),Object.keys(n).some((e=>e!==this._sdkState.userId))&&W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onUndeliveredMemberCountUpdated(a)}))));break}case"MRCT":{const{channelUrl:s,channelType:n,event:i}=e.as(ci);if(n===_e.GROUP){const e=yield this.getChannel(s,!0),n=yield this.getMessageFromCache(i.messageId);n&&(n.applyReactionEvent(i),this._dispatcher.dispatch(new Nt({messages:[n],source:Et.EVENT_MESSAGE_REACTION_UPDATED}))),W((()=>t(this,void 0,void 0,(function*(){for(const t of this._groupChannelHandlers.values())t.onReactionUpdated(e,i)}))))}break}case"MTHD":{const{event:s}=e.as(di);if(s.channelType===_e.GROUP){const e=yield this.getChannel(s.channelUrl,!0),n=yield this.getMessageFromCache(s.targetMessageId);n&&(n.applyThreadInfoUpdateEvent(s),this._dispatcher.dispatch(new Nt({messages:[n],source:Et.EVENT_MESSAGE_THREADINFO_UPDATED}))),W((()=>t(this,void 0,void 0,(function*(){for(const t of this._groupChannelHandlers.values())t.onThreadInfoUpdated(e,s)}))))}break}case"MCNT":{const{groupChannelMemberCounts:s}=e.as(xn),n=[];for(const e of s){const{channelUrl:t,memberCount:s,joinedMemberCount:i,updatedAt:a}=e,r=yield this.getChannelFromCache(t);r&&r._setLatestMemberCount(s,i,a)&&n.push(r)}n.length>0&&(this._dispatcher.dispatch(new zs({channels:n,source:Gs.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),W((()=>t(this,void 0,void 0,(function*(){for(const e of this._groupChannelHandlers.values())e.onChannelMemberCountChanged(n)})))));break}case"SYEV":{const{event:s}=e.as(un);if(s.isGroupChannelEvent)switch(s.category){case qs.CHANNEL_JOIN:{const n=yield this.getChannel(s.channelUrl,!0),{memberCount:i,joinedMemberCount:a,members:r}=e.as(mn);let o=!1;r.forEach((e=>{n.isSuper||n.isBroadcast?o=o||n._setLatestMemberCount(i,a,s.ts):(e.state=rs.JOINED,n.addMember(e,s.ts),this._updateJoinedMemberCount(n)),e.userId===this._sdkState.userId&&(n.myMemberState=rs.JOINED)})),this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_JOINED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{for(const t of r)e.onUserJoined(n,t);n.isBroadcast&&o&&e.onChannelMemberCountChanged([n])}))}))));break}case qs.CHANNEL_LEAVE:{const n=this._leftChannels.get(s.channelUrl),i=n?n.channel:yield this.getChannel(s.channelUrl,!0),{memberCount:a,joinedMemberCount:r,member:o}=e.as(gn);let l=!1;i.isSuper||i.isBroadcast?l=i._setLatestMemberCount(a,r,s.ts):(i.removeMember(o),this._updateJoinedMemberCount(i)),o.userId===this._sdkState.userId?i.isPublic?(i.myMemberState=rs.NONE,i.invitedAt=0,i.joinedAt=0,i._updateUnreadCount(0,0),this._dispatcher.dispatch(new zs({channels:[i],source:Gs.EVENT_CHANNEL_LEFT}))):(this._markAsLeave(i),this._dispatcher.dispatch(new Ws({channelUrls:[i.url],source:Gs.EVENT_CHANNEL_LEFT}))):this._dispatcher.dispatch(new zs({channels:[i],source:Gs.EVENT_CHANNEL_LEFT})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onUserLeft(i,o),i.isBroadcast&&l&&e.onChannelMemberCountChanged([i])}))}))));break}case qs.CHANNEL_OPERATOR_UPDATE:{const n=yield this.getChannel(s.channelUrl,!0),{operators:i}=e.as(kn),a=i.map((e=>e.userId));for(const e of n.members)e.role=a.includes(e.userId)?pe.OPERATOR:pe.NONE;n.myRole=a.includes(this._sdkState.userId)?pe.OPERATOR:pe.NONE,this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_OPERATOR_UPDATED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onOperatorUpdated(n,i)}))}))));break}case qs.CHANNEL_INVITE:{const n=yield this.getChannel(s.channelUrl,!0),{memberCount:i,joinedMemberCount:a,inviter:r,invitees:o}=e.as(fn);o.forEach((e=>e.state=rs.INVITED));for(const e of o)n.isSuper||n.isBroadcast?n._setLatestMemberCount(i,a,s.ts):n.addMember(e,s.ts),this._sdkState.userId===e.userId&&(n.hiddenState=Ka.UNHIDDEN,n.myMemberState!==rs.JOINED&&(n.myMemberState=rs.INVITED),n.invitedAt=s.ts);this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_INVITED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onUserReceivedInvitation(n,r,o)}))}))));break}case qs.CHANNEL_DECLINE_INVITE:{const n=yield this.getChannel(s.channelUrl,!0),{memberCount:i,joinedMemberCount:a,inviter:r,invitee:o}=e.as(Tn);n.isSuper||n.isBroadcast?n._setLatestMemberCount(i,a,s.ts):n.removeMember(o),this._sdkState.userId===o.userId?(n.invitedAt=0,n.myMemberState=rs.NONE,n.isPublic?this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new Ws({channelUrls:[n.url],source:Gs.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_DECLINED_INVITE})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onUserDeclinedInvitation(n,r,o)}))}))));break}case qs.TYPING_START:case qs.TYPING_END:{const n=yield this.getChannel(s.channelUrl,!0),i=s.category===qs.TYPING_START,{user:a}=e.as(i?Rn:Ln);n._updateTypingStatus(a,i?s.ts:0),this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onTypingStatusUpdated(n)}))}))));break}case qs.USER_CHANNEL_MUTE:case qs.USER_CHANNEL_UNMUTE:{const n=yield this.getChannel(s.channelUrl,!0),i=s.category===qs.USER_CHANNEL_MUTE,{user:a}=e.as(i?Fn:qn);a.userId===this._sdkState.userId&&(n.myMutedState=i?$a.MUTED:$a.UNMUTED);for(const e of n.members)if(e.userId===a.userId){e.isMuted=i;break}this._dispatcher.dispatch(new zs({channels:[n],source:i?Gs.EVENT_CHANNEL_MUTED:Gs.EVENT_CHANNEL_UNMUTED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{i?e.onUserMuted(n,a):e.onUserUnmuted(n,a)}))}))));break}case qs.USER_CHANNEL_BAN:{const n=this._leftChannels.get(s.channelUrl),i=n?n.channel:yield this.getChannel(s.channelUrl,!0);this._markAsLeave(i);const{user:a}=e.as(Vn);W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onUserBanned(i,a)}))}))));break}case qs.USER_CHANNEL_UNBAN:{const n=yield this.getChannel(s.channelUrl,!0),{user:i}=e.as(Qn);W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onUserUnbanned(n,i)}))}))));break}case qs.CHANNEL_FREEZE:case qs.CHANNEL_UNFREEZE:{const n=yield this.getChannel(s.channelUrl,!0),{freeze:i}=e.as(Kn);n.isFrozen=i,this._dispatcher.dispatch(new zs({channels:[n],source:i?Gs.EVENT_CHANNEL_FROZEN:Gs.EVENT_CHANNEL_UNFROZEN})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{i?e.onChannelFrozen(n):e.onChannelUnfrozen(n)}))}))));break}case qs.CHANNEL_HIDE:{const n=yield this.getChannel(s.channelUrl,!0),{allowAutoUnhide:i,hidePreviousMessages:a,messageOffsetTimestamp:r}=e.as(wn);null!==i&&(n.hiddenState=i?Ka.HIDDEN_ALLOW_AUTO_UNHIDE:Ka.HIDDEN_PREVENT_AUTO_UNHIDE),null!==a&&a&&n._updateUnreadCount(0,0),null!==r&&(n.messageOffsetTimestamp=r),this._dispatcher.dispatch(new zs({channels:[n],source:Gs.EVENT_CHANNEL_HIDDEN})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{e.onChannelHidden(n)}))}))));break}case qs.CHANNEL_UNHIDE:{const e=yield this.getChannel(s.channelUrl,!0);e.hiddenState=Ka.UNHIDDEN,this._dispatcher.dispatch(new zs({channels:[e],source:Gs.EVENT_CHANNEL_UNHIDDEN})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((t=>{t.onChannelChanged(e)}))}))));break}case qs.CHANNEL_DELETED:{const e=yield this.getChannel(s.channelUrl,!0);this._dispatcher.dispatch(new Ws({channelUrls:[s.channelUrl],source:Gs.EVENT_CHANNEL_DELETED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((t=>{t.onChannelDeleted(e.url,e.channelType)}))}))));break}case qs.CHANNEL_PROP_CHANGED:{const e=yield this.getChannelWithoutCache(s.channelUrl,!0);this._dispatcher.dispatch(new zs({channels:[e],source:Gs.EVENT_CHANNEL_UPDATED})),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((t=>{t.onChannelChanged(e)}))}))));break}case qs.CHANNEL_META_DATA_CHANGED:{const n=yield this.getChannel(s.channelUrl,!0),{created:i,updated:a,deleted:r}=e.as(Wn);i&&n._upsertCachedMetaData(i,s.ts),a&&n._upsertCachedMetaData(a,s.ts),r&&n._removeFromCachedMetaData(r,s.ts),W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{i&&e.onMetaDataCreated(n,i),a&&e.onMetaDataUpdated(n,a),r&&e.onMetaDataDeleted(n,r)}))}))));break}case qs.CHANNEL_META_COUNTERS_CHANGED:{const n=yield this.getChannel(s.channelUrl,!0),{created:i,updated:a,deleted:r}=e.as(Xn);W((()=>t(this,void 0,void 0,(function*(){this._groupChannelHandlers.forEach((e=>{i&&e.onMetaCounterCreated(n,i),a&&e.onMetaCounterUpdated(n,a),r&&e.onMetaCounterDeleted(n,r)}))}))));break}}break}case"USEV":{const{event:t}=e.as(Zs);switch(t.category){case Hs.USER_BLOCK:const{blocker:e,blockee:s}=Vs.getDataAsUserBlockEvent(this._iid,t);this._groupChannelCache.block(e.userId,s.userId);break;case Hs.USER_UNBLOCK:{const{blocker:e,blockee:s}=Vs.getDataAsUserBlockEvent(this._iid,t);this._groupChannelCache.unblock(e.userId,s.userId);break}}break}}}catch(e){if(a(e))throw e}}))}_markAsLeave(e){var t;const s=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};s.ref++,this._leftChannels.set(e.url,s),setTimeout((()=>{s.ref--,0===s.ref&&this._leftChannels.delete(e.url)}),1e4)}addHandler(e,t){this._groupChannelHandlers.set(e,t)}removeHandler(e){this._groupChannelHandlers.delete(e)}clearHandler(){this._groupChannelHandlers.clear()}subscribeGroupChannelEvent(e,t){this._groupChannelBroadcast.subscribe(e,t)}unsubscribeGroupChannelEvent(e){this._groupChannelBroadcast.unsubscribe(e)}subscribeMessageEvent(e,t){this._messageBroadcast.subscribe(e,t)}unsubscribeMessageEvent(e){this._messageBroadcast.unsubscribe(e)}_updateJoinedMemberCount(e){e.joinedMemberCount=e.members.filter((e=>e.state===rs.JOINED)).length}getChannel(e,s=!1){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);try{const t=yield this.getChannelFromCache(e);if(t)return t}catch(e){}return yield this.getChannelWithoutCache(e,s)}))}getChannelWithoutCache(e,s=!1){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const t=new sn({channelUrl:e,isInternalCall:s}),n=yield this._requestQueue.send(t),{channel:i}=n.as(nn);let{unreadMessageCount:a,unreadMentionCount:o}=i;switch(i.myCountPreference){case Qa.UNREAD_MESSAGE_COUNT_ONLY:o=0;break;case Qa.UNREAD_MENTION_COUNT_ONLY:a=0;break;case Qa.OFF:a=0,o=0}return i._updateUnreadCount(a,o),yield this._groupChannelCache.upsert([i]),i}))}getMyGroupChannels(e,s,n,i=Gs.REQUEST_CHANNEL){return t(this,void 0,void 0,(function*(){const t=new an(Object.assign(Object.assign({},s),{userId:this._sdkState.userId,token:e,limit:n})),a=yield this._requestQueue.send(t),{channels:r,token:o}=a.as(rn);return this._dispatcher.dispatch(new zs({channels:r,source:i})),{channels:r,token:o}}))}getMessageFromCache(e){return t(this,void 0,void 0,(function*(){return yield this._messageCache.get(e)}))}getMessagesFromCache(e,s,n,i,a=100){return t(this,void 0,void 0,(function*(){return yield this._messageCache.fetch({channelUrl:e,token:s,limit:a,filter:i,backward:"next"===n})}))}getAllFailedMessagesFromCache(e,s){return t(this,void 0,void 0,(function*(){return yield this._unsentMessageCache.fetch({channelUrl:e,filter:s})}))}removeFailedMessageFromCache(e){return t(this,void 0,void 0,(function*(){yield this._unsentMessageCache.remove([e])}))}getCachedMessageCountBetween(e,s,n,i){return t(this,void 0,void 0,(function*(){return yield this._messageCache.countBetween(e,s,new _i({top:n,bottom:i}))}))}getMyGroupChannelChangeLogs(e,s,n=Gs.REQUEST_CHANNEL_CHANGELOGS){return t(this,void 0,void 0,(function*(){Oe(h("string",e)&&s instanceof $s&&s.validate()).throw(r.invalidParameters);const t=new en(C({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:s})),i=(yield this._requestQueue.send(t)).as(tn),{updatedChannels:a,deletedChannelUrls:o}=i;return a.length>0&&this._dispatcher.dispatch(new zs({channels:a,source:n})),o.length>0&&this._dispatcher.dispatch(new Ws({channelUrls:o,source:n})),i}))}getGroupChannelCount(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Ks&&e.validate()).throw(r.invalidParameters);const t=new on({userId:this._sdkState.userId,filter:e}),s=yield this._requestQueue.send(t),{groupChannelCount:n}=s.as(ln);return n}))}createChannel(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Qs&&e.validate()).throw(r.invalidParameters),e.isPublic||(e.accessCode=null);const t=new hn(Object.assign({userId:this._sdkState.userId},e)),s=yield this._requestQueue.send(t),{channel:n}=s.as(cn);return yield this._groupChannelCache.upsert([n]),n}))}markAsReadAll(){return t(this,void 0,void 0,(function*(){const e=Date.now();Oe(e-this._markAsReadAllLastSentAt>=1e3).throw(r.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e;const t=new dn({userId:this._sdkState.userId});yield this._requestQueue.send(t);const s=this._groupChannelCache.channels;for(const t of s)t._updateUnreadMemberState(this._sdkState.userId,e),t._updateUnreadCount(0,0);s.length>0&&(yield this._groupChannelCache.upsert(s))}))}markAsReadWithChannelUrls(e){return t(this,void 0,void 0,(function*(){const t=Date.now();Oe(d("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(r.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t;const s=new dn({userId:this._sdkState.userId,channelUrls:e});yield this._requestQueue.send(s);const n=this._groupChannelCache.channels,i=[];for(const s of n)e.includes(s.url)&&(s._updateUnreadMemberState(this._sdkState.userId,t),s._updateUnreadCount(0,0),i.push(s));i.length>0&&(yield this._groupChannelCache.upsert(i))}))}markAsDelivered(e){return t(this,void 0,void 0,(function*(){const t=yield this.getChannel(e);yield t.markAsDelivered()}))}}class Ei extends T{constructor({channelUrl:e,channelType:t,token:s,limit:n}){super(),this.method=N.GET,this.path=`${Ce(t)}/${encodeURIComponent(e)}/operators`,this.params={token:s,limit:n}}}class gi extends I{constructor(e,t){super(e,t),this.operators=t.operators.map((t=>new ke(e,t))),this.token=t.next}}class yi extends cs{constructor(e,t,s,n){super(e,t,s,n)}_validate(){return super._validate()}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;{const e=[];if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new Ei(Object.assign(Object.assign({},this),{channelUrl:this.channelUrl,token:this._token})),s=yield e.send(t),{operators:n,token:i}=s.as(gi);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return e}}throw r.invalidParameters}))}}class vi extends T{constructor(e){const{channelUrl:t,channelType:s,limit:n,token:i}=e;super(),this.method=N.GET,this.path=`${Ce(s)}/${encodeURIComponent(t)}/mute`,this.params={limit:n,token:i}}}class fi extends I{constructor(e,t){super(e,t),this.token=null,this.mutedUsers=[];const{next:s,muted_list:n}=t;this.token=s,n&&n.length>0&&(this.mutedUsers=n.map((t=>new _s(e,t))))}}class Ci extends cs{constructor(e,t,s,n){super(e,t,s,n)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new vi(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{mutedUsers:n,token:i}=s.as(fi);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}class Ni extends T{constructor(e){const{channelUrl:t,channelType:s,limit:n,token:i}=e;super(),this.method=N.GET,this.path=`${Ce(s)}/${encodeURIComponent(t)}/ban`,this.params=C({limit:n,token:i})}}class Ti extends I{constructor(e,t){super(e,t),this.token=null,this.bannedUsers=[];const{next:s,banned_list:n}=t;this.token=s,n&&n.length>0&&(this.bannedUsers=n.map((t=>new _s(e,t.user))))}}class Ii extends cs{constructor(e,t,s,n){super(e,t,s,n)}_validate(){return super._validate()}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new Ni(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{bannedUsers:n,token:i}=s.as(Ti);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}var Si;!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}(Si||(Si={}));class Ai extends T{constructor(e){const{channelUrl:t,channelType:s,operatorUserIds:n}=e;super(),this.method=N.POST,this.path=`${Ce(s)}/${encodeURIComponent(t)}/operators`,this.params={operator_ids:n}}}class Ui extends T{constructor(e){const{channelUrl:t,channelType:s,operatorUserIds:n}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/operators`,this.params={operator_ids:n}}}class Mi extends T{constructor(e){const{channelUrl:t,channelType:s,userId:n}=e;super(),this.method=N.GET,this.path=`${Ce(s)}/${encodeURIComponent(t)}/mute/${n}`}}class bi extends I{constructor(e,t){super(e,t),this.isMuted=!1,this.startAt=null,this.endAt=null,this.remainingDuration=null,this.description=null;const{is_muted:s,start_at:n,end_at:i,remaining_duration:a,description:r}=t;this.isMuted=s,this.startAt=n,this.endAt=i,this.remainingDuration=a,this.description=r}}class wi extends T{constructor(e){const{channelUrl:t,channelType:s,keys:n}=e;super(),this.method=N.GET,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metadata`,this.params={keys:n,include_ts:!0}}}class Di extends I{constructor(e,t){super(e,t),this.ts=null;const{metadata:s,ts:n}=t;this.metadata=s,this.ts=null!=n?n:null}}class Ri extends T{constructor(e){const{channelUrl:t,channelType:s,key:n}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metadata/${n}`,this.params={include_ts:!0}}}class Oi extends I{constructor(e,t){super(e,t),this.ts=null;const{ts:s}=t;this.ts=null!=s?s:null}}class Li extends T{constructor(e){const{channelUrl:t,channelType:s}=e;super(),this.method=N.PUT,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metadata`,this.params={include_ts:!0}}}class ki extends I{constructor(e,t){super(e,t),this.ts=null;const{ts:s}=t;this.ts=null!=s?s:null}}class xi extends T{constructor(e){const{channelUrl:t,channelType:s,keys:n}=e;super(),this.method=N.GET,this.path=`${Ce(s)}/${encodeURIComponent(t)}/ban`,this.params={keys:n}}}class Pi extends I{constructor(e,t){super(e,t),this.metaCounter=t}}class Fi extends T{constructor(e){const{channelUrl:t,channelType:s,metaCounter:n}=e;super(),this.method=N.POST,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metacounter`,this.params={metacounter:n}}}class Hi extends I{constructor(e,t){super(e,t),this.metaCounter=t}}class qi extends T{constructor(e){const{channelUrl:t,channelType:s,key:n}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metacounter/${n}`,this.params=null}}class Gi extends T{constructor(e){const{channelUrl:t,channelType:s}=e;super(),this.method=N.DELETE,this.path=`${Ce(s)}/${encodeURIComponent(t)}/metacounter`,this.params=null}}class Vi extends T{constructor(e){const{channelUrl:t,channelType:s,category:n,userId:i,description:a}=e;super(),this.method=N.POST,this.path=`${Ne(s)}/${encodeURIComponent(t)}`,this.params={report_category:n,reporting_user_id:i,report_description:a}}}class ji extends T{constructor(e){const{channelUrl:t,channelType:s,category:n,userId:i,offendingUserId:a,description:r}=e;super(),this.method=N.POST,this.path=`/report/users/${a}`,this.params={channel_url:t,channel_type:s===_e.OPEN?"open_channels":"group_channels",report_category:n,reporting_user_id:i,report_description:r}}}class Qi extends T{constructor(e){const{channelUrl:t,channelType:s,category:n,userId:i,offendingUserId:a,messageId:r,description:o}=e;super(),this.method=N.POST,this.path=`${Ne(s)}/${encodeURIComponent(t)}/messages/${r}`,this.params={report_category:n,reporting_user_id:i,report_description:o,offending_user_id:a}}}class $i extends T{constructor({channelType:e,channelUrl:t,messageId:s,reactionKey:n}){super(),this.method=N.POST,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages/${s}/reactions`,this.params={reaction:n}}}class Ki extends I{constructor(e,t){super(e,t),this.reactionEvent=new Ze(t)}}class Bi extends T{constructor({channelType:e,channelUrl:t,messageId:s,reactionKey:n}){super(),this.method=N.DELETE,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages/${s}/reactions`,this.params={reaction:n}}}class zi extends I{constructor(e,t){super(e,t),this.reactionEvent=new Ze(Object.assign({},t))}}class Wi extends T{constructor({channelType:e,channelUrl:t,messageId:s,translationTargetLanguages:n}){super(),this.method=N.POST,this.path=`${Ce(e)}/${encodeURIComponent(t)}/messages/${encodeURIComponent(s)}/translation`,this.params={target_langs:n}}}class Yi extends I{constructor(e,t){super(e,t),this.message=new vt(e,t)}}class Ji extends le{constructor(e,t){var s,n,i,a;super(e),this.url="",this.channelType=_e.BASE,this.name="",this.coverUrl="",this.customType="",this.data="",this.isFrozen=!1,this.isEphemeral=!1,this.creator=null,this.createdAt=0,this.url=t.channel_url,this.name=null!==(s=t.name)&&void 0!==s?s:"",this.coverUrl=null!==(n=t.cover_url)&&void 0!==n?n:"",this.customType=null!==(i=t.custom_type)&&void 0!==i?i:"",this.data=null!==(a=t.data)&&void 0!==a?a:"",this.isFrozen=!!h("boolean",t.freeze)&&t.freeze,this.isEphemeral=!!h("boolean",t.is_ephemeral)&&t.is_ephemeral,this.creator=t.created_by?new ke(this._iid,t.created_by):null,this.createdAt=1e3*t.created_at,this._cachedMetaData=new Map,t.metadata&&t.ts&&Object.keys(t.metadata).forEach((e=>{this._cachedMetaData.set(e,{value:t.metadata[e],isRemoved:!1,updatedAt:t.ts})}))}static payloadify(e){return C(Object.assign(Object.assign({},super.payloadify(e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:ke.payloadify(e.creator),created_at:e.createdAt/1e3}))}get isGroupChannel(){return this.channelType===_e.GROUP}get isOpenChannel(){return this.channelType===_e.OPEN}get cachedMetaData(){const e={};return this._cachedMetaData.forEach(((t,s)=>{t.isRemoved||(e[s]=t.value)})),e}_upsertCachedMetaData(e,t){Object.keys(e).forEach((s=>{const n=this._cachedMetaData.get(s);(!n||n.updatedAt<=t)&&this._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:t})}))}_removeFromCachedMetaData(e,t){e.forEach((e=>{const s=this._cachedMetaData.get(e);s&&s.updatedAt<t&&(s.isRemoved=!1,s.updatedAt=t)}))}_generateRequestId(){return`rq-${E()}`}isIdentical(e){return e&&this.url===e.url}isEqual(e){return l(this,e)}createOperatorListQuery(e={}){return new yi(this._iid,this.url,this.channelType,e)}createMutedUserListQuery(e={}){return new Ci(this._iid,this.url,this.channelType,e)}createBannedUserListQuery(e={}){return new Ii(this._iid,this.url,this.channelType,e)}createPreviousMessageListQuery(e={}){return new ds(this._iid,this.url,this.channelType,e)}addOperators(e){return t(this,void 0,void 0,(function*(){Oe(d("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new Ai({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e});yield t.send(s)}))}removeOperators(e){return t(this,void 0,void 0,(function*(){Oe(d("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new Ui({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e});yield t.send(s)}))}getMyMutedInfo(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new Mi({channelUrl:this.url,channelType:this.channelType,userId:e.userId}),n=yield t.send(s),{isMuted:i,startAt:a,endAt:r,remainingDuration:o,description:l}=n.as(bi);return{isMuted:i,startAt:a,endAt:r,remainingDuration:o,description:l}}))}getMetaData(e){return t(this,void 0,void 0,(function*(){Oe(d("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new wi({channelUrl:this.url,channelType:this.channelType,keys:e}),n=yield t.send(s),{metadata:i,ts:a}=n.as(Di);return this._upsertCachedMetaData(i,a),i}))}getAllMetaData(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new wi({channelUrl:this.url,channelType:this.channelType,keys:[]}),s=yield e.send(t),{metadata:n,ts:i}=s.as(Di);return this._upsertCachedMetaData(n,i),n}))}createMetaData(e){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),s=new Se({channelUrl:this.url,channelType:this.channelType,metadata:e}),n=yield t.send(s),{metaData:i}=n.as(Ae);return this._upsertCachedMetaData(i,0),i}))}updateMetaData(e,s=!1){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),n=new Bn({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:s}),i=yield t.send(n),{metadata:a,ts:r}=i.as(zn);return this._upsertCachedMetaData(a,r),a}))}deleteMetaData(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new Ri({channelUrl:this.url,channelType:this.channelType,key:e}),n=yield t.send(s),{ts:i}=n.as(Oi);this._removeFromCachedMetaData([e],i)}))}deleteAllMetaData(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Li({channelUrl:this.url,channelType:this.channelType}),s=yield e.send(t),{ts:n}=s.as(ki);this._removeFromCachedMetaData([...this._cachedMetaData.keys()],n)}))}getMetaCounters(e){return t(this,void 0,void 0,(function*(){Oe(d("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new xi({channelUrl:this.url,channelType:this.channelType,keys:e}),n=yield t.send(s),{metaCounter:i}=n.as(Pi);return i}))}getAllMetaCounters(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new xi({channelUrl:this.url,channelType:this.channelType,keys:[]}),s=yield e.send(t),{metaCounter:n}=s.as(Pi);return n}))}createMetaCounters(e){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),s=new Fi({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),n=yield t.send(s),{metaCounter:i}=n.as(Hi);return i}))}updateMetaCounters(e,s=!1){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),n=new Yn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:s}),i=yield t.send(n),{metaCounter:a}=i.as(Jn);return a}))}increaseMetaCounters(e){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),s=new Yn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),n=yield t.send(s),{metaCounter:i}=n.as(Jn);return i}))}decreaseMetaCounters(e){return t(this,void 0,void 0,(function*(){const{requestQueue:t}=Ve.of(this._iid),s=new Yn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),n=yield t.send(s),{metaCounter:i}=n.as(Jn);return i}))}deleteMetaCounter(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new qi({channelUrl:this.url,channelType:this.channelType,key:e});yield t.send(s)}))}deleteAllMetaCounters(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Gi({channelUrl:this.url,channelType:this.channelType});yield e.send(t)}))}muteUser(e,s,n){return t(this,void 0,void 0,(function*(){return this.muteUserWithUserId(e.userId,s,n)}))}muteUserWithUserId(e,s,n){return t(this,void 0,void 0,(function*(){Oe(h("string",e)&&h("number",s,!0)&&h("string",n,!0)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),i=new Pn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:s,description:n});yield t.send(i)}))}unmuteUser(e){return t(this,void 0,void 0,(function*(){return this.unmuteUserWithUserId(e.userId)}))}unmuteUserWithUserId(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new Hn({channelUrl:this.url,channelType:this.channelType,userId:e});yield t.send(s)}))}banUser(e,s,n){return t(this,void 0,void 0,(function*(){return this.banUserWithUserId(e.userId,s,n)}))}banUserWithUserId(e,s,n){return t(this,void 0,void 0,(function*(){Oe(h("string",e)&&h("number",s,!0)&&h("string",n,!0)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),i=new Gn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:s,description:n});yield t.send(i)}))}unbanUser(e){return t(this,void 0,void 0,(function*(){return this.unbanUserWithUserId(e.userId)}))}unbanUserWithUserId(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new jn({channelUrl:this.url,channelType:this.channelType,userId:e});yield t.send(s)}))}freeze(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new $n({channelUrl:this.url,channelType:this.channelType,freezing:!0});yield e.send(t),this.isFrozen=!0}))}unfreeze(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new $n({channelUrl:this.url,channelType:this.channelType,freezing:!1});yield e.send(t),this.isFrozen=!1}))}getMessagesByTimestamp(e,s){return t(this,void 0,void 0,(function*(){Oe(h("number",e)&&s instanceof Ht).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getMessagesByTimestamp(this.url,this.channelType,e,s)}))}getMessageChangeLogsSinceTimestamp(e,s){return t(this,void 0,void 0,(function*(){Oe(h("number",e)&&s instanceof qt).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getMessageChangelogs(this.url,this.channelType,e,s)}))}getMessageChangeLogsSinceToken(e,s){return t(this,void 0,void 0,(function*(){Oe(h("string",e)&&s instanceof qt).throw(r.invalidParameters);const t=Lt.of(this._iid);return yield t.getMessageChangelogs(this.url,this.channelType,e,s)}))}_createPendingSendableMessagePayload(e,t){const{sessionManager:s}=Ve.of(this._iid);return C({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((e=>tt.payloadify(e))):null,apple_critical_alert_options:e.appleCriticalAlertOptions?it.payloadify(e.appleCriticalAlertOptions):null,created_at:Date.now(),user:ot.payloadify(s.currentUser),req_id:t,request_state:fe.PENDING,requested_mention_user_ids:e.mentionedUserIds})}_createPendingUserMessage(e,t){const s={};if(e.translationTargetLanguages)for(const t of e.translationTargetLanguages)s[t]="";const n=C(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(e,t)),{type:me.USER,message:e.message,translations:s}));return new vt(this._iid,n)}_createPendingFileMessage(e,t){const s=C(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(e,t)),{type:me.FILE,url:"string"==typeof e.file?e.file:"",file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes.map((e=>({url:"",width:e.maxWidth,height:e.maxHeight})))}));return new ct(this._iid,s)}_markMessageAsFailed(e,t){e.requestState=t.code!==s.REQUEST_CANCELED?fe.FAILED:fe.CANCELED,e.errorCode=t.code}sendUserMessage(e){Oe(e instanceof Qt).throw(r.invalidParameters);const{dispatcher:s,requestQueue:n}=Ve.of(this._iid),i=this._generateRequestId(),o=new kt,l=new ei(Object.assign({channelUrl:this.url,channelType:this.channelType,requestId:i},e));return n.send(l).then((e=>{const{message:n}=e.as(ti);s.dispatch(new Nt({messages:[n],source:Et.EVENT_MESSAGE_SENT_SUCCESS})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(null,n)}))))})).catch((n=>{if(a(n))throw n;{const a=this._createPendingUserMessage(e,i);this._markMessageAsFailed(a,n),s.dispatch(new Nt({messages:[a],source:Et.EVENT_MESSAGE_SENT_FAILED})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(n,a)}))))}})),K(5).then((()=>{const n=this._createPendingUserMessage(e,i);s.dispatch(new Nt({messages:[n],source:Et.EVENT_MESSAGE_SENT_PENDING})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(null,n)}))))})).catch((e=>{throw e})),o}resendUserMessage(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof vt).throw(r.invalidParameters);const t=new P,s=Qt.fromFailedUserMessage(e);return this.sendUserMessage(s).onFailed((e=>t.reject(e))).onSucceeded((e=>t.resolve(e))),t.promise}))}updateUserMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(h("number",e)&&s instanceof zt&&s.validate()).throw(r.invalidParameters);const{dispatcher:t,requestQueue:n}=Ve.of(this._iid),i=new ni(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},s)),a=yield n.send(i),{message:o}=a.as(ii);return t.dispatch(new Nt({messages:[o],source:Et.EVENT_MESSAGE_UPDATED})),o}))}copyUserMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof Ji&&s instanceof vt&&e.url===s.channelUrl).throw(r.invalidParameters);const t=new P,n=new Qt(Object.assign(Object.assign({},s),{mentionType:s.mentionType,mentionedUserIds:s.mentionedUsers.map((e=>e.userId)),translationTargetLanguages:Object.keys(s.translations),pushNotificationDeliveryOption:ve.DEFAULT,parentMessageId:null,isReplyToChannel:!1}));return e.sendUserMessage(n).onSucceeded((e=>t.resolve(e))).onFailed((e=>t.reject(e))),t.promise}))}translateUserMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof vt&&e.messageId>0&&d("string",s)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),n=new Wi({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:s}),i=yield t.send(n),{message:a}=i.as(Yi);return a}))}sendFileMessage(e){Oe(e instanceof Yt).throw(r.invalidParameters);const{dispatcher:s}=Ve.of(this._iid),{fileMessageQueue:n}=Lt.of(this._iid),i=this._generateRequestId(),o=new kt;return n.request(this,i,e).then((e=>{s.dispatch(new Nt({messages:[e],source:Et.EVENT_MESSAGE_SENT_SUCCESS})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(null,e)}))))})).catch((n=>{if(a(n))throw n;{const a=this._createPendingFileMessage(e,i);this._markMessageAsFailed(a,n),s.dispatch(new Nt({messages:[a],source:Et.EVENT_MESSAGE_SENT_FAILED})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(n,a)}))))}})),K(5).then((()=>{const n=this._createPendingFileMessage(e,i);s.dispatch(new Nt({messages:[n],source:Et.EVENT_MESSAGE_SENT_PENDING})),W((()=>t(this,void 0,void 0,(function*(){return o.trigger(null,n)}))))})).catch((e=>{throw e})),o}sendFileMessages(e){Oe(e.every((e=>e instanceof Yt))).throw(r.invalidParameters);const t=new kt;for(const s of e)this.sendFileMessage(s).onPending((e=>t.trigger(null,e))).onFailed(((e,s)=>t.trigger(e,s))).onSucceeded((e=>t.trigger(null,e)));return t}resendFileMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof ct&&s instanceof Blob).throw(r.invalidParameters);const t=new P,n=Yt.fromFailedFileMessage(e,s);return this.sendFileMessage(n).onFailed((e=>t.reject(e))).onSucceeded((e=>t.resolve(e))),t.promise}))}updateFileMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(h("number",e)&&s instanceof Xt).throw(r.invalidParameters);const{dispatcher:t,requestQueue:n}=Ve.of(this._iid),i=new ai(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},s)),a=yield n.send(i),{message:o}=a.as(ri);return t.dispatch(new Nt({messages:[o],source:Et.EVENT_MESSAGE_UPDATED})),o}))}cancelUploadingFileMessage(e){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const{fileMessageQueue:t}=Lt.of(this._iid);return t.cancel(this,e),!0}))}copyFileMessage(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof Ji&&s instanceof ct&&e.url===s.channelUrl).throw(r.invalidParameters);const t=new P,n=new Yt(Object.assign(Object.assign({},s),{file:s.url,fileName:s.name,fileSize:s.size,mimeType:s.type,mentionType:s.mentionType,mentionedUserIds:s.mentionedUsers.map((e=>e.userId)),pushNotificationDeliveryOption:ve.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:s.thumbnails.map((e=>({maxWidth:e.width,maxHeight:e.height})))}));return e.sendFileMessage(n).onSucceeded((e=>t.resolve(e))).onFailed((e=>t.reject(e))),t.promise}))}deleteMessage(e){return t(this,void 0,void 0,(function*(){if(Oe(e instanceof lt).throw(r.invalidParameters),e.messageId>0){const{requestQueue:t}=Ve.of(this._iid),s=new li({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId});yield t.send(s)}}))}addReaction(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof rt&&e.messageId>0&&h("string",s)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),n=new $i({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:s}),i=yield t.send(n),{reactionEvent:a}=i.as(Ki);return a}))}deleteReaction(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof rt&&e.messageId>0&&h("string",s)).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),n=new Bi({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:s}),i=yield t.send(n),{reactionEvent:a}=i.as(zi);return a}))}_updateMessageMetaArray(e,s,n,i){return t(this,void 0,void 0,(function*(){const{dispatcher:t,requestQueue:a}=Ve.of(this._iid),r=new ni({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{metaArrays:s,mode:n,upsert:i}}),o=yield a.send(r),{message:l}=o.as(ii);return t.dispatch(new Nt({messages:[l],source:Et.EVENT_MESSAGE_UPDATED})),l}))}createMessageMetaArrayKeys(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof lt&&e.messageId>0&&d("string",s)).throw(r.invalidParameters);const t=s.map((e=>new tt({key:e})));return this._updateMessageMetaArray(e.messageId,t,"add",!0)}))}deleteMessageMetaArrayKeys(e,s){return t(this,void 0,void 0,(function*(){Oe(e instanceof lt&&e.messageId>0&&d("string",s)).throw(r.invalidParameters);const t=s.map((e=>new tt({key:e})));return this._updateMessageMetaArray(e.messageId,t,"remove",!0)}))}addMessageMetaArrayValues(e,s){return t(this,void 0,void 0,(function*(){return Oe(e instanceof lt&&e.messageId>0&&s.every((e=>e instanceof tt))).throw(r.invalidParameters),this._updateMessageMetaArray(e.messageId,s,"add",!0)}))}removeMessageMetaArrayValues(e,s){return t(this,void 0,void 0,(function*(){return Oe(e instanceof lt&&e.messageId>0&&s.every((e=>e instanceof tt))).throw(r.invalidParameters),this._updateMessageMetaArray(e.messageId,s,"remove",!0)}))}report(e,s){return t(this,void 0,void 0,(function*(){Oe(c(Si,e)&&h("string",s)).throw(r.invalidParameters);const{sdkState:t,requestQueue:n}=Ve.of(this._iid),i=new Vi({channelUrl:this.url,channelType:this.channelType,userId:t.userId,category:e,description:s});yield n.send(i)}))}reportUser(e,s,n){return t(this,void 0,void 0,(function*(){Oe(e instanceof ke&&c(Si,s)&&h("string",n)).throw(r.invalidParameters);const{sdkState:t,requestQueue:i}=Ve.of(this._iid),a=new ji({channelUrl:this.url,channelType:this.channelType,userId:t.userId,offendingUserId:e.userId,category:s,description:n});yield i.send(a)}))}reportMessage(e,s,n){return t(this,void 0,void 0,(function*(){Oe(e instanceof lt&&c(Si,s)&&h("string",n)).throw(r.invalidParameters);const{sdkState:t,requestQueue:i}=Ve.of(this._iid),a=new Qi({channelUrl:this.url,channelType:this.channelType,userId:t.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:s,description:n});yield i.send(a)}))}}const Xi=()=>"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product,Zi=new Map,ea=new Map,ta=new Map;class sa{constructor({key:e,concurrentCallLimit:s=2,backOffDelay:n=0}){this._holdersKey=sa.createSemaphoreHoldersKey(e),this._resolversKey=sa.createSemaphoreResolversKey(e),this._chainProcessStateKey=sa.createChainProcessStateKey(e),this._numLocks=s,this._backOffDelay=n,this._localAcquiredKeys=[],this._localResolversData=[],Xi()?(Zi[this._holdersKey]||(Zi[this._holdersKey]=[]),ea[this._resolversKey]||(ea[this._resolversKey]=[])):(window.addEventListener("storage",(e=>t(this,void 0,void 0,(function*(){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:const t=JSON.parse(e.oldValue),s=JSON.parse(e.newValue);if(!t||!s||s.length>=t.length)return;this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))return;this._processChainResolve();break;default:return}})))),window.addEventListener("beforeunload",(()=>{const e=this._getLocalResolversData(),t=this._localResolversData.map((e=>e.key)),s=e.filter((e=>t.indexOf(e.key)<0));window.localStorage.setItem(this._resolversKey,JSON.stringify(s)),this._localAcquiredKeys.forEach((e=>this.release(e)))})))}static createSemaphoreHoldersKey(e){return"collection@semaphore_holders_for:"+e}static createSemaphoreResolversKey(e){return"collection@semaphore_resolvers_for:"+e}static createChainProcessStateKey(e){return"collection@semaphore_chain_process_state_for:"+e}get numLocks(){return this._numLocks}get backOffDelay(){return this._backOffDelay}get numLocksAvailable(){if(Xi())return this.numLocks-Zi[this._holdersKey].length;{const e=this._getLocalHoldersData();return this.numLocks-e.length}}get waitCount(){if(Xi())return ea[this._resolversKey].length;return this._getLocalResolversData().length}_hasHighestPriorityResolver(){const e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map((e=>e.key)).indexOf(e[0].key)>=0}_isProcessChainAcquireRunning(){if(Xi())return ta[this._chainProcessStateKey];{const e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)}}_setProcessChainAcquireRunning(e){Xi()?ta[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)}_processChainResolve(){return t(this,void 0,void 0,(function*(){if(this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning())if(this._setProcessChainAcquireRunning(!0),this._tryResolve()&&(yield K(this._backOffDelay)),this._setProcessChainAcquireRunning(!1),Xi())this._processChainResolve();else{const e=new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)});dispatchEvent(e)}}))}acquire(e=0){return t(this,void 0,void 0,(function*(){if(Xi())return new Promise((t=>{const s={key:E(),resolver:e=>t(e),priority:e},n=ea[this._resolversKey];let i=-1;for(let t=0;t<n.length;t++)if(e>n[t].priority){i=t;break}i>=0?ea[this._resolversKey].splice(i,0,s):ea[this._resolversKey].push(s),this._processChainResolve()}));{const t=this._getLocalResolversData();return new Promise((s=>{const n=E(),i={key:n,priority:e},a={key:n,resolver:e=>s(e),priority:e};let r=-1;for(let s=0;s<t.length;s++)if(e>t[s].priority){r=s;break}r>=0?(t.splice(r,0,i),this._localResolversData.splice(r,0,a)):(t.push(i),this._localResolversData.push(a)),window.localStorage.setItem(this._resolversKey,JSON.stringify(t)),this._processChainResolve()}))}}))}release(e){if(Xi()){const t=Zi[this._holdersKey].indexOf(e);if(t>=0)return Zi[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else{const t=JSON.parse(window.localStorage[this._holdersKey]),s=[...t],n=t.indexOf(e);if(n>=0){t.splice(n,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(t)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1);const i=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(s),newValue:JSON.stringify(t)});return dispatchEvent(i),!0}}return!1}_tryResolve(){if(Xi()){if(Zi[this._holdersKey].length<this.numLocks){const e=E();Zi[this._holdersKey]=[...Zi[this._holdersKey],e];return ea[this._resolversKey].shift().resolver(e),!0}}else{const e=this._getLocalHoldersData();if(e.length<this.numLocks){const t=E(),s=this._localResolversData.shift(),n=this._getLocalResolversData();let i=n.map((e=>e.key)).indexOf(s.key);n.splice(i,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(n)),window.localStorage.setItem(this._holdersKey,JSON.stringify([...e,t])),this._localAcquiredKeys.push(t);const a=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify([...e]),newValue:JSON.stringify([...e,t])});dispatchEvent(a);return(0,s.resolver)(t),!0}}return!1}_getLocalHoldersData(){const e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]}_getLocalResolversData(){const e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]}}var na;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(na||(na={}));class ia extends y{constructor(e,t,s=2,n=10){super(),this._worker=null,this._state=na.IDLE,this._semaphore=null,this._retryCount=0,this._retryLimit=3,this.priority=0,this._worker=t,this._semaphore=new sa({key:e,concurrentCallLimit:s,backOffDelay:n})}get isIdle(){return this._state===na.IDLE}get isRunning(){return this._state===na.RUNNING}get isDone(){return this._state===na.END}get retryCount(){return this._retryCount}get retryLimit(){return this._retryLimit}_run(e){return t(this,void 0,void 0,(function*(){if(this.isRunning){this._key=yield this._semaphore.acquire(this.priority);try{const t=yield this._worker(e);this._retryCount=0,this.dispatch("progress",t),t.hasNext?(this._run(t.nextToken),this._semaphore.release(this._key)):this.end()}catch(t){this.dispatch("error",t),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e),this._semaphore.release(this._key)):this.stop()}}}))}start(e){this.isIdle&&(this._state=na.RUNNING,this._run(e))}stop(){this._state=na.IDLE,this.dispatch("stop"),this._semaphore.release(this._key)}end(){this._state=na.END,this.dispatch("end"),this._semaphore.release(this._key)}}class aa{constructor(e){this.source=e}}class ra{constructor(e){this.source=e}}const oa={};class la{constructor({_iid:e,channel:s}){this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=e,this._channel=s;const{sdkState:n}=Ve.of(this._iid);var i,a;this._metadataKey=(i=n.userId,a=s.url,`sendbird:${i}@groupchannel/${a}/message/sync.meta`);const r=((e,t)=>`sendbird:${e}@groupchannel/${t}/message/sync`)(n.userId,s.url);this._prevSync=new ia(r,(e=>t(this,void 0,void 0,(function*(){const e={hasNext:!0,nextToken:0};if(yield this.loadMetadata(),this._metadata.previousComplete)e.hasNext=!1;else{const t=Lt.of(this._iid),s=yield t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,this._metadata.range.top,{prevResultSize:100,nextResultSize:0,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},Et.SYNC_MESSAGE_BACKGROUND);this.extendRange(s),e.hasNext=s.length>=100,e.nextToken=this._metadata.range.top,this._metadata.previousComplete=e.hasNext,yield this.saveMetadata()}return e})))),this._nextSync=new ia(r,(e=>t(this,void 0,void 0,(function*(){const e={hasNext:!0,nextToken:0};yield this.loadMetadata();const t=Lt.of(this._iid),s=yield t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,this._metadata.range.top,{prevResultSize:0,nextResultSize:100,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},Et.SYNC_MESSAGE_BACKGROUND);return this.extendRange(s),e.hasNext=s.length>=100,e.nextToken=this._metadata.range.bottom,yield this.saveMetadata(),e}))))}static of(e,t){if(oa[e]||(oa[e]={}),!oa[e][t.url]){const s=oa[e][t.url]=new la({_iid:e,channel:t}),{dispatcher:n}=Ve.of(e);n.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)s.resume();else s.pause()}))}return oa[e][t.url]}get range(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}get previousComplete(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)}extendRange(e){this._metadata&&this._metadata.range.extends(...e.map((e=>e.createdAt)))}loadMetadata(){return t(this,void 0,void 0,(function*(){if(!this._metadata){const{cacheContext:e}=Ve.of(this._iid),t=yield e.store.get(this._metadataKey);this._metadata={range:new _i(t?t.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),previousComplete:!!t&&t.previousComplete}}}))}saveMetadata(){return t(this,void 0,void 0,(function*(){if(this._metadata){const{cacheContext:e}=Ve.of(this._iid);yield e.store.set({key:this._metadataKey,value:this._metadata,generation:1})}}))}resume(){var e,t,s,n;this._metadata&&!this._metadata.previousComplete&&this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(n=null===(s=this._metadata)||void 0===s?void 0:s.range.bottom)&&void 0!==n?n:Date.now())}pause(){this._prevSync.stop(),this._nextSync.stop()}}const ha={};class ca{constructor({_iid:e,channel:s}){this._sync=null,this._metadata=null,this._iid=e,this._channel=s;const{sdkState:n}=Ve.of(this._iid);var i,a;this._metadataKey=(i=n.userId,a=s.url,`sendbird:${i}@groupchannel/${a}/message/changelogs.meta`);const r=((e,t)=>`sendbird:${e}@groupchannel/${t}/message/changelogs`)(n.userId,this._channel.url);this._sync=new ia(r,(()=>t(this,void 0,void 0,(function*(){const e={hasNext:!0,nextToken:0};yield this.loadMetadata();const t=Lt.of(this._iid),{hasMore:s,token:n}=yield t.getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{},Et.SYNC_MESSAGE_CHANGELOGS);return e.hasNext=s,e.nextToken=n,this._metadata.token=n,yield this.saveMetadata(),e}))))}static of(e,t){if(ha[e]||(ha[e]={}),!ha[e][t.url]){const s=ha[e][t.url]=new ca({_iid:e,channel:t}),{dispatcher:n}=Ve.of(e);n.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)s.resume();else s.pause()}))}return ha[e][t.url]}loadMetadata(){return t(this,void 0,void 0,(function*(){if(!this._metadata){const{cacheContext:e}=Ve.of(this._iid),t=yield e.store.get(this._metadataKey);this._metadata={token:t?t.token:0}}}))}saveMetadata(){return t(this,void 0,void 0,(function*(){if(this._metadata){const{cacheContext:e}=Ve.of(this._iid);yield e.store.set({key:this._metadataKey,value:this._metadata,generation:1})}}))}resume(){this._sync.start(0)}pause(){this._sync.stop()}}class da extends T{constructor(e){var t,s,n,i,a,r;super(),this.method=N.POST,this.path=`${Ce(e.channelType)}/${e.channelUrl}/messages_gap`,this.params=C({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(t=e.threshold)&&void 0!==t?t:null,reverse:!0,custom_types:null!==(s=e.customTypes)&&void 0!==s?s:["*"],message_type:null!==(n=e.messageType)&&void 0!==n?n:"",include_reactions:null===(i=e.includeReactions)||void 0===i||i,with_sorted_meta_array:null!==(a=e.includeMetaArray)&&void 0!==a&&a,show_subchannel_messages_only:null!==(r=e.showSubchannelMessagesOnly)&&void 0!==r&&r})}}class ua extends I{constructor(e,t){var s,n,i,a;super(e,t),this.isHugeGap=t.is_huge_gap,this.prevMessages=(null!==(s=t.prev_messages)&&void 0!==s?s:[]).map((t=>At(e,t))),this.prevHasMore=null!==(n=t.prev_hasmore)&&void 0!==n&&n,this.nextMessages=(null!==(i=t.next_messages)&&void 0!==i?i:[]).map((t=>At(e,t))),this.nextHasmore=null!==(a=t.next_hasmore)&&void 0!==a&&a}}const _a=(e,t)=>e.findIndex((e=>e.isIdentical(t))),pa=(e,t,s)=>{if(e.length>0){const n=_a(e,t);if(n<0){let n=0,i=e.length-1,a=Math.floor((n+i)/2);for(;n<i;){const r=ma(e[a],t,s);if(r>0)i=a,a=Math.floor((n+i)/2);else{if(!(r<0))return{place:a,contains:e[a].isIdentical(t)};n=a+1,a=Math.floor((n+i)/2)}}return{place:ma(e[a],t,s)>0?a:a+1,contains:!1}}return{place:n,contains:!0}}return{place:e.length,contains:!1}},ma=(e,t,s)=>{switch(s){case os.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case os.CHRONOLOGICAL:return t.createdAt-e.createdAt;case os.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},Ea=(e,t)=>{if(t instanceof lt)return e.findIndex((e=>e instanceof lt&&t.isIdentical(e)));e.findIndex((e=>e.isIdentical(t)))},ga=(e,t)=>{if(e.length>0){let s=0,n=e.length-1,i=Math.floor((s+n)/2);for(;s<n;){const a=e[i].createdAt-t.createdAt;if(a>0)n=i,i=Math.floor((s+n)/2);else{if(!(a<0))return i;s=i+1,i=Math.floor((s+n)/2)}}return e[i].createdAt>t.createdAt?i:i+1}return e.length};var ya,va,fa;!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api",e.API_ONLY="api_only"}(ya||(ya={}));class Ca{invokeResponse(e,s,n){W((()=>t(this,void 0,void 0,(function*(){switch(e){case"local":this._onCacheResult(s,n);break;case"remote":this._onApiResult(s,n)}}))))}onCacheResult(e){return this._onCacheResult=e,this}onApiResult(e){return this._onApiResult=e,this}}class Na{constructor(e,{channel:s,filter:n,limit:i}){this._channel=null,this._messages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=e,this._key=`mc-${E()}`,this.filter=null!=n?n:new Rs,this._channel=s,this._syncRange=new _i({}),this._hasPrevious=!0,this._hasNext=!0,this._limit=i||100;const a=mi.of(this._iid);a.subscribeGroupChannelEvent(this._key,{onUpdate:(e,s)=>{const n=_a(e,this._channel);if(n>=0)switch(W((()=>t(this,void 0,void 0,(function*(){const t=new aa(s);this._channel=e[n],this._handler.onChannelUpdated(t,this.channel)})))),s){case Gs.EVENT_CHANNEL_READ:{const e=[];for(const t of this._messages){const s=this._readReceiptMap.get(t.messageId);if(s>0){s!==this._channel.getUnreadMemberCount(t)&&e.push(t)}}e.length>0&&this._updateMessagesToView(e,Et.EVENT_MESSAGE_READ);break}case Gs.EVENT_CHANNEL_DELIVERED:{const e=[];for(const t of this._messages){const s=this._deliveryReceiptMap.get(t.messageId);if(s>0){s!==this._channel.getUndeliveredMemberCount(t)&&e.push(t)}}e.length>0&&this._updateMessagesToView(e,Et.EVENT_MESSAGE_READ);break}}},onRemove:(e,s)=>{e.indexOf(this.channel.url)>=0&&W((()=>t(this,void 0,void 0,(function*(){const e=new aa(s);this._handler.onChannelDeleted(e,this.channel.url)}))))}}),a.subscribeMessageEvent(this._key,{onUpdate:(e,t)=>{const s=[],n=[];for(const t of e)t.channelUrl===this._channel.url&&(this.filter.match(t)?s.push(t):n.push(t.messageId));if(Ct(t)){if(s.length>0)switch(t){case Et.EVENT_MESSAGE_SENT_FAILED:case Et.EVENT_MESSAGE_SENT_SUCCESS:case Et.EVENT_MESSAGE_UPDATED:case Et.EVENT_MESSAGE_THREADINFO_UPDATED:case Et.EVENT_MESSAGE_REACTION_UPDATED:case Et.SYNC_MESSAGE_CHANGELOGS:this._updateMessagesToView(s,t);break;case Et.EVENT_MESSAGE_SENT_PENDING:case Et.EVENT_MESSAGE_RECEIVED:case Et.SYNC_MESSAGE_FILL:this._addMessagesToView(s,t)}n.length>0&&this._removeMessagesFromView(n,t)}},onRemove:(e,t)=>{this._removeMessagesFromView(e,t)},onRemoveUnsent:(e,t)=>{this._removeUnsentMessageFromView(e,t)}}),la.of(this._iid,this._channel).resume(),ca.of(this._iid,this._channel).resume(),this._prevFill=new ia(this._key,(e=>t(this,void 0,void 0,(function*(){const t=yield this._getRemoteMessages(e,{prevLimit:this._limit,source:Et.SYNC_MESSAGE_FILL});if(t.length>0){const e=Math.min(...this._messages.map((e=>e.createdAt)));return this._syncRange.extends(e),{hasNext:t.length>=this._limit&&this._syncRange.top>e,nextToken:this._syncRange.top}}return{hasNext:!1,nextToken:0}})))),this._nextFill=new ia(this._key,(e=>t(this,void 0,void 0,(function*(){const t=yield this._getRemoteMessages(e,{nextLimit:this._limit,source:Et.SYNC_MESSAGE_FILL});if(t.length>0){const e=Math.max(...this._messages.map((e=>e.createdAt)));return this._syncRange.extends(e),{hasNext:t.length>=this._limit&&this._syncRange.bottom<e,nextToken:this._syncRange.bottom}}return{hasNext:!1,nextToken:0}}))));const{dispatcher:r}=Ve.of(this._iid);r.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)this._checkHugeGap();else this._prevFill.stop(),this._nextFill.stop()}))}get channel(){return this._channel}get messages(){return[...this._messages]}get hasPrevious(){return this._hasPrevious}get hasNext(){return this._hasNext}setEventHandler(e){this._handler=e}_addMessagesToView(e,s){const n=[],i=[];for(const t of e)if(t.messageId>0){const e=Ea(this._messages,t);if(e<0){const e=ga(this._messages,t);n.push(t),this._messages.splice(e,0,t)}else i.push(t),this._messages[e]=t;this._readReceiptMap.set(t.messageId,this._channel.getUnreadMemberCount(t)),this._deliveryReceiptMap.set(t.messageId,this._channel.getUndeliveredMemberCount(t))}else this._messages.push(t),n.push(t);Ct(s)&&W((()=>t(this,void 0,void 0,(function*(){const e=new ra(s);n.length>0&&this._handler.onMessagesAdded(e,this.channel,n),i.length>0&&this._handler.onMessagesUpdated(e,this.channel,i)}))))}_updateMessagesToView(e,s){const n=[];for(const t of e){const e=Ea(this._messages,t);e>=0&&(n.push(t),this._messages[e]=t)}return Ct(s)&&W((()=>t(this,void 0,void 0,(function*(){const e=new ra(s);n.length>0&&this._handler.onMessagesUpdated(e,this.channel,n)})))),n}_removeMessagesFromView(e,s){const n=[];for(const t of e){const e=this._messages.findIndex((e=>e.messageId===t));e>=0&&(n.push(this._messages[e].messageId),this._messages.splice(e,1))}return Ct(s)&&n.length>0&&W((()=>t(this,void 0,void 0,(function*(){const e=new ra(s);n.length>0&&this._handler.onMessagesDeleted(e,this.channel,n)})))),n}_removeUnsentMessageFromView(e,t){const s=this._messages.findIndex((t=>t instanceof lt&&t.reqId===e));s>=0&&this._messages.splice(s,1)}_getLocalMessages(e,{prevLimit:s=0,nextLimit:n=0}){return t(this,void 0,void 0,(function*(){const t=mi.of(this._iid),i=s>0?yield t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit):[],a=n>0?yield t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit):[];if(i.length>0&&a.length){const e=i.map((e=>e.messageId));for(const t in a)if(e.includes(a[t].messageId)){a.splice(parseInt(t),1);break}}return[...i,...a].sort(((e,t)=>t.createdAt-e.createdAt))}))}_getRemoteMessages(e,{prevLimit:s=0,nextLimit:n=0,source:i=Et.REQUEST_MESSAGE}){return t(this,void 0,void 0,(function*(){const t=Lt.of(this._iid);return s>0||n>0?yield t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,e,Object.assign(Object.assign({},this.filter),{prevResultSize:s,nextResultSize:n}),i):[]}))}_checkHugeGap(){return t(this,void 0,void 0,(function*(){if(this._messages.length>0){const e=Math.min(...this._messages.map((e=>e.createdAt))),s=this._syncRange.top,n=this._syncRange.bottom,i=this._hasNext?Math.max(...this._messages.map((e=>e.createdAt))):Number.MAX_SAFE_INTEGER;if(e<s||n<i){const a=mi.of(this._iid),r=yield a.getCachedMessageCountBetween(this._channel.url,this.filter,e,s),o=yield a.getCachedMessageCountBetween(this._channel.url,this.filter,n,i);yield z((()=>t(this,void 0,void 0,(function*(){const{dispatcher:a,requestQueue:l}=Ve.of(this._iid),h=new da(Object.assign({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:e,prevEnd:s,prevCount:r,nextStart:n,nextEnd:i,nextCount:o},this.filter)),c=yield l.send(h),{isHugeGap:d,prevMessages:u=[],prevHasMore:_,nextMessages:p=[],nextHasmore:m}=c.as(ua);if(d)W((()=>t(this,void 0,void 0,(function*(){this._handler.onHugeGapDetected()}))));else{this._hasPrevious=_,this._hasNext=m;const e=Math.min(...this._messages.map((e=>e.createdAt))),t=Math.max(...this._messages.map((e=>e.createdAt))),s=Math.min(...u.map((e=>e.createdAt))),n=Math.max(...p.map((e=>e.createdAt)));a.dispatch(new Nt({messages:u,source:Et.SYNC_MESSAGE_FILL})),a.dispatch(new Nt({messages:p,source:Et.SYNC_MESSAGE_FILL})),this._syncRange.extends(s,n),e<s&&this._prevFill.start(s),t>n&&this._nextFill.start(n)}}))),3)}}else{const e=Math.floor(this._limit/2),t=yield this._getRemoteMessages(Date.now(),{prevLimit:e,nextLimit:e,source:Et.SYNC_MESSAGE_FILL});t.length>0&&(this._syncRange.extends(...t.map((e=>e.createdAt))),t.length<e&&(this._hasPrevious=!1,this._hasNext=!1))}}))}initialize(e,t=Number.MAX_SAFE_INTEGER){const s=new Ca;this._messages=[],this._syncRange=new _i({}),this._hasNext=!0,this._hasPrevious=!0;const n=Math.floor(this._limit/2);switch(e){case ya.CACHE_AND_REPLACE_BY_API:this._getLocalMessages(t,{prevLimit:n,nextLimit:n}).then((e=>{this._addMessagesToView(e,Et.REQUEST_MESSAGE),s.invokeResponse("local",null,e)})).catch((e=>{if(a(e))throw e;s.invokeResponse("local",e,null)})).finally((()=>{this._getRemoteMessages(t,{prevLimit:n,nextLimit:n}).then((e=>{this._messages=[],e.length<n&&(this._hasPrevious=!1,this._hasNext=!1),e.length>0&&(this._syncRange.extends(...e.map((e=>e.createdAt))),this._addMessagesToView(e,Et.REQUEST_MESSAGE)),s.invokeResponse("remote",null,e)})).catch((e=>{if(a(e))throw e;s.invokeResponse("remote",e,null)}))}));break;case ya.API_ONLY:this._getRemoteMessages(t,{prevLimit:n,nextLimit:n}).then((e=>{e.length<n&&(this._hasPrevious=!1,this._hasNext=!1),e.length>0&&(this._syncRange.extends(...this.messages.map((e=>e.createdAt))),this._addMessagesToView(e,Et.REQUEST_MESSAGE)),s.invokeResponse("remote",null,e)})).catch((e=>{if(a(e))throw e;s.invokeResponse("remote",e,null)}))}return s}loadPrevious(){var e;return t(this,void 0,void 0,(function*(){if(this._hasPrevious){const s=Math.min(...this._messages.map((e=>e.createdAt)));let n=[];yield Y((()=>t(this,void 0,void 0,(function*(){n=yield this._getLocalMessages(s,{prevLimit:this._limit})}))));const i=la.of(this._iid,this._channel);return 0!==n.length&&(null===(e=i.range)||void 0===e?void 0:e.includes(...n.map((e=>e.createdAt))))?(this._hasPrevious=n.length>=this._limit,n.length>0&&(this._syncRange.extends(...n.map((e=>e.createdAt))),this._addMessagesToView(n,Et.REQUEST_MESSAGE))):(yield Y((()=>t(this,void 0,void 0,(function*(){n=yield this._getRemoteMessages(s,{prevLimit:this._limit}),this._hasPrevious=n.length>=this._limit,n.length>0&&(this._syncRange.extends(...n.map((e=>e.createdAt))),i.range.overlap(this._syncRange)&&i.range.extends(this._syncRange.top))})))),this._addMessagesToView(n,Et.REQUEST_MESSAGE)),n}return[]}))}loadNext(){var e;return t(this,void 0,void 0,(function*(){const s=Math.max(...this._messages.map((e=>e.createdAt)));let n=[];yield Y((()=>t(this,void 0,void 0,(function*(){n=yield this._getLocalMessages(s,{nextLimit:this._limit})}))));const i=la.of(this._iid,this._channel);return 0!==n.length&&(null===(e=i.range)||void 0===e?void 0:e.includes(...n.map((e=>e.createdAt))))?(this._hasNext=n.length>=this._limit,n.length>0&&(this._syncRange.extends(...n.map((e=>e.createdAt))),this._addMessagesToView(n,Et.REQUEST_MESSAGE))):(yield Y((()=>t(this,void 0,void 0,(function*(){n=yield this._getRemoteMessages(s,{nextLimit:this._limit}),this._hasNext=n.length>=this._limit,n.length>0&&(this._syncRange.extends(...n.map((e=>e.createdAt))),i.range.overlap(this._syncRange)&&i.range.extends(this._syncRange.bottom))})))),this._addMessagesToView(n,Et.REQUEST_MESSAGE)),n}))}loadAllFailedMessages(){return t(this,void 0,void 0,(function*(){const e=mi.of(this._iid),t=yield e.getAllFailedMessagesFromCache(this._channel.url,this.filter);return this._messages.push(...t),t}))}removeFailedMessage(e){return t(this,void 0,void 0,(function*(){const t=mi.of(this._iid);yield t.removeFailedMessageFromCache(e);const s=this._messages.findIndex((t=>t instanceof lt&&t.reqId===e));s>-1&&this._messages.splice(s,1)}))}dispose(){const e=mi.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)}}class Ta extends class{constructor(){this.coverUrl=null,this.coverImage=null,this.isDistinct=null,this.isPublic=null,this.isDiscoverable=null,this.accessCode=null,this.name=null,this.data=null,this.customType=null,this.operatorUserIds=null,this.messageSurvivalSeconds=null}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return h("string",this.coverUrl,!0)&&(u(this.coverImage)||h("string",this.coverImage)||null===this.coverImage)&&h("boolean",this.isDistinct,!0)&&h("boolean",this.isPublic,!0)&&h("boolean",this.isDiscoverable,!0)&&h("string",this.accessCode,!0)&&h("string",this.name,!0)&&h("string",this.data,!0)&&h("string",this.customType,!0)&&d("string",this.operatorUserIds,null)&&h("number",this.messageSurvivalSeconds,null)}}class Ia extends class{constructor(){this.hidePreviousMessages=!1,this.allowAutoUnhide=!0}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return h("boolean",this.hidePreviousMessages)&&h("boolean",this.allowAutoUnhide)}}class Sa extends T{constructor(e){const{channelUrl:t,token:s,limit:n,order:i,mutedMemberFilter:a,memberStateFilter:r,nicknameStartsWithFilter:o,operatorFilter:l}=e;super(),this.method=N.GET,this.path=`/v3/group_channels/${encodeURIComponent(t)}/members`,this.params={token:s,limit:n,order:i,muted_member_filter:a,member_state_filter:r,nickname_startswith:o,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0}}}class Aa extends I{constructor(e,t){super(e,t),this.token=null,this.members=[];const{next:s,members:n}=t;this.token=s,n&&n.length>0&&(this.members=n.map((t=>new ps(e,t))))}}!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(va||(va={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(fa||(fa={}));class Ua extends cs{constructor(e,t,s){var n,i,a,r;super(e,t,_e.GROUP,s),this.mutedMemberFilter=va.ALL,this.memberStateFilter=ys.ALL,this.nicknameStartsWithFilter=null,this.operatorFilter=Ns.ALL,this.order=fa.MEMBER_NICKNAME_ALPHABETICAL,this.mutedMemberFilter=null!==(n=s.mutedMemberFilter)&&void 0!==n?n:va.ALL,this.memberStateFilter=null!==(i=s.memberStateFilter)&&void 0!==i?i:ys.ALL,this.nicknameStartsWithFilter=null!==(a=s.nicknameStartsWithFilter)&&void 0!==a?a:null,this.order=null!==(r=s.order)&&void 0!==r?r:fa.MEMBER_NICKNAME_ALPHABETICAL}_validate(){return super._validate()&&c(va,this.mutedMemberFilter)&&c(ys,this.memberStateFilter)&&(h("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&c(Ns,this.operatorFilter)&&c(fa,this.order)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new Sa(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{members:n,token:i}=s.as(Aa);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}class Ma extends T{constructor(e){const{channelUrl:t,userId:s,accessCode:n}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/accept`,this.params={user_id:s,access_code:n}}}class ba extends I{constructor(e,t){super(e,t),this.channel=new za(e,t),this.channel.myMemberState=rs.JOINED}}class wa extends T{constructor(e){const{channelUrl:t,isDistinct:s,isPublic:n,isDiscoverable:i,coverUrl:a,coverImage:r,accessCode:o,name:l,data:h,customType:c,operatorUserIds:d,messageSurvivalSeconds:u}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}`,this.params={is_distinct:s,is_public:n,is_discoverable:i,name:l,data:h,custom_type:c,cover_url:a,cover_file:r,access_code:o,operator_ids:d,message_survival_seconds:u}}}class Da extends I{constructor(e,t){super(e,t),this.channel=new za(e,t)}}class Ra extends T{constructor(e){const{channelUrl:t}=e;super(),this.method=N.DELETE,this.path=`/v3/group_channels/${encodeURIComponent(t)}`}}class Oa extends T{constructor(e){const{channelUrl:t}=e;super(),this.method=N.DELETE,this.path=`/v3/group_channels/${encodeURIComponent(t)}/hide`}}class La extends T{constructor({userId:e}){super(),this.method=N.GET,this.path=`/v3/users/${encodeURIComponent(e)}/push_preference`}}class ka extends I{constructor(e,t){super(e,t),this.pushTriggerOption=t.push_trigger_option}}class xa extends T{constructor({userId:e,pushTriggerOption:t}){super(),this.method=N.PUT,this.path=`/v3/users/${encodeURIComponent(e)}/push_preference`,this.params={push_trigger_option:t}}}class Pa extends I{constructor(e,t){super(e,t),this.pushTriggerOption=t.push_trigger_option}}class Fa extends T{constructor({userId:e,channelUrl:t,countPreference:s}){super(),this.method=N.PUT,this.path=`/v3/users/${encodeURIComponent(e)}/count_preference/${encodeURIComponent(t)}`,this.params={count_preference:s}}}class Ha extends I{constructor(e,t){super(e,t),this.countPreference=Qa[t.count_preference]}}class qa extends T{constructor(e){const{channelUrl:t}=e;super(),this.method=N.PUT,this.path=`/v3/group_channels/${encodeURIComponent(t)}/reset_user_history`}}class Ga extends I{constructor(e,t){super(e,t),this.messageOffsetTimestamp=null;const{ts_message_offset:s}=t;this.messageOffsetTimestamp=null!=s?s:null}}class Va extends T{constructor(e){super();const{channelType:t,channelUrl:s}=e;this.method=N.POST,this.path=`${Ce(t)}/${encodeURIComponent(s)}/scheduled_messages`,this.params={message_type:me.USER,user_id:e.userId,message:e.message,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,data:e.data,custom_type:e.customType,translation_target_langs:e.translationTargetLanguages,sorted_metaarray:e.metaArrays.map((e=>tt.payloadify(e))),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId,apple_critical_alert_options:it.payloadify(e.appleCriticalAlertOptions),reply_to_channel:e.isReplyToChannel,scheduled_dt:e.scheduleDatetime}}}class ja extends I{constructor(e,t){super(e,t),this.message=new Pt(e,t)}}var Qa,$a,Ka,Ba;!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(Qa||(Qa={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}($a||($a={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Ka||(Ka={})),function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(Ba||(Ba={}));class za extends Ji{constructor(e,t){var s,n,i,a,r,o,l,d,u,_,p,m,E,g,y,v;super(e,t),this._unreadMemberStateMap=new Map,this._undeliveredMemberStateMap=new Map,this._typingStatus=new Map,this._lastMemberCountUpdated=0,this._typingStarted=0,this._typingEnded=0,this.isDistinct=!1,this.isSuper=!1,this.isBroadcast=!1,this.isPublic=!1,this.isDiscoverable=!0,this.isAccessCodeRequired=!1,this.isPushEnabled=!1,this.unreadMessageCount=0,this.unreadMentionCount=0,this.members=[],this.memberCount=0,this.joinedMemberCount=0,this.hiddenState=Ka.UNHIDDEN,this.lastMessage=null,this.messageOffsetTimestamp=0,this.messageSurvivalSeconds=-1,this.myMemberState=rs.NONE,this.myRole=pe.NONE,this.myMutedState=$a.UNMUTED,this.myLastRead=0,this.myCountPreference=Qa.ALL,this.myPushTriggerOption=Qe.DEFAULT,this.inviter=null,this.invitedAt=0,this.joinedAt=0,this.channelType=_e.GROUP,this.isDistinct=null!==(s=t.is_distinct)&&void 0!==s&&s,this.isSuper=null!==(n=t.is_super)&&void 0!==n&&n,this.isBroadcast=null!==(i=t.is_broadcast)&&void 0!==i&&i,this.isPublic=null!==(a=t.is_public)&&void 0!==a&&a,this.isDiscoverable=null!==(r=t.is_discoverable)&&void 0!==r?r:this.isPublic,this.isAccessCodeRequired=null!==(o=t.is_access_code_required)&&void 0!==o&&o,this.isPushEnabled=null!==(l=t.is_push_enabled)&&void 0!==l&&l,Array.isArray(t.members)&&this.members.push(...t.members.map((e=>new ps(this._iid,e)))),this.memberCount=null!==(d=t.member_count)&&void 0!==d?d:0,this.joinedMemberCount=null!==(u=t.joined_member_count)&&void 0!==u?u:0,this.hiddenState=c(Ka,t.hidden_state)?t.hidden_state:Ka.UNHIDDEN,this.messageOffsetTimestamp=null!==(_=t.ts_message_offset)&&void 0!==_?_:0,this.messageSurvivalSeconds=null!==(p=t.message_survival_seconds)&&void 0!==p?p:-1,this.lastMessage=t.last_message?At(this._iid,Object.assign({channel_type:this.channelType},t.last_message)):null,t.read_receipt&&Object.keys(t.read_receipt).forEach((e=>{h("number",t.read_receipt[e])&&this._updateUnreadMemberState(e,t.read_receipt[e])})),t.delivery_receipt&&Object.keys(t.delivery_receipt).forEach((e=>{h("number",t.delivery_receipt[e])&&this._updateUndeliveredMemberState(e,t.delivery_receipt[e])})),this.myMemberState=c(rs,t.member_state)?t.member_state:rs.NONE,this.myRole=c(pe,t.my_role)?t.my_role:pe.NONE,c($a,t.is_muted)?this.myMutedState=t.is_muted:h("boolean",t.is_muted)?this.myMutedState=t.is_muted?$a.MUTED:$a.UNMUTED:this.myMutedState=$a.UNMUTED,this.myCountPreference=c(Qa,t.count_preference)?t.count_preference:Qa.ALL,this.myPushTriggerOption=c(Qe,t.push_trigger_option)?t.push_trigger_option:Qe.ALL,this.myLastRead=null!==(m=t.user_last_read)&&void 0!==m?m:0,this.inviter=t.inviter?new ke(this._iid,t.inviter):null,this.invitedAt=null!==(E=t.invited_at)&&void 0!==E?E:0,this.joinedAt=null!==(g=t.joined_ts)&&void 0!==g?g:0,this._updateUnreadCount(null!==(y=t.unread_message_count)&&void 0!==y?y:0,null!==(v=t.unread_mention_count)&&void 0!==v?v:0)}get isHidden(){return this.hiddenState!==Ka.UNHIDDEN}get isTyping(){return Object.keys(this._typingStatus).length>0}get cachedUnreadMemberState(){const e={};for(const[t,s]of this._unreadMemberStateMap)e[t]=s;return e}get cachedUndeliveredMemberState(){const e={};for(const[t,s]of this._undeliveredMemberStateMap)e[t]=s;return e}static payloadify(e){return e?C(Object.assign(Object.assign({},super.payloadify(e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((e=>ps.payloadify(e))),last_message:St(e.lastMessage),inviter:e.inviter?ke.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt})):null}_updateUnreadCount(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===Qa.ALL||this.myCountPreference===Qa.UNREAD_MESSAGE_COUNT_ONLY)if(this.isSuper||this.isBroadcast){const{maxSuperGroupChannelUnreadCount:t}=Ve.of(this._iid);this.unreadMessageCount=t&&e>=t?t:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===Qa.ALL||this.myCountPreference===Qa.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0}_updateUnreadMemberState(e,t){const s=this._unreadMemberStateMap.get(e);if(!s||s<t){this._unreadMemberStateMap.set(e,t);const{sdkState:s}=Ve.of(this._iid);return s.userId===e&&(this.myLastRead=t),!0}return!1}_updateUndeliveredMemberState(e,t){const s=this._undeliveredMemberStateMap.get(e);(!s||s<t)&&this._undeliveredMemberStateMap.set(e,t)}_updateTypingStatus(e,t=(new Date).getTime()){t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]}_invalidateTypingStatus(){const e=(new Date).getTime();let t=!1;for(const s in this._typingStatus){const{ts:n}=this._typingStatus[s];e-n>=1e4&&(delete this._typingStatus[s],t=!0)}return t}_setLatestMemberCount(e,t,s){let n=!1;return s>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=s,n=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),n}isReadMessage(e){const{sdkState:t}=Ve.of(this._iid),s=this._unreadMemberStateMap.get(t.userId);return s&&s>=e.createdAt}serialize(){return De(this,(e=>{e.cachedUnreadMemberState=this.cachedUnreadMemberState,e.cachedUndeliveredMemberState=this.cachedUndeliveredMemberState}))}createMessageCollection(e={}){return new Na(this._iid,Object.assign({channel:this},e))}createMemberListQuery(e={}){return new Ua(this._iid,this.url,e)}addMember(e,t=0){if(!this.isSuper&&!this.isBroadcast){const s=this.members.findIndex((t=>t.userId===e.userId));if(s>-1){const t=this.members[s];t.state===rs.JOINED&&(e.state=t.state),this.members.splice(s,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}}removeMember(e){if(!this.isSuper&&!this.isBroadcast){const t=this.members.findIndex((t=>t.userId===e.userId));if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1}getUnreadMemberCount(e){if(e instanceof lt&&!this.isSuper&&!this.isBroadcast){const{sdkState:t}=Ve.of(this._iid),s=e.createdAt;let n=0;for(const i of this.members)if(t.userId!==i.userId&&i.state===rs.JOINED&&e.sender.userId!==i.userId){(this.cachedUnreadMemberState[i.userId]||0)<s&&n++}return n}return 0}getUndeliveredMemberCount(e){if(e instanceof lt&&!this.isSuper&&!this.isBroadcast){const{sdkState:t}=Ve.of(this._iid),s=e.createdAt;let n=0;for(const i of this.members)if(t.userId!==i.userId&&i.state===rs.JOINED&&e.sender.userId!==i.userId){(this.cachedUndeliveredMemberState[i.userId]||0)<s&&n++}return n}return 0}getReadMembers(e,t=!1){const{sdkState:s}=Ve.of(this._iid);if(!s.userId||this.isSuper||this.isBroadcast)return[];const n=[];return this.members.forEach((i=>{if(t||i.userId!==s.userId&&i.userId!==e.sender.userId){this._unreadMemberStateMap.get(i.userId)>=e.createdAt&&n.push(i)}})),n}getUnreadMembers(e,t=!1){const{sdkState:s}=Ve.of(this._iid);if(!s.userId||this.isSuper||this.isBroadcast)return[];const n=[];return this.members.forEach((i=>{if(t||i.userId!==s.userId&&i.userId!==e.sender.userId){this._unreadMemberStateMap.get(i.userId)<e.createdAt&&n.push(i)}})),n}getReadStatus(e=!1){const{sdkState:t}=Ve.of(this._iid);if(!t.userId||this.isSuper||this.isBroadcast)return null;const s={};return this.members.forEach((n=>{if(e||n.userId!==t.userId){const e=this._unreadMemberStateMap.get(n.userId);s[n.userId]=new ms(this._iid,{channel_url:this.url,channel_type:this.channelType,user:ps.payloadify(n),ts:e})}})),s}getTypingUsers(){const e=[];for(const t in this._typingStatus){const{user:s}=this._typingStatus[t];e.push(s)}return e}invalidateTypingStatus(){const{typingIndicatorInvalidateTime:e}=Ve.of(this._iid),t=(new Date).getTime();let s=!1;for(const n in this._typingStatus){const{ts:i}=this._typingStatus[n];t-i>=e&&(delete this._typingStatus[n],s=!0)}return s}refresh(){return t(this,void 0,void 0,(function*(){const{requestQueue:e,dispatcher:t}=Ve.of(this._iid),s=new sn({channelUrl:this.url}),n=yield e.send(s),{channel:i}=n.as(nn);return t.dispatch(new zs({channels:[i],source:Gs.REQUEST_CHANNEL})),i}))}freeze(){const e=Object.create(null,{freeze:{get:()=>super.freeze}});return t(this,void 0,void 0,(function*(){yield e.freeze.call(this);const{dispatcher:t}=Ve.of(this._iid);t.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_HIDDEN}))}))}unfreeze(){const e=Object.create(null,{unfreeze:{get:()=>super.unfreeze}});return t(this,void 0,void 0,(function*(){yield e.unfreeze.call(this);const{dispatcher:t}=Ve.of(this._iid);t.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_UNHIDDEN}))}))}updateChannel(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Ta&&e.validate()).throw(r.invalidParameters);const{dispatcher:t,requestQueue:s}=Ve.of(this._iid),n=new wa(Object.assign({channelUrl:this.url},e)),i=yield s.send(n),{channel:a}=i.as(Da);return t.dispatch(new zs({channels:[a],source:Gs.EVENT_CHANNEL_UPDATED})),a}))}invite(e){return t(this,void 0,void 0,(function*(){return Oe(e.every((e=>e instanceof ke))).throw(r.invalidParameters),this.inviteWithUserIds(e.map((e=>e.userId)))}))}inviteWithUserIds(e){return t(this,void 0,void 0,(function*(){Oe(d("string",e)).throw(r.invalidParameters);const{dispatcher:t,requestQueue:s}=Ve.of(this._iid),n=new yn({channelUrl:this.url,userIds:e}),i=yield s.send(n),{channel:a}=i.as(vn);return t.dispatch(new zs({channels:[a],source:Gs.EVENT_CHANNEL_INVITED})),a}))}join(e=null){return t(this,void 0,void 0,(function*(){Oe(h("string",e)||null===e).throw(r.invalidParameters);const{dispatcher:t,sdkState:s,requestQueue:n}=Ve.of(this._iid),i=new _n({channelUrl:this.url,userId:s.userId,accessCode:e}),a=yield n.send(i),{channel:o}=a.as(pn);return o.myMemberState=rs.JOINED,t.dispatch(new zs({channels:[o],source:Gs.EVENT_CHANNEL_JOINED})),this}))}leave(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new En({channelUrl:this.url,userId:e.userId});yield t.send(s)}))}acceptInvitation(e=null){return t(this,void 0,void 0,(function*(){Oe(h("string",e)||null===e).throw(r.invalidParameters);const{dispatcher:t,sdkState:s,requestQueue:n}=Ve.of(this._iid),i=new Ma({channelUrl:this.url,userId:s.userId,accessCode:e}),a=yield n.send(i),{channel:o}=a.as(ba);return o.myMemberState=rs.JOINED,t.dispatch(new zs({channels:[o],source:Gs.EVENT_CHANNEL_ACCEPTED_INVITE})),o}))}declineInvitation(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new Cn({channelUrl:this.url,userId:e.userId}),n=yield t.send(s),{channel:i}=n.as(Nn);return i.myMemberState=rs.NONE,i}))}sendUserMessage(e){const t=new kt,{dispatcher:s}=Ve.of(this._iid);return super.sendUserMessage(e).onPending((e=>t.trigger(null,e))).onFailed(((e,s)=>t.trigger(e,s))).onSucceeded((e=>{this.lastMessage=e;mi.of(this._iid).handlers.map((e=>e.onChannelChanged(this))),s.dispatch(new zs({channels:[this],source:Gs.EVENT_MESSAGE_SENT})),t.trigger(null,e)})),t}sendFileMessage(e){const t=new kt,{dispatcher:s}=Ve.of(this._iid);return super.sendFileMessage(e).onPending((e=>t.trigger(null,e))).onFailed(((e,s)=>t.trigger(e,s))).onSucceeded((e=>{this.lastMessage=e;mi.of(this._iid).handlers.map((e=>e.onChannelChanged(this))),s.dispatch(new zs({channels:[this],source:Gs.EVENT_MESSAGE_SENT})),t.trigger(null,e)})),t}deleteMessage(e){const s=Object.create(null,{deleteMessage:{get:()=>super.deleteMessage}});return t(this,void 0,void 0,(function*(){if(yield s.deleteMessage.call(this,e),0===e.messageId){const{dispatcher:t}=Ve.of(this._iid);t.dispatch(new It({reqId:e.reqId,source:Et.EVENT_MESSAGE_DELETED}))}}))}hide(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Ia&&e.validate()).throw(r.invalidParameters);const{dispatcher:t,sdkState:s,requestQueue:n}=Ve.of(this._iid),i=new Mn(Object.assign({channelUrl:this.url,userId:s.userId},e)),a=yield n.send(i),{messageOffsetTimestamp:o}=a.as(bn);return this.hiddenState=e.allowAutoUnhide?Ka.HIDDEN_ALLOW_AUTO_UNHIDE:Ka.HIDDEN_PREVENT_AUTO_UNHIDE,e.hidePreviousMessages&&this._updateUnreadCount(0,0),o&&(this.messageOffsetTimestamp=o),t.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_HIDDEN})),this}))}unhide(){return t(this,void 0,void 0,(function*(){const{dispatcher:e,requestQueue:t}=Ve.of(this._iid),s=new Oa({channelUrl:this.url});return yield t.send(s),this.hiddenState=Ka.UNHIDDEN,e.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_UNHIDDEN})),this}))}delete(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Ra({channelUrl:this.url});yield e.send(t)}))}markAsRead(){return t(this,void 0,void 0,(function*(){const{sdkState:e,dispatcher:t,requestQueue:s}=Ve.of(this._iid),n=new In({channelUrl:this.url}),i=yield s.send(n),{readStatus:a}=i.as(Sn);this._unreadMemberStateMap.set(e.userId,a.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),t.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_READ})))}))}markAsDelivered(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new An({channelUrl:this.url,userId:e.userId});yield t.send(s)}))}startTyping(){return t(this,void 0,void 0,(function*(){const{requestQueue:e,typingIndicatorThrottle:t}=Ve.of(this._iid),s=(new Date).getTime();if(s-this._typingStarted>=t){this._typingStarted=s,this._typingEnded=0;const t=new Dn({channelUrl:this.url,time:this._typingStarted});e.send(t)}}))}endTyping(){return t(this,void 0,void 0,(function*(){const{requestQueue:e,typingIndicatorThrottle:t}=Ve.of(this._iid),s=(new Date).getTime();if(s-this._typingEnded>=t){this._typingStarted=0,this._typingEnded=s;const t=new On({channelUrl:this.url,time:this._typingStarted});e.send(t)}}))}registerScheduledUserMessage(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof es&&e.validate()).throw(r.invalidParameters);const{sdkState:t,requestQueue:s}=Ve.of(this._iid),n=new Va(Object.assign({channelType:this.channelType,channelUrl:this.url,userId:t.userId,requestId:this._generateRequestId(),scheduleDatetime:e.scheduledDateTimeString},e)),i=yield s.send(n),{message:a}=i.as(ja);return a}))}getMyPushTriggerOption(){return t(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new La({userId:e.userId}),n=yield t.send(s),{pushTriggerOption:i}=n.as(ka);return i}))}setMyPushTriggerOption(e){return t(this,void 0,void 0,(function*(){Oe(c(Qe,e)).throw(r.invalidParameters);const{sdkState:t,requestQueue:s}=Ve.of(this._iid),n=new xa({userId:t.userId,pushTriggerOption:e}),i=yield s.send(n),{pushTriggerOption:a}=i.as(Pa);return a}))}setMyCountPreference(e){return t(this,void 0,void 0,(function*(){Oe(c(Qa,e)).throw(r.invalidParameters);const{dispatcher:t,sdkState:s,requestQueue:n}=Ve.of(this._iid),i=new Fa({channelUrl:this.url,userId:s.userId,countPreference:e}),a=yield n.send(i),{countPreference:o}=a.as(Ha);return this.myCountPreference=o,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),t.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_CREATED})),o}))}resetMyHistory(){return t(this,void 0,void 0,(function*(){const{dispatcher:e,requestQueue:t}=Ve.of(this._iid),s=new qa({channelUrl:this.url}),n=yield t.send(s),{messageOffsetTimestamp:i}=n.as(Ga);return this.messageOffsetTimestamp=i,e.dispatch(new zs({channels:[this],source:Gs.EVENT_CHANNEL_RESET_HISTORY})),this}))}}class Wa extends class{}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return d(Ba,this.keys)}}class Ya extends class{constructor(){this.channelCustomTypesFilter=[],this.superChannelFilter=vs.ALL}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return d("string",this.channelCustomTypesFilter)&&c(vs,this.superChannelFilter)}}class Ja{constructor(){this.onSessionExpired=R,this.onSessionTokenRequired=e=>e(null),this.onSessionError=R,this.onSessionRefreshed=R,this.onSessionClosed=R}}class Xa{constructor(){this.onConnected=R,this.onReconnectStarted=R,this.onReconnectSucceeded=R,this.onReconnectFailed=R,this.onDisconnected=R}}class Za{constructor(){this.onFriendsDiscovered=R,this.onTotalUnreadMessageCountUpdated=R}}const er="Poll",tr="pollId";class sr{constructor(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url}}class nr{constructor(e){var t,s,n;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(s=e.name)&&void 0!==s?s:"",this.url=null!==(n=e.url)&&void 0!==n?n:"",this.emojis=e.emojis?e.emojis.map((e=>new sr(e))):[]}}class ir{constructor(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((e=>new nr(e))):[]}}class ar extends T{constructor({limit:e,token:t,userIdsFilter:s,metaDataKeyFilter:n,metaDataValuesFilter:i,nicknameStartsWithFilter:a}){super(),this.method=N.GET,this.path="/v3/users",this.params=C({limit:e,token:t,user_ids:s,metadatakey:n,metadatavalues_in:i,nickname_startswith:a})}}class rr extends I{constructor(e,t){super(e,t),this.users=t.users.map((t=>new ke(e,t))),this.next=t.next}}class or extends ts{constructor(e,t){var s,n,i;super(e,t),this.userIdsFilter=null,this.metaDataKeyFilter=null,this.metaDataValuesFilter=null,this.nicknameStartsWithFilter=null,this.userIdsFilter=null!==(s=t.userIdsFilter)&&void 0!==s?s:null,this.metaDataKeyFilter=null!==(n=t.metaDataKeyFilter)&&void 0!==n?n:null,this.metaDataValuesFilter=null!==(i=t.metaDataValuesFilter)&&void 0!==i?i:null,this.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null}_validate(){return super._validate()&&d("string",this.userIdsFilter,!0)&&h("string",this.metaDataKeyFilter,!0)&&d("string",this.metaDataValuesFilter,!0)&&h("string",this.metaDataKeyFilter,!0)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new ar(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{users:n,next:i}=s.as(rr);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}class lr extends T{constructor({userId:e,limit:t,token:s,userIdsFilter:n}){super(),this.method=N.GET,this.path=`/v3/users/${e}/block`,this.params=C({limit:t,token:s,user_ids:n})}}class hr extends I{constructor(e,t){super(e,t),this.users=t.users.map((t=>new ke(e,t))),this.next=t.next}}class cr extends ts{constructor(e,t){var s;super(e,t),this.userIdsFilter=null,this.userIdsFilter=null!==(s=t.userIdsFilter)&&void 0!==s?s:null}_validate(){return super._validate()&&d("string",this.userIdsFilter,!0)}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new lr(Object.assign(Object.assign({},this),{userId:e.userId,token:this._token})),n=yield t.send(s),{users:i,next:a}=n.as(hr);return this._token=a,this._hasNext=!!a,this._isLoading=!1,i}return[]}throw r.invalidParameters}))}}class dr extends T{constructor({userId:e,limit:t,token:s}){super(),this.method=N.GET,this.path=`/v3/users/${encodeURIComponent(e)}/friends`,this.params={limit:t,token:s}}}class ur extends I{constructor(e,t){super(e,t),this.hasMore=t.has_more,this.users=t.users.map((t=>new ke(e,t))),this.next=t.next}}class _r extends ts{constructor(e,t){super(e,t)}_validate(){return super._validate()}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{sdkState:e,requestQueue:t}=Ve.of(this._iid),s=new dr(Object.assign(Object.assign({},this),{userId:e.userId,token:this._token})),n=yield t.send(s),{users:i,hasMore:a,next:r}=n.as(ur);return this._token=r,this._hasNext=a,this._isLoading=!1,i}return[]}throw r.invalidParameters}))}}const pr={};class mr{constructor({_iid:e}){this._sync=null,this._metadata=null,this._iid=e;const{sdkState:s}=Ve.of(this._iid);this._metadataKey=`sendbird:${s.userId}@groupchannel/sync.meta`;const n=(e=>`sendbird:${e}@groupchannel/sync`)(s.userId);this._sync=new ia(n,(()=>t(this,void 0,void 0,(function*(){const e={hasNext:!0,nextToken:""};if(yield this.loadMetadata(),this._metadata.completed)e.hasNext=!1,e.nextToken="";else{const t=mi.of(this._iid),{channels:s,token:n}=yield t.getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:os.CHRONOLOGICAL},100,Gs.SYNC_CHANNEL_BACKGROUND);e.hasNext=s.length>=100&&!!n,e.nextToken=n,this._metadata.token=n,this._metadata.range.extends(...s.map((e=>e.createdAt))),this._metadata.completed=!e.hasNext,yield this.saveMetadata()}return e}))))}static of(e){if(!pr[e]){const t=pr[e]=new mr({_iid:e}),{dispatcher:s}=Ve.of(e);s.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)t.resume();else t.pause()}))}return pr[e]}get range(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}get completed(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)}loadMetadata(){return t(this,void 0,void 0,(function*(){if(!this._metadata){const{cacheContext:e}=Ve.of(this._iid),t=yield e.store.get(this._metadataKey);this._metadata={token:t?t.token:"",range:new _i(t?t.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!t&&t.completed}}}))}saveMetadata(){return t(this,void 0,void 0,(function*(){if(this._metadata){const{cacheContext:e}=Ve.of(this._iid);yield e.store.set({key:this._metadataKey,value:this._metadata,generation:1})}}))}resume(){var e,t;this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:"")}pause(){this._sync.stop()}}const Er={};class gr{constructor({_iid:e}){this._sync=null,this._metadataKey=null,this._metadata=null,this._iid=e;const{sdkState:s}=Ve.of(this._iid);this._metadataKey=`sendbird:${s.userId}@groupchannel/changelogs.meta`;const n=(e=>`sendbird:${e}@groupchannel/changelogs`)(s.userId);this._sync=new ia(n,(()=>t(this,void 0,void 0,(function*(){const e={hasNext:!0,nextToken:0};yield this.loadMetadata();const t=mi.of(this._iid),{hasMore:s,token:n}=yield t.getMyGroupChannelChangeLogs(this._metadata.token,{},Gs.SYNC_CHANNEL_CHANGELOGS);return e.hasNext=s,e.nextToken=n,this._metadata.token=n,yield this.saveMetadata(),e}))))}static of(e){if(!Er[e]){const t=Er[e]=new gr({_iid:e}),{dispatcher:s}=Ve.of(e);s.on((e=>{if(e instanceof H)if(e.stateType===L.CONNECTED)t.resume();else t.pause()}))}return Er[e]}loadMetadata(){return t(this,void 0,void 0,(function*(){if(!this._metadata){const{cacheContext:e}=Ve.of(this._iid),t=yield e.store.get(this._metadataKey);this._metadata={token:t?t.token:""}}}))}saveMetadata(){return t(this,void 0,void 0,(function*(){if(this._metadata){const{cacheContext:e}=Ve.of(this._iid);yield e.store.set({key:this._metadataKey,value:this._metadata,generation:1})}}))}resume(){this._sync.start(0)}pause(){this._sync.stop()}}class yr{constructor(){this.onUserMuted=R,this.onUserUnmuted=R,this.onUserBanned=R,this.onUserUnbanned=R,this.onChannelChanged=R,this.onChannelDeleted=R,this.onChannelFrozen=R,this.onChannelUnfrozen=R,this.onOperatorUpdated=R,this.onChannelMemberCountChanged=R,this.onMetaDataCreated=R,this.onMetaDataUpdated=R,this.onMetaDataDeleted=R,this.onMetaCounterCreated=R,this.onMetaCounterUpdated=R,this.onMetaCounterDeleted=R,this.onMessageReceived=R,this.onMessageUpdated=R,this.onMessageDeleted=R,this.onMentionReceived=R,this.onReactionUpdated=R,this.onThreadInfoUpdated=R}}class vr extends T{constructor(e){const{token:t,limit:s,order:n,includeEmpty:i,membershipFilter:a,channelNameContainsFilter:r,channelUrlsFilter:o,customTypesFilter:l,customTypeStartsWithFilter:h,superChannelFilter:c,metadataOrderKeyFilter:d,metadataKey:u,metadataValues:_,metadataValueStartsWith:p,includeFrozen:m,includeMetaData:E}=e;super(),this.method=N.GET,this.path="/v3/group_channels",this.params=C({token:t,limit:s,order:n,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:i,public_mode:gs.PUBLIC,public_membership_mode:a,name_contains:r,channel_urls:o,custom_types:l,custom_type_startswith:h,super_mode:c,metadata_order_key:d,metadata_key:u,metadata_values:_,metadata_value_startswith:p,show_frozen:m,show_metadata:E})}}class fr extends I{constructor(e,t){super(e,t),this.token=null,this.channels=[],this.ts=null;const{next:s,channels:n,ts:i}=t;this.token=s,n&&n.length>0&&(this.channels=n.map((t=>(t.ts=i,new za(e,t))))),this.ts="number"==typeof i?i:null}}class Cr extends le{constructor(){super(...arguments),this._channels=new Map,this._enteredChannelUrls=[]}get enteredChannels(){return this._enteredChannelUrls.map((e=>this._channels.get(e))).filter((e=>null!==e))}isEnteredChannel(e){return this._enteredChannelUrls.includes(e)}enter(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)}exit(e){const t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)}exitAll(){this._enteredChannelUrls=[]}get(e){var s;return t(this,void 0,void 0,(function*(){return null!==(s=this._channels.get(e))&&void 0!==s?s:null}))}upsert(e){return t(this,void 0,void 0,(function*(){e.forEach((e=>{if(this._channels.has(e.url)){const t=this._channels.get(e.url);Object.assign(t,e)}else this._channels.set(e.url,e)}))}))}remove(e){return t(this,void 0,void 0,(function*(){this._channels.delete(e),this.exit(e)}))}clear(){return t(this,void 0,void 0,(function*(){this._channels.clear(),this._enteredChannelUrls=[]}))}}class Nr extends class{constructor(){this.channelUrl=null,this.name=null,this.coverUrlOrImage=null,this.data=null,this.customType=null,this.operatorUserIds=null}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return d("string",this.operatorUserIds,!0)&&(h("string",this.coverUrlOrImage)||u(this.coverUrlOrImage)||null===this.coverUrlOrImage)&&h("string",this.name,!0)&&h("string",this.data,!0)&&h("string",this.customType,!0)&&(h("string",this.channelUrl)&&/^\w+$/.test(this.channelUrl)||null===this.channelUrl)}}class Tr extends T{constructor({channelUrl:e,isInternalCall:t}){super(),this.method=N.GET,this.path=`${t?"/v3/sdk/open_channels":"/v3/open_channels"}/${encodeURIComponent(e)}`}}class Ir extends I{constructor(e,t){super(e,t),this.channel=null,this.channel=new Hr(e,t)}}class Sr extends T{constructor(e){const{channelUrl:t,coverUrlOrImage:s,name:n,data:i,customType:a,operatorUserIds:r}=e;super(),this.method=N.POST,this.path="/v3/open_channels",this.params={channel_url:t,cover_url:h("string",s)?s:null,cover_file:u(s)?s:null,name:n,data:i,custom_type:a,operators:r}}}class Ar extends b{constructor({channelUrl:e}){super({code:"ENTR",payload:{channel_url:e},ackRequired:!0})}}class Ur extends M{constructor(e,t,s){var n,i;super(e,"ENTR",s),s.data&&(this.participantCount=null!==(n=s.data.participant_count)&&void 0!==n?n:0,this.user=new ke(e,s.data),this.ts=null!==(i=s.data.edge_ts)&&void 0!==i?i:0)}}class Mr extends b{constructor({channelUrl:e}){super({code:"EXIT",payload:{channel_url:e},ackRequired:!0})}}class br extends M{constructor(e,t,s){var n,i;super(e,"EXIT",s),s.data&&(this.participantCount=null!==(n=s.data.participant_count)&&void 0!==n?n:0,this.user=new ke(e,s.data),this.ts=null!==(i=s.data.edge_ts)&&void 0!==i?i:0)}}const wr={};class Dr{constructor(e,{sdkState:t,dispatcher:s,requestQueue:n}){this._sdkState=t,this._requestQueue=n,this._dispatcher=s,this._openChannelCache=new Cr(e),this._openChannelHandlers=new Map,this._dispatcher.on((e=>{if(e instanceof M)this._handleEvent(e);else if(e instanceof H&&e.stateType===L.CONNECTED){const{enteredChannels:e}=this._openChannelCache;for(const t of e)t.enter()}})),wr[e]=this}static of(e){return wr[e]}buildOpenChannelFromSerializedData(e){const t=Re(e);return new Hr(t._iid,Hr.payloadify(t))}getChannelFromCache(e){return t(this,void 0,void 0,(function*(){return yield this._openChannelCache.get(e)}))}upsertChannelsToCache(e){return t(this,void 0,void 0,(function*(){yield this._openChannelCache.upsert(e)}))}removeChannelsFromCache(e){return t(this,void 0,void 0,(function*(){for(const t of e)yield this._openChannelCache.remove(t)}))}setEnteredToCache(e){this._openChannelCache.enter(e.url)}setExitedToCache(e){this._openChannelCache.exit(e.url)}_handleEvent(e){return t(this,void 0,void 0,(function*(){try{switch(e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":{let s=null;if("MESG"===e.code?s=e.as(ti):"FILE"===e.code?s=e.as(_t):"ADMM"!==e.code&&"BRDM"!=e.code||(s=e.as(si)),s){const{message:e,isMentioned:n}=s;if(e.channelType===_e.OPEN){const s=yield this.getChannel(e.channelUrl,!0);W((()=>t(this,void 0,void 0,(function*(){for(const t of this._openChannelHandlers.values())this._openChannelCache.isEnteredChannel(s.url)&&t.onMessageReceived(s,e),n&&t.onMentionReceived(s,e)}))))}}break}case"MEDI":case"FEDI":case"AEDI":{let s=null;if("MEDI"===e.code?s=e.as(ii):"FEDI"===e.code?s=e.as(ri):"AEDI"===e.code&&(s=e.as(oi)),s){const{message:e}=s;if(e.channelType===_e.OPEN){const s=yield this.getChannel(e.channelUrl,!0);W((()=>t(this,void 0,void 0,(function*(){for(const t of this._openChannelHandlers.values())this._openChannelCache.isEnteredChannel(s.url)&&t.onMessageUpdated(s,e)}))))}}break}case"DELM":{const{channelUrl:s,channelType:n,messageId:i}=e.as(hi);if(n===_e.OPEN){const e=yield this.getChannel(s,!0);W((()=>t(this,void 0,void 0,(function*(){for(const t of this._openChannelHandlers.values())this._openChannelCache.isEnteredChannel(e.url)&&t.onMessageDeleted(e,i)}))))}break}case"MRCT":{const{channelUrl:s,channelType:n,event:i}=e.as(ci);if(n===_e.OPEN){const e=yield this.getChannel(s,!0);W((()=>t(this,void 0,void 0,(function*(){for(const t of this._openChannelHandlers.values())t.onReactionUpdated(e,i)}))))}break}case"MTHD":{const{event:s}=e.as(di);if(s.channelType===_e.OPEN){const e=yield this.getChannel(s.channelUrl,!0);W((()=>t(this,void 0,void 0,(function*(){for(const t of this._openChannelHandlers.values())t.onThreadInfoUpdated(e,s)}))))}break}case"MCNT":{const{openChannelMemberCounts:s}=e.as(xn),n=[];for(const e of s){const{channelUrl:t,participantCount:s,updatedAt:i}=e,a=yield this.getChannelFromCache(t);a&&a._updateParticipantCount(s,i)&&n.push(a)}n.length>0&&(yield this.upsertChannelsToCache(n),W((()=>t(this,void 0,void 0,(function*(){for(const e of this._openChannelHandlers.values())e.onChannelMemberCountChanged(n)})))));break}case"SYEV":{const{event:s}=e.as(un);if(s.isOpenChannelEvent)switch(s.category){case qs.CHANNEL_ENTER:{const n=yield this.getChannel(s.channelUrl,!0),{participantCount:i,user:a}=e.as(Ur),r=n._updateParticipantCount(i,s.ts);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{e.onUserEntered(n,a),r&&e.onChannelParticipantCountChanged(n)}))}))));break}case qs.CHANNEL_EXIT:{const n=yield this.getChannel(s.channelUrl,!0),{participantCount:i,user:a}=e.as(br),r=n._updateParticipantCount(i,s.ts);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{e.onUserExited(n,a),r&&e.onChannelParticipantCountChanged(n)}))}))));break}case qs.CHANNEL_OPERATOR_UPDATE:{const n=yield this.getChannel(s.channelUrl,!0),{operators:i}=e.as(kn);n.operators=i,this.upsertChannelsToCache([n]),W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{e.onOperatorUpdated(n,i)}))}))));break}case qs.USER_CHANNEL_MUTE:case qs.USER_CHANNEL_UNMUTE:{const n=yield this.getChannel(s.channelUrl,!0),i=s.category===qs.USER_CHANNEL_MUTE,{user:a}=e.as(i?Fn:qn);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{i?e.onUserMuted(n,a):e.onUserUnmuted(n,a)}))}))));break}case qs.USER_CHANNEL_BAN:case qs.USER_CHANNEL_UNBAN:{const n=yield this.getChannel(s.channelUrl,!0),i=s.category===qs.USER_CHANNEL_BAN,{user:a}=e.as(i?Vn:Qn);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{i?e.onUserBanned(n,a):e.onUserUnbanned(n,a)}))}))));break}case qs.CHANNEL_FREEZE:case qs.CHANNEL_UNFREEZE:{const n=yield this.getChannel(s.channelUrl,!0),{freeze:i}=e.as(Kn);n.isFrozen=i,this.upsertChannelsToCache([n]),W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{i?e.onChannelFrozen(n):e.onChannelUnfrozen(n)}))}))));break}case qs.CHANNEL_DELETED:{const e=yield this.getChannel(s.channelUrl,!0);yield this.removeChannelsFromCache([e.url]),W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((t=>{t.onChannelDeleted(e.url,e.channelType)}))}))));break}case qs.CHANNEL_PROP_CHANGED:{const e=yield this.getChannelWithoutCache(s.channelUrl,!0);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((t=>{t.onChannelChanged(e)}))}))));break}case qs.CHANNEL_META_DATA_CHANGED:{const n=yield this.getChannel(s.channelUrl,!0),{created:i,updated:a,deleted:r}=e.as(Wn);i&&n._upsertCachedMetaData(i,s.ts),a&&n._upsertCachedMetaData(a,s.ts),r&&n._removeFromCachedMetaData(r,s.ts),W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{i&&e.onMetaDataCreated(n,i),a&&e.onMetaDataUpdated(n,a),r&&e.onMetaDataDeleted(n,r)}))}))));break}case qs.CHANNEL_META_COUNTERS_CHANGED:{const n=yield this.getChannel(s.channelUrl,!0),{created:i,updated:a,deleted:r}=e.as(Xn);W((()=>t(this,void 0,void 0,(function*(){this._openChannelHandlers.forEach((e=>{i&&e.onMetaCounterCreated(n,i),a&&e.onMetaCounterUpdated(n,a),r&&e.onMetaCounterDeleted(n,r)}))}))));break}}break}}}catch(e){if(a(e))throw e}}))}addHandler(e,t){this._openChannelHandlers.set(e,t)}removeHandler(e){this._openChannelHandlers.delete(e)}clearHandler(){this._openChannelHandlers.clear()}getChannel(e,s=!1){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);try{const t=yield this.getChannelFromCache(e);if(t)return t}catch(e){}return yield this.getChannelWithoutCache(e)}))}getChannelWithoutCache(e,s=!1){return t(this,void 0,void 0,(function*(){Oe(h("string",e)).throw(r.invalidParameters);const t=new Tr({channelUrl:e,isInternalCall:s}),n=yield this._requestQueue.send(t),{channel:i}=n.as(Ir);return yield this.upsertChannelsToCache([i]),i}))}createChannel(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Nr&&e.validate()).throw(r.invalidParameters);const t=new Sr(e),s=yield this._requestQueue.send(t),{channel:n}=s.as(Ir);return this.upsertChannelsToCache([n]),n}))}}class Rr extends class{constructor(){this.name=null,this.coverUrlOrImage=null,this.data=null,this.customType=null,this.operatorUserIds=null}}{constructor(e){if(super(),e)for(const t in e)this.hasOwnProperty(t)&&(this[t]=e[t])}validate(){return d("string",this.operatorUserIds,null)&&(h("string",this.coverUrlOrImage)||u(this.coverUrlOrImage)||null===this.coverUrlOrImage)&&h("string",this.name,!0)&&h("string",this.data,!0)&&h("string",this.customType,!0)}}class Or extends T{constructor(e){const{channelUrl:t,token:s,limit:n}=e;super(),this.method=N.GET,this.path=`/v3/open_channels/${encodeURIComponent(t)}/participants`,this.params={token:s,limit:n}}}class Lr extends I{constructor(e,t){super(e,t),this.token=null,this.participants=[];const{next:s,participants:n}=t;this.token=s,this.participants=n.map((t=>new ke(e,t)))}}class kr extends cs{constructor(e,t,s){super(e,t,_e.OPEN,s)}_validate(){return super._validate()}next(){return t(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw r.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=Ve.of(this._iid),t=new Or(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{participants:n,token:i}=s.as(Lr);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw r.invalidParameters}))}}class xr extends T{constructor(e){const{channelUrl:t,coverUrlOrImage:s,name:n,data:i,customType:a,operatorUserIds:r}=e;super(),this.method=N.PUT,this.path=`/v3/open_channels/${encodeURIComponent(t)}`,this.params={cover_url:h("string",s)?s:null,cover_file:u(s)?s:null,name:n,data:i,custom_type:a,operators:r}}}class Pr extends I{constructor(e,t){super(e,t),this.channel=new Hr(e,t)}}class Fr extends T{constructor(e){const{channelUrl:t}=e;super(),this.method=N.DELETE,this.path=`/v3/open_channels/${encodeURIComponent(t)}`}}class Hr extends Ji{constructor(e,t){var s;super(e,t),this._lastParticipantCountUpdated=0,this.participantCount=0,this.operators=[],this.channelType=_e.OPEN,this.participantCount=null!==(s=t.participant_count)&&void 0!==s?s:0,this.operators=Array.isArray(t.operators)?t.operators.map((t=>new ke(e,t))):[]}static payloadify(e){return e?C(Object.assign(Object.assign({},Ji.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((e=>ke.payloadify(e)))})):null}serialize(){return De(this)}isOperator(e){return e instanceof ke?this.isOperator(e.userId):this.operators.some((t=>t.userId===e))}_updateParticipantCount(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)}createParticipantListQuery(e){return new kr(this._iid,this.url,e)}refresh(){return t(this,void 0,void 0,(function*(){const e=Dr.of(this._iid);return yield e.getChannelWithoutCache(this.url)}))}enter(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Ar({channelUrl:this.url}),s=yield e.send(t),{participantCount:n,ts:i}=s.as(Ur);this._updateParticipantCount(n,i);Dr.of(this._iid).setEnteredToCache(this)}))}exit(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Mr({channelUrl:this.url}),s=yield e.send(t),{participantCount:n,ts:i}=s.as(br);this._updateParticipantCount(n,i);Dr.of(this._iid).setExitedToCache(this);Lt.of(this._iid).fileMessageQueue.cancel(this)}))}updateChannel(e){return t(this,void 0,void 0,(function*(){Oe(e instanceof Rr&&e.validate()).throw(r.invalidParameters);const{requestQueue:t}=Ve.of(this._iid),s=new xr(Object.assign({channelUrl:this.url},e)),n=yield t.send(s),{channel:i}=n.as(Pr),a=Dr.of(this._iid);return yield a.upsertChannelsToCache([i]),i}))}updateChannelWithOperatorUserIds(e,s,n,i,a){return t(this,void 0,void 0,(function*(){const t=new Rr;return t.name=e,t.coverUrlOrImage=s,t.data=n,t.operatorUserIds=i,t.customType=a,this.updateChannel(t)}))}delete(){return t(this,void 0,void 0,(function*(){const{requestQueue:e}=Ve.of(this._iid),t=new Fr({channelUrl:this.url});yield e.send(t);const s=Dr.of(this._iid);yield s.removeChannelsFromCache([this.url])}))}}class qr extends T{constructor(e){const{token:t,limit:s,nameKeyword:n,urlKeyword:i,customTypes:a,includeFrozen:r,includeMetaData:o}=e;super(),this.method=N.GET,this.path="/v3/open_channels",this.params=C({token:t,limit:s,name_contains:n,url_contains:i,custom_types:a,show_frozen:r,show_metadata:o})}}class Gr extends I{constructor(e,t){super(e,t),this.token=null,this.channels=[],this.ts=null;const{next:s,channels:n,ts:i}=t;this.token=s,n&&n.length>0&&(this.channels=n.map((t=>new Hr(e,t)))),this.ts="number"==typeof i?i:null}}export{nr as $,Ls as A,yr as B,_e as C,As as D,xs as E,Ps as F,Ss as G,er as H,tr as I,T as J,N as K,vr as L,Os as M,Us as N,Dr as O,ls as P,he as Q,C as R,vs as S,I as T,ke as U,Ve as V,$e as W,Ba as X,de as Y,ir as Z,t as _,os as a,Nr as a$,ce as a0,sr as a1,ze as a2,ui as a3,Oe as a4,$s as a5,Ks as a6,Qs as a7,Qa as a8,za as a9,Yt as aA,Xt as aB,ge as aC,qt as aD,Ht as aE,tt as aF,kt as aG,is as aH,hs as aI,st as aJ,nt as aK,ds as aL,et as aM,Ze as aN,Be as aO,fe as aP,xt as aQ,Pt as aR,es as aS,ot as aT,Xe as aU,Ft as aV,Je as aW,ht as aX,vt as aY,Qt as aZ,zt as a_,Ia as aa,Is as ab,Ta as ac,Cs as ad,Ka as ae,ps as af,fa as ag,Ua as ah,rs as ai,ys as aj,Na as ak,Ca as al,ya as am,ra as an,Et as ao,Rs as ap,$a as aq,Ns as ar,gs as as,Ts as at,ms as au,fs as av,Lt as aw,ft as ax,it as ay,ct as az,mr as b,Hr as b0,Rr as b1,kr as b2,M as b3,Zs as b4,Hs as b5,Vs as b6,x as b7,n as b8,oe as b9,us as bA,as as bB,pe as bC,Le as bD,O as ba,Ys as bb,Ja as bc,Za as bd,Xa as be,or as bf,cr as bg,_r as bh,Re as bi,je as bj,La as bk,ka as bl,Qe as bm,xa as bn,Pa as bo,Ke as bp,Wa as bq,Ya as br,_ as bs,Ii as bt,He as bu,Ci as bv,yi as bw,yt as bx,Si as by,_s as bz,gr as c,mi as d,Gs as e,aa as f,Y as g,ts as h,h as i,d as j,c as k,fr as l,zs as m,R as n,r as o,pa as p,qr as q,W as r,Bs as s,Gr as t,E as u,u as v,Ms as w,Es as x,bs as y,ws as z};
