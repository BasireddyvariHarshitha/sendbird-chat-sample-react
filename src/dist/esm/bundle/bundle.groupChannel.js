import{u as t,G as e,a as s,D as i,b as n,c as a,V as l,d as h,p as r,e as o,s as d,r as u,_ as c,f as m,g as p,B as _,n as v,h as f,S as C,P as F,i as y,j as g,k as E,L,l as b,m as T,o as S}from"./bundle.shared.js";class U{constructor(r,{filter:o,order:d,limit:u}){this.channels=[],this._iid=r,this._key=`gcc-${t()}`,this.filter=null!=o?o:new e,this.order=null!=d?d:s.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=u?u:i,n.of(r).resume(),a.of(r).resume();const{sdkState:c}=l.of(this._iid);h.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:(t,e)=>{const s=t.filter((t=>this.filter.match(t,c.userId))),i=t.filter((t=>!this.filter.match(t,c.userId))).map((t=>t.url));s.length>0&&this._addChannelsToView(s,e),i.length>0&&this._removeChannelsFromView(i,e)},onRemove:(t,e)=>{this._removeChannelsFromView(t,e)}})}get hasMore(){return this._hasMore}setEventHandler(t){this._handler=t}_addChannelsToView(t,e,s=!1){const i=[],a=[];for(const l of t){const{place:t,contains:h}=r(this.channels,l,this.order);if(h)switch(a.push(l),e){case o.EVENT_CHANNEL_UPDATED:case o.EVENT_MESSAGE_RECEIVED:this.channels.splice(t,1);{const{place:t}=r(this.channels,l,this.order);this.channels.splice(t,0,l)}break;default:this.channels[t]=l}else if(t===this.channels.length){const t=n.of(this._iid);(s||t.completed)&&(i.push(l),this.channels.push(l))}else i.push(l),this.channels.splice(t,0,l)}d(e)&&u((()=>c(this,void 0,void 0,(function*(){const t=new m(e);i.length>0&&this._handler.onChannelsAdded(t,i),a.length>0&&this._handler.onChannelsUpdated(t,a)}))))}_removeChannelsFromView(t,e){const s=[];for(const e of t){const t=this.channels.findIndex((t=>t.url===e));t>=0&&(s.push(this.channels[t].url),this.channels.splice(t,1))}return d(e)&&s.length>0&&u((()=>c(this,void 0,void 0,(function*(){const t=new m(e);this._handler.onChannelsDeleted(t,s)})))),s}_getLocalChannels(){return c(this,void 0,void 0,(function*(){const t=h.of(this._iid);return yield t.getChannelsFromCache(this._token,this.filter,this.order)}))}_getRemoteChannels(){return c(this,void 0,void 0,(function*(){const t=h.of(this._iid),{channels:e,token:s}=yield t.getMyGroupChannels(this._token,Object.assign(Object.assign({},this.filter),{order:this.order}),this._limit);return this._token=s,e}))}loadMore(){return c(this,void 0,void 0,(function*(){if(this._hasMore){let t=[];return yield p((()=>c(this,void 0,void 0,(function*(){t=yield this._getLocalChannels()})))),yield p((()=>c(this,void 0,void 0,(function*(){t=yield this._getRemoteChannels()})))),this._addChannelsToView(t,o.REQUEST_CHANNEL,!0),t}return[]}))}dispose(){h.of(this._iid).unsubscribeGroupChannelEvent(this._key)}}class V extends _{constructor(){super(...arguments),this.onUserJoined=v,this.onUserLeft=v,this.onUserReceivedInvitation=v,this.onUserDeclinedInvitation=v,this.onChannelHidden=v,this.onUnreadMemberCountUpdated=v,this.onUndeliveredMemberCountUpdated=v,this.onTypingStatusUpdated=v}}class k extends V{constructor(t={}){super(),Object.keys(t).forEach((e=>{this.hasOwnProperty(e)&&(this[e]=t[e])}))}}var N;!function(t){t.ALL="all",t.JOINED="joined"}(N||(N={}));class O extends f{constructor(t,e){var s,i,n,a,l,h,r,o,d,u,c,m,p,_;super(t,e),this.includeEmpty=!1,this.includeFrozen=!0,this.includeMetaData=!0,this.channelUrlsFilter=null,this.customTypesFilter=null,this.customTypeStartsWithFilter=null,this.nicknameContainsFilter=null,this.channelNameContainsFilter=null,this.membershipFilter=N.ALL,this.superChannelFilter=C.ALL,this.metadataKey=null,this.metadataValues=null,this.metadataOrderKeyFilter=null,this.metadataValueStartsWith=null,this.order=F.CHRONOLOGICAL,this.includeEmpty=null!==(s=e.includeEmpty)&&void 0!==s&&s,this.includeFrozen=null===(i=e.includeFrozen)||void 0===i||i,this.includeMetaData=null===(n=e.includeMetaData)||void 0===n||n,this.channelUrlsFilter=null!==(a=e.channelUrlsFilter)&&void 0!==a?a:null,this.customTypesFilter=null!==(l=e.customTypesFilter)&&void 0!==l?l:null,this.customTypeStartsWithFilter=null!==(h=e.customTypeStartsWithFilter)&&void 0!==h?h:null,this.channelNameContainsFilter=null!==(r=e.channelNameContainsFilter)&&void 0!==r?r:null,this.membershipFilter=null!==(o=e.membershipFilter)&&void 0!==o?o:N.ALL,this.superChannelFilter=null!==(d=e.superChannelFilter)&&void 0!==d?d:C.ALL,this.metadataKey=null!==(u=e.metadataKey)&&void 0!==u?u:null,this.metadataValues=null!==(c=e.metadataValues)&&void 0!==c?c:null,this.metadataOrderKeyFilter=null!==(m=e.metadataOrderKeyFilter)&&void 0!==m?m:null,this.metadataValueStartsWith=null!==(p=e.metadataValueStartsWith)&&void 0!==p?p:null,this.order=null!==(_=e.order)&&void 0!==_?_:F.CHRONOLOGICAL}_validate(){return super._validate()&&y("boolean",this.includeEmpty)&&y("boolean",this.includeFrozen)&&y("boolean",this.includeMetaData)&&y("string",this.channelNameContainsFilter,!0)&&g("string",this.channelUrlsFilter,!0)&&g("string",this.customTypesFilter,!0)&&y("string",this.customTypeStartsWithFilter,!0)&&E(N,this.membershipFilter)&&E(C,this.superChannelFilter)&&E(F,this.order)&&y("string",this.metadataOrderKeyFilter,!0)&&y("string",this.metadataKey,!0)&&g("string",this.metadataValues,!0)&&y("string",this.metadataValueStartsWith,!0)}next(){return c(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw S.queryInProgress;{const t=[];if(this._hasNext){this._isLoading=!0;const{requestQueue:t,dispatcher:e}=l.of(this._iid),s=new L(Object.assign(Object.assign({},this),{token:this._token})),i=yield t.send(s),{channels:n,token:a}=i.as(b);return this._token=a,this._hasNext=!!a,e.dispatch(new T({channels:n,source:o.REQUEST_CHANNEL})),this._isLoading=!1,n}return t}}throw S.invalidParameters}))}}export{U as G,O as P,k as a};
